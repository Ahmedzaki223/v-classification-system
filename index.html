<!DOCTYPE html>
<html>
<head>
    <title>AV Safety Classification System</title>
    <!-- Add Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-analytics.js"></script>
    <script src="https://apis.google.com/js/api.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            overflow-x: hidden;
            background-color: #050505;
            color: var(--text-color);
            min-height: 100vh;
            position: relative;
        }

        .gradient-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
        }

        .gradient-sphere {
            position: absolute;
            border-radius: 50%;
            filter: blur(60px);
        }

        .sphere-1 {
            width: 40vw;
            height: 40vw;
            background: linear-gradient(40deg, rgba(255, 0, 128, 0.8), rgba(255, 102, 0, 0.4));
            top: -10%;
            left: -10%;
            animation: float-1 15s ease-in-out infinite alternate;
        }

        .sphere-2 {
            width: 45vw;
            height: 45vw;
            background: linear-gradient(240deg, rgba(72, 0, 255, 0.8), rgba(0, 183, 255, 0.4));
            bottom: -20%;
            right: -10%;
            animation: float-2 18s ease-in-out infinite alternate;
        }

        .sphere-3 {
            width: 30vw;
            height: 30vw;
            background: linear-gradient(120deg, rgba(133, 89, 255, 0.5), rgba(98, 216, 249, 0.3));
            top: 60%;
            left: 20%;
            animation: float-3 20s ease-in-out infinite alternate;
        }

        .noise-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0.05;
            z-index: 5;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
        }

        .grid-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: 40px 40px;
            background-image: 
                linear-gradient(to right, rgba(255, 255, 255, 0.03) 1px, transparent 1px),
                linear-gradient(to bottom, rgba(255, 255, 255, 0.03) 1px, transparent 1px);
            z-index: 2;
        }

        .glow {
            position: absolute;
            width: 40vw;
            height: 40vh;
            background: radial-gradient(circle, rgba(72, 0, 255, 0.15), transparent 70%);
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 2;
            animation: pulse 8s infinite alternate;
            filter: blur(30px);
        }

        .particles-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 3;
            pointer-events: none;
        }

        .particle {
            position: absolute;
            background: white;
            border-radius: 50%;
            opacity: 0;
            pointer-events: none;
        }

        @keyframes float-1 {
            0% { transform: translate(0, 0) scale(1); }
            100% { transform: translate(10%, 10%) scale(1.1); }
        }

        @keyframes float-2 {
            0% { transform: translate(0, 0) scale(1); }
            100% { transform: translate(-10%, -5%) scale(1.15); }
        }

        @keyframes float-3 {
            0% { transform: translate(0, 0) scale(1); opacity: 0.3; }
            100% { transform: translate(-5%, 10%) scale(1.05); opacity: 0.6; }
        }

        @keyframes pulse {
            0% { opacity: 0.3; transform: translate(-50%, -50%) scale(0.9); }
            100% { opacity: 0.7; transform: translate(-50%, -50%) scale(1.1); }
        }

        /* Update existing container styles to work with the background */
        .panel, #login-panel, .admin-view, .submission-details-view, .admin-filters {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        [data-theme="dark"] .panel,
        [data-theme="dark"] #login-panel,
        [data-theme="dark"] .admin-view,
        [data-theme="dark"] .submission-details-view,
        [data-theme="dark"] .admin-filters {
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        :root {
            --background-color: #ffffff;
            --text-color: #333333;
            --panel-bg: #f5f5f5;
            --node-bg: #ffffff;
            --border-color: #ddd;
            --hover-bg: #f8f9fa;
            --selected-bg: #e3f2fd;
            --terminal-bg: #e8f5e9;
            --terminal-color: #2e7d32;
            --table-header-bg: #f2f2f2;
            --table-border: #ddd;
            --input-bg: #ffffff;
            --input-text: #333333;
            --input-border: #ddd;
            --button-bg: #4CAF50;
            --button-hover: #45a049;
            --button-secondary-bg: #2196F3;
            --button-danger-bg: #f44336;
            --dropdown-bg: #ffffff;
            --dropdown-text: #333333;
            --dropdown-hover: #f5f5f5;
            --container-bg: #ffffff;
            --card-bg: #ffffff;
            --header-bg: #ffffff;
            --footer-bg: #ffffff;
            --shadow-color: rgba(0, 0, 0, 0.1);
            --select-bg: #ffffff;
            --select-text: #333333;
            --select-border: #ddd;
            --select-hover: #f5f5f5;
            --shift-button-bg: #e0e0e0;
            --shift-button-hover: #d0d0d0;
            --shift-button-active: #4CAF50;
        }

        .quality-popup {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }

        .popup-content {
            background: rgba(255, 255, 255, 0.95);
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 5px 30px rgba(0, 0, 0, 0.3);
            text-align: center;
            max-width: 500px;
            width: 90%;
            position: relative;
            animation: popupFadeIn 0.5s ease-out;
        }

        [data-theme="dark"] .popup-content {
            background: rgba(30, 30, 30, 0.95);
            color: #fff;
        }

        .cat-gif {
            width: 200px;
            height: 200px;
            border-radius: 10px;
            margin-bottom: 1rem;
            object-fit: cover;
        }

        .close-popup {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 1rem;
            transition: background 0.3s ease;
        }

        .close-popup:hover {
            background: #45a049;
        }

        @keyframes popupFadeIn {
            from {
                opacity: 0;
                transform: scale(0.8);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        [data-theme="dark"] {
            --background-color: #1f0531;
            --text-color: #ffffff;
            --panel-bg: #2d2d2d;
            --node-bg: #333333;
            --border-color: #444444;
            --hover-bg: #3d3d3d;
            --selected-bg: #1a3a4a;
            --terminal-bg: #1b3a1b;
            --terminal-color: #4caf50;
            --table-header-bg: #2d2d2d;
            --table-border: #444444;
            --input-bg: #2d2d2d;
            --input-text: #ffffff;
            --input-border: #444444;
            --button-bg: #4CAF50;
            --button-hover: #45a049;
            --button-secondary-bg: #2196F3;
            --button-danger-bg: #f44336;
            --dropdown-bg: #2d2d2d;
            --dropdown-text: #ffffff;
            --dropdown-hover: #3d3d3d;
            --container-bg: #2d2d2d;
            --card-bg: #333333;
            --header-bg: #2d2d2d;
            --footer-bg: #2d2d2d;
            --shadow-color: rgba(0, 0, 0, 0.3);
            --select-bg: #2d2d2d;
            --select-text: #ffffff;
            --select-border: #444444;
            --select-hover: #3d3d3d;
            --shift-button-bg: #1a1a1a;
            --shift-button-hover: #2d2d2d;
            --shift-button-active: #4CAF50;
        }

        [data-theme="dark"] .boolean-option {
            border-color: var(--border-color);
        }

        [data-theme="dark"] .boolean-option:hover {
            background: var(--hover-bg);
        }

        [data-theme="dark"] .boolean-option.selected {
            background: var(--selected-bg);
        }

        [data-theme="dark"] .accuracy-score {
            background: linear-gradient(135deg, #2e7d32, #1b5e20);
        }

        [data-theme="dark"] .accuracy-score:contains("N/A") {
            background: linear-gradient(135deg, #424242, #212121);
        }

        body {
            background-color: var(--background-color);
            color: var(--text-color);
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        .panel {
            background: var(--panel-bg);
            transition: background-color 0.3s ease;
        }

        .node {
            background: var(--node-bg);
            transition: background-color 0.3s ease;
        }

        .question {
            color: var(--text-color);
            border-bottom-color: var(--border-color);
        }

        .option {
            border-color: var(--border-color);
        }

        .option:hover {
            background: var(--hover-bg);
        }

        .option.selected-option {
            background: var(--selected-bg);
        }

        .terminal-message {
            background: var(--terminal-bg);
            color: var(--terminal-color);
        }

        th {
            background-color: var(--table-header-bg);
        }

        th, td {
            border-color: var(--table-border);
        }

        /* Theme Toggle Button */
        .theme-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--panel-bg);
            border: 2px solid var(--border-color);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .theme-toggle:hover {
            transform: scale(1.1);
        }

        .theme-toggle i {
            font-size: 24px;
            color: var(--text-color);
            transition: transform 0.3s ease;
        }

        .theme-toggle:hover i {
            transform: rotate(180deg);
        }

        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .panel {
            background: #f5f5f5;
            padding: 20px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input[type="text"], input[type="password"], input[type="date"], textarea, select {
            width: 100%;
            padding: 8px;
            box-sizing: border-box;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        /* أنماط فلتر التاريخ */
        .date-filter-container {
            background: var(--container-bg);
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            border: 1px solid #eee;
        }
        
        .date-filter {
            width: auto;
            min-width: 150px;
            margin-right: 10px;
        }
        
        .custom-date {
            width: auto;
            min-width: 150px;
            display: inline-block;
        }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
        }
        button:hover {
            background: #45a049;
        }
        button.secondary {
            background: #2196F3;
        }
        button.danger {
            background: #f44336;
        }
        .tree {
            margin-left: 20px;
        }
        .node {
            margin: 20px 0;
            padding: 15px;
            border-radius: 8px;
            background: #fff;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }
        .question {
            font-size: 1.1em;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #eee;
        }
        .options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .option {
            display: flex;
            align-items: center;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .option:hover {
            background: #f8f9fa;
            border-color: #007bff;
        }
        .option.selected-option {
            background: var(--selected-bg);
        }
        .option input[type="radio"] {
            margin-right: 10px;
        }
        .option label {
            flex: 1;
            cursor: pointer;
            margin: 0;
        }
        .text-input {
            width: 100%;
            padding: 8px;
            margin-top: 5px;
            box-sizing: border-box;
        }
        .selected {
            background-color: #f0f7ff;
            padding: 5px;
            border-radius: 3px;
        }
        .terminal-message {
            margin-top: 15px;
            padding: 15px;
            background: #e8f5e9;
            border-radius: 6px;
            color: #2e7d32;
            font-weight: 500;
        }
        .submission {
            background: #f9f9f9;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 4px;
        }
        .hidden {
            display: none;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        .admin-view {
            margin-top: 30px;
            border-top: 2px solid #eee;
            padding-top: 20px;
        }
        .shift-selection {
            margin-bottom: 20px;
        }
        .shift-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        .shift-btn {
            background: var(--shift-button-bg);
            color: var(--text-color);
            border: 1px solid var(--border-color);
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .shift-btn:hover {
            background: var(--shift-button-hover);
            transform: translateY(-1px);
        }
        .shift-btn.active {
            background: var(--shift-button-active);
            color: white;
            border-color: var(--shift-button-active);
        }
        #user-dropdown {
            width: 100%;
            padding: 8px;
            margin-top: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .admin-filters {
            background: #fff;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .filter-group {
            display: inline-block;
            margin-right: 15px;
        }
        .submission-details-view {
            background: white;
            padding: 20px;
            border-radius: 5px;
            margin-top: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .submission-details-view h4 {
            margin-top: 0;
            color: #333;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }
        .submission-answers {
            margin-top: 15px;
        }
        .answer-item {
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px dashed #eee;
        }
        .answer-question {
            font-weight: bold;
            color: #2c3e50;
        }
        .error-message {
            color: #e74c3c;
            margin-top: 5px;
            font-size: 0.9em;
        }
        .required:after {
            content: " *";
            color: #e74c3c;
        }
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
            margin-left: 10px;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        #tree-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

.pagination-controls {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 12px;
  margin: 15px 0;
  font-weight: bold;
}

.pagination-controls button {
  background-color: var(--btn-bg, #4CAF50);
  color: white;
  border: none;
  padding: 6px 12px;
  border-radius: 5px;
  cursor: pointer;
  font-weight: bold;
  transition: background-color 0.2s ease;
}

.pagination-controls button:disabled {
  background-color: #888;
  cursor: not-allowed;
}


        /* Update container styles */
        .tree-container,
        #login-panel,
        #admin-dashboard,
        .admin-view,
        .submission-details-view,
        .admin-filters,
        .panel,
        .node,
        .option,
        .terminal-message,
        .submission,
        .shift-selection,
        .shift-buttons,
        .admin-filters,
        .filter-group,
        .submission-details-view,
        .tree,
        .question,
        .options,
        .text-input,
        .selected,
        .admin-view,
        .shift-selection,
        .shift-buttons,
        .admin-filters,
        .filter-group,
        .submission-details-view {
            background-color: var(--container-bg);
            color: var(--text-color);
            border-color: var(--border-color);
            box-shadow: 0 2px 4px var(--shadow-color);
            transition: all 0.3s ease;
        }

        /* Update specific container styles */
        .tree-container {
            background-color: var(--container-bg);
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }

        #login-panel {
            background-color: var(--container-bg);
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 4px 6px var(--shadow-color);
        }

        #admin-dashboard {
            background-color: var(--container-bg);
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }

        .admin-view {
            background-color: var(--container-bg);
            border-top: 2px solid var(--border-color);
        }

        .submission-details-view {
            background-color: var(--container-bg);
            border: 1px solid var(--border-color);
        }

        .admin-filters {
            background-color: var(--container-bg);
            border: 1px solid var(--border-color);
        }

        /* Update card-like elements */
        .node,
        .option,
        .submission {
            background-color: var(--card-bg);
            border: 1px solid var(--border-color);
        }

        /* Update header and footer if they exist */
        header,
        footer {
            background-color: var(--header-bg);
            color: var(--text-color);
            border-color: var(--border-color);
        }

        /* Update any remaining containers */
        .container,
        .section,
        .card,
        .box {
            background-color: var(--container-bg);
            color: var(--text-color);
            border-color: var(--border-color);
            transition: all 0.3s ease;
        }

        /* Update hover states */
        .node:hover,
        .option:hover,
        .submission:hover {
            background-color: var(--hover-bg);
        }

        /* Update selected states */
        .option.selected-option,
        .node.selected {
            background-color: var(--selected-bg);
        }

        /* Update table styles */
        table {
            background-color: var(--container-bg);
            border-color: var(--border-color);
        }

        th {
            background-color: var(--table-header-bg);
            color: var(--text-color);
        }

        td {
            color: var(--text-color);
        }

        /* Update form elements */
        .form-group {
            background-color:
        }

        label {
            color: var(--text-color);
        }

        /* Update any modals or popups */
        .modal,
        .popup {
            background-color: var(--container-bg);
            border-color: var(--border-color);
            box-shadow: 0 4px 6px var(--shadow-color);
        }

        .modal-header,
        .popup-header {
            background-color: var(--header-bg);
            border-bottom-color: var(--border-color);
        }

        .modal-body,
        .popup-body {
            background-color: var(--container-bg);
        }

        .modal-footer,
        .popup-footer {
            background-color: var(--header-bg);
            border-top-color: var(--border-color);
        }

        /* Update all input and select styles */
        input[type="text"],
        input[type="password"],
        input[type="number"],
        input[type="email"],
        input[type="tel"],
        input[type="search"],
        textarea,
        select,
        #flash-number,
        #admin-name,
        #admin-password,
        #shift-select,
        #user-dropdown {
            background-color: var(--input-bg) !important;
            color: var(--input-text) !important;
            border: 1px solid var(--input-border) !important;
            transition: all 0.3s ease;
        }

        /* Style for select elements */
        select {
            background-color: var(--select-bg) !important;
            color: var(--select-text) !important;
            border-color: var(--select-border) !important;
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            padding-right: 30px;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 8px center;
            background-size: 16px;
        }

        select:hover {
            background-color: var(--select-hover) !important;
        }

        select:focus {
            border-color: var(--button-bg) !important;
            outline: none;
            box-shadow: 0 0 0 2px rgba(76, 175, 80, 0.2);
        }

        /* Style for select options */
        select option {
            background-color: var(--select-bg) !important;
            color: var(--select-text) !important;
            padding: 10px;
        }

        select option:hover {
            background-color: var(--select-hover) !important;
        }

        /* Style for input focus states */
        input:focus,
        textarea:focus,
        select:focus {
            border-color: var(--button-bg) !important;
            outline: none;
            box-shadow: 0 0 0 2px rgba(76, 175, 80, 0.2);
        }

        /* Style for input placeholders */
        ::placeholder {
            color: var(--text-color);
            opacity: 0.7;
        }

        /* Style for disabled inputs */
        input:disabled,
        textarea:disabled,
        select:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            background-color: var(--input-bg) !important;
        }

        /* Style for the shift selection container */
        .shift-selection {
            background-color: var(--container-bg);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .shift-selection label {
            color: var(--text-color);
            margin-bottom: 10px;
            display: block;
        }

        /* Style for the admin login form */
        #login-panel input[type="text"],
        #login-panel input[type="password"] {
            background-color: var(--input-bg) !important;
            color: var(--input-text) !important;
            border-color: var(--input-border) !important;
        }

        /* Style for the flash number input */
        #flash-number {
            background-color: var(--input-bg) !important;
            color: var(--input-text) !important;
            border-color: var(--input-border) !important;
        }
        
        #pr-dashboard-btn {
            background:#c14020 ;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
            margin-top: 10px;
        }
        
        #responder-dashboard-btn {
            background: #2196F3;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
            margin-top: 10px;
        }
        #responder-dashboard-btn:hover {
            background: #0b7dda;
        }

        /* Admin Panel Styles */
        #admin-panel {
            position: relative;
            padding-top: 60px; /* Add space for the logout button */
        }

        #admin-logout-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: var(--button-danger-bg);
            color: white;
            padding: 8px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            z-index: 100;
        }

        #admin-logout-btn:hover {
            background: #d32f2f;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        /* Update the admin panel header */
        #admin-panel h2 {
            margin-bottom: 30px;
        }

        /* Loading Screen Styles */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.5s ease-out;
        }

        .loading-screen.fade-out {
            opacity: 0;
            pointer-events: none;
        }

        .car-explosion {
            position: relative;
            width: 300px;
            height: 300px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .car {
            position: absolute;
            font-size: 120px;
            font-weight: 900;
            color: white;
            text-shadow: 0 0 20px rgba(255, 255, 255, 0.8);
            animation: explode 2s ease-out forwards;
            z-index: 2;
            transform-origin: center;
            font-family: 'Arial', sans-serif;
            letter-spacing: 5px;
        }

        .car::before {
            content: '';
            position: absolute;
            top: -20px;
            left: -20px;
            right: -20px;
            bottom: -20px;
            background: linear-gradient(90deg, 
                rgba(255, 255, 255, 0.1) 0%,
                rgba(255, 255, 255, 0.2) 50%,
                rgba(255, 255, 255, 0.1) 100%
            );
            border-radius: 20px;
            pointer-events: none;
            z-index: -1;
        }

        @keyframes explode {
            0% {
                transform: translate(-50%, -50%) scale(1) rotate(0deg);
                opacity: 1;
                text-shadow: 0 0 20px rgba(255, 255, 255, 0.8);
            }
            50% {
                transform: translate(-50%, -50%) scale(1.2) rotate(10deg);
                opacity: 0.8;
                text-shadow: 0 0 40px rgba(255, 255, 255, 1);
            }
            100% {
                transform: translate(-50%, -50%) scale(0) rotate(20deg);
                opacity: 0;
                text-shadow: 0 0 60px rgba(255, 255, 255, 1);
            }
        }

        .explosion {
            position: absolute;
            width: 0;
            height: 0;
            background: radial-gradient(circle, 
                rgba(255, 255, 0, 0.8) 0%,
                rgba(255, 165, 0, 0.8) 20%,
                rgba(255, 69, 0, 0.8) 40%,
                rgba(255, 0, 0, 0.8) 60%,
                rgba(139, 0, 0, 0.8) 80%
            );
            border-radius: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            animation: expand 2s ease-out forwards;
            z-index: 1;
            filter: blur(5px);
        }

        .explosion::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, 
                rgba(255, 255, 255, 0.8) 0%,
                rgba(255, 255, 0, 0.8) 20%,
                rgba(255, 165, 0, 0.8) 40%,
                rgba(255, 69, 0, 0.8) 60%,
                rgba(255, 0, 0, 0.8) 80%
            );
            border-radius: 50%;
            animation: pulse 0.5s ease-out infinite alternate;
        }

        .particles {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: 3;
        }

        .particle {
            position: absolute;
            width: 6px;
            height: 6px;
            background: radial-gradient(circle, 
                rgba(255, 255, 255, 0.8) 0%,
                rgba(255, 165, 0, 0.8) 50%,
                rgba(255, 69, 0, 0.8) 100%
            );
            border-radius: 50%;
            top: 50%;
            left: 50%;
            animation: particle 2s ease-out forwards;
            filter: blur(1px);
        }

        @keyframes expand {
            0% {
                width: 0;
                height: 0;
                opacity: 0;
                filter: blur(0px);
            }
            50% {
                width: 200px;
                height: 200px;
                opacity: 0.9;
                filter: blur(5px);
            }
            100% {
                width: 300px;
                height: 300px;
                opacity: 0;
                filter: blur(10px);
            }
        }

        @keyframes pulse {
            0% {
                transform: translate(-50%, -50%) scale(0.95);
                opacity: 0.8;
            }
            100% {
                transform: translate(-50%, -50%) scale(1.05);
                opacity: 1;
            }
        }

        @keyframes particle {
            0% {
                transform: translate(-50%, -50%) scale(1);
                opacity: 1;
                filter: brightness(1);
            }
            100% {
                transform: translate(var(--x), var(--y)) scale(0);
                opacity: 0;
                filter: brightness(2);
            }
        }

        .loading-text {
            position: absolute;
            bottom: 20%;
            color: white;
            font-size: 24px;
            font-weight: bold;
            text-align: center;
            width: 100%;
            opacity: 0;
            animation: fadeIn 0.5s ease-out 1s forwards;
            text-shadow: 0 0 10px rgba(255, 0, 0, 0.5);
        }

        @keyframes fadeIn {
            to {
                opacity: 1;
            }
        }

        .classification-rqe { color: #4CAF50; }
        .classification-nmc { color: #FFA500; }
        .classification-scel0plus { color: #FF0000; }
        .classification-scel1 { color: #FF0000; }
        .classification-scel2 { color: #FF0000; }
        .classification-scel3 { color: #FF0000; }
        .classification-scel4 { color: #FF0000; }
        .boolean-option {
            display: flex;
            align-items: center;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-bottom: 5px;
        }
        .boolean-option:hover {
            background: var(--hover-bg);
        }
        .boolean-option.selected {
            background: var(--selected-bg);
        }
        .boolean-option input[type="checkbox"] {
            margin-right: 10px;
            transform: scale(1.2);
        }
        .accuracy-score {
            font-weight: bold;
            padding: 4px 8px;
            border-radius: 4px;
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            display: inline-block;
            min-width: 60px;
            text-align: center;
        }
        .accuracy-score:contains("N/A") {
            background: linear-gradient(135deg, #9e9e9e, #757575);
        }
    </style>
</head>
<body>
    <!-- Add loading screen -->
    <div class="loading-screen">
        <div class="car-explosion">
            <div class="car">USL</div>
            <div class="explosion"></div>
            <div class="particles" id="particles"></div>
        </div>
        <div class="loading-text">Loading AV Safety Classification System...</div>
    </div>

    <div class="gradient-background">
        <div class="gradient-sphere sphere-1"></div>
        <div class="gradient-sphere sphere-2"></div>
        <div class="gradient-sphere sphere-3"></div>
        <div class="glow"></div>
        <div class="grid-overlay"></div>
        <div class="noise-overlay"></div>
        <div class="particles-container" id="particles-container"></div>
    </div>

    <div class="theme-toggle" onclick="toggleTheme()">
        <i class="fas fa-moon"></i>
    </div>
    <!-- Login Panel -->
    <div id="login-panel" class="panel">
        <h2>User Login🧑🏽‍💻</h2>
        
        <!-- Shift Selection -->
        <div class="shift-selection">
            <label>Select Your Shift:</label>
            <div class="shift-buttons">
                <button class="shift-btn" data-shift="Morning">Morning</button>
                <button class="shift-btn" data-shift="Night">Night</button>
                <button class="shift-btn" data-shift="Overnight">Overnight</button>
            </div>
        </div>
        
        <!-- User Selection -->
        <div class="form-group">
            <label for="user-dropdown">Select Your Name:</label>
            <select id="user-dropdown" disabled>
                <option value="">Please select shift first</option>
            </select>
        </div>
        
        <div class="form-group">
            <label for="flash-number">Yubikey Number:</label>
            <input type="text" id="flash-number" placeholder="Enter your Yubikey number">
        </div>
        
        <button id="login-btn">Start Classification</button>
        <button id="responder-dashboard-btn" onclick="window.open('https://script.google.com/macros/s/AKfycbwV5TFYA7TYy3FdESpmUO8BElxesOPnbB4Z-9rr7BbbBPMWo8A8k0F90cYGB5fKJNKOKQ/exec', '_blank')">Practice Dashboard</button>
        <button id="pr-dashboard-btn" onclick="window.open('https://script.google.com/a/macros/meti.ai/s/AKfycbxN7B6HmzuvZg3uvcMi1Y36O_w2GdC2p9mQs9LoERNj0OndUypkbnb1F4ynvPxEhHR_/exec', '_blank')">Production Tracker</button>
        
        <!-- Admin Login -->
        <div style="margin-top: 30px; border-top: 1px solid #ddd; padding-top: 15px;">
            <h3>Admin Login🥷🏽</h3>
            <div class="form-group">
                <label for="admin-username">Admin Username:</label>
                <input type="text" id="admin-username" placeholder="Enter admin username">
            </div>
            <div class="form-group">
                <label for="admin-password">Password:</label>
                <input type="password" id="admin-password" placeholder="Enter password">
            </div>
            <button id="admin-login-btn" class="secondary">Admin Login</button>
        </div>
    </div>

    <!-- Task Panel -->
    <div id="task-panel" class="panel hidden">
        <h2>Task Information</h2>
        <div class="form-group">
            <label for="task-id">GULP Link:</label>
            <input type="text" id="task-id" placeholder="Enter GULP LINK‼️">
        </div>
        <button id="start-task-btn">Start Task</button>
        <button id="logout-btn" class="danger">Logout</button>
    </div>

    <!-- Classification Panel -->
    <div id="classification-panel" class="hidden">
        <h1>AV Safety Classification Decision Tree</h1>
        <div id="current-user" style="margin-bottom: 20px;"></div>
        <div id="current-task" style="margin-bottom: 20px;"></div>
        <div id="tree-container" class="tree"></div>
        <button id="submit-btn" class="hidden" style="margin-top: 20px;">Submit Classification</button>
        <button id="cancel-task-btn" class="danger">Cancel Task</button>
    </div>

    <!-- User Submissions Panel -->
   <div id="submissions-panel" class="panel hidden">
    <h2>Your Submissions</h2>
  
    <div id="submissions-list"></div>
  <button id="new-task-btn">Start New Task</button>
  <button id="user-logout-btn" class="danger">Logout</button>
</div>

    <!-- Admin Panel -->
    <div id="admin-panel" class="panel hidden">
        <h2>Admin Dashboard</h2>
        <button id="admin-logout-btn" class="danger" style="float: right;">Logout</button>
        
        <!-- Admin Filters -->
        <div class="admin-filters">
            <div class="filter-group">
                <label>Filter by Shift:</label>
                <select id="shift-filter">
                    <option value="all">All Shifts</option>
                    <option value="Morning">Morning</option>
                    <option value="Night">Night</option>
                    <option value="Overnight">Overnight</option>
                </select>
            </div>
            <div class="filter-group">
                <label>Filter by Date:</label>
                <input type="date" id="date-filter">
            </div>
            <button id="apply-filters" class="secondary">Apply Filters</button>
<button id="reset-filters" class="reset-filters back-to-users-btn">Reset</button>
        </div>
        
        <h3>All Users</h3>
        <div id="users-list"></div>
        
        <div id="user-submissions-view" class="hidden">
            <h3>User Submissions</h3>
            <div id="selected-user-info"></div>
            <div id="admin-submissions-list"></div>
            <button id="back-to-users-btn">Back to Users</button>
        </div>
        
        <!-- Submission Details View -->
        <div id="submission-details-view" class="submission-details-view hidden">
            <button id="back-to-submissions-btn" class="secondary" style="margin-bottom: 15px;">← Back to Submissions</button>
            <div id="submission-full-details"></div>
        </div>
    </div>

    <script>
        // ==============================================
        // === Firebase Configurations ==================
        // ==============================================
        const firebaseConfigs = {
            Morning: {
                apiKey: "AIzaSyBQqBfBTb6eShtVNt-AJr9vL_bUo4HRkWs",
                authDomain: "metiusl.firebaseapp.com",
                projectId: "metiusl",
                storageBucket: "metiusl.firebasestorage.app",
                messagingSenderId: "577467713132",
                appId: "1:577467713132:web:55810c5e647cf35c9a7a49",
                measurementId: "G-16FKS5WMYG"
            },
            Night: {
                apiKey: "AIzaSyD3cdN8HzaRJC1qS-tsMbqG0vC_tyXLvZQ",
                authDomain: "meti12.firebaseapp.com",
                projectId: "meti12",
                storageBucket: "meti12.firebasestorage.app",
                messagingSenderId: "833651683437",
                appId: "1:833651683437:web:bb39e49b839b102cbc8f64",
                measurementId: "G-J5SK35N2VF"
            },
            Overnight: {
                apiKey: "AIzaSyDNS2qvjp7vbiw0VdHC7E0ETOwxs7ix00A",
                authDomain: "usl641.firebaseapp.com",
                projectId: "usl641",
                storageBucket: "usl641.firebasestorage.app",
                messagingSenderId: "299850509344",
                appId: "1:299850509344:web:0a068e424dd3d936776045",
                measurementId: "G-H72XNL4L1W"
            }
        };

        let currentShift = null;
        let db, auth, analytics;

        // Function to initialize Firebase for a specific shift
        async function initializeFirebaseForShift(shift) {
            return new Promise(async (resolve, reject) => {
                const config = firebaseConfigs[shift];
                if (!config) {
                    console.error(`Firebase config for shift '${shift}' not found.`);
                    reject(new Error(`Firebase config for shift '${shift}' not found.`));
                    return;
                }

                try {
                    // Delete existing app instance if it exists
                    if (firebase.apps.length > 0) {
                        console.log("Deleting previous Firebase app instance...");
                        await firebase.app().delete();
                        console.log("Previous Firebase app deleted.");
                    }
                } catch (error) {
                    console.error("Error deleting previous Firebase app:", error);
                    // Continue, as initialization might still work or fix a bad state
                }

                try {
                    console.log(`Initializing Firebase for ${shift} shift with project ID: ${config.projectId}...`);
                    const app = firebase.initializeApp(config);
                    db = firebase.firestore(); // Uses the most recently initialized app
                    auth = firebase.auth();
                    analytics = firebase.analytics();
                    
                    // Make Firebase available globally
                    window.db = db;
                    window.auth = auth;
                    window.firebase = firebase; // window.firebase will point to the firebase namespace
                    
                    currentShift = shift;
                    console.log(`Firebase initialized successfully for ${shift} shift.`);
                    resolve();
                } catch (error) {
                    console.error(`Error initializing Firebase for ${shift} shift:`, error);
                    db = null; // Ensure db is null if initialization fails
                    auth = null;
                    analytics = null;
                    currentShift = null;
                    reject(error);
                }
            });
        }

        // ==============================================
        // === Decision Tree JSON =======================
        // ==============================================
        const decisionTree = {
  "version": "usl_61225",
  "treeType": "ADHOC_LABELING",
  "childNodes": [
    {
      "name": "physical_collision",
      "id": "1261220a-8be6-43fa-8be8-2ab7574bf47a",
      "displayName": "Is this a physical collision or exit code 141(Psim/Matrix only)?",
      "nodeType": "choice",
      "childNodes": [
        {
          "name": "physical_collision_a",
          "id": "5ebb5ab4-a250-4bcb-b9e9-4c736b74cfac",
          "displayName": "No",
          "nodeType": "terminal",
          "childNodes": [],
          "status": ""
        },
        {
          "name": "physical_collision_b",
          "id": "becade6a-c16f-4cf8-8692-ca7777536585",
          "displayName": "Yes",
          "nodeType": "branch",
          "childNodes": [
            {
              "name": "physical_collision_npc_id",
              "id": "7ca5af67-6aaa-4d6d-b9ec-501c74e82697",
              "displayName": "List the Critical Object IDs; These are the NPC(s) or object(s) with whom the AV has a safety critical or near miss interaction (if there are multiple separate them by commas):",
              "nodeType": "freeText",
              "childNodes": [],
              "status": ""
            },
            {
              "name": "physical_collision_npc_type",
              "id": "fdd9a7c3-e25f-45c3-a2c3-29e9bcba7d72",
              "displayName": "What type of NPC is involved in this interaction?",
              "nodeType": "choice",
              "childNodes": [
                {
                  "name": "physical_collision_npc_type_a",
                  "id": "e3298872-9f92-40fe-94cc-51b18b080861",
                  "displayName": "Motor Vehicle",
                  "nodeType": "terminal",
                  "childNodes": [],
                  "status": ""
                },
                {
                  "name": "physical_collision_npc_type_e",
                  "id": "3f740148-78ad-43af-aa25-61c40cb3f03c",
                  "displayName": "VRU",
                  "nodeType": "branch",
                  "childNodes": [
                    {
                      "name": "physical_collision_VRU_type",
                      "id": "49d637f8-f4bf-415a-ad27-725f4e90c3cb",
                      "displayName": "What type of VRU is involved in this interaction?",
                      "nodeType": "choice",
                      "childNodes": [
                        {
                          "name": "physical_collision_VRU_type_a",
                          "id": "be4487c5-dac1-49ef-9cbc-1750f8668e41",
                          "displayName": "Pedestrian",
                          "nodeType": "terminal",
                          "childNodes": [],
                          "status": ""
                        },
                        {
                          "name": "physical_collision_VRU_type_b",
                          "id": "32cd8b98-30af-4a97-9d72-48da66ea2bd1",
                          "displayName": "2-Wheel VRU",
                          "nodeType": "terminal",
                          "childNodes": [],
                          "status": ""
                        }
                      ],
                      "status": ""
                    },
                    {
                      "name": "physical_collision_VRU_position_at_impact",
                      "id": "dc3f10ee-36ef-4e0a-acdb-80b21aad1b48",
                      "displayName": "What is the VRU position at time of impact?",
                      "nodeType": "choice",
                      "childNodes": [
                        {
                          "name": "physical_collision_VRU_position_at_impact_a",
                          "id": "00aa31ce-f68f-4c0e-af09-f546040993dc",
                          "displayName": "VRU standing / upright at time of impact",
                          "nodeType": "terminal",
                          "childNodes": [],
                          "status": ""
                        },
                        {
                          "name": "physical_collision_VRU_position_at_impact_b",
                          "id": "d8e2ad8e-975c-4496-b33a-085532e7e4b5",
                          "displayName": "VRU on the ground at time of impact",
                          "nodeType": "terminal",
                          "childNodes": [],
                          "status": ""
                        }
                      ],
                      "status": ""
                    },
                    {
                      "name": "physical_collision_VRU_impact_area",
                      "id": "c0ad73fb-d3ef-4f88-9646-fe49bc48c2d2",
                      "displayName": "Where is the VRU impacted?",
                      "nodeType": "choice",
                      "childNodes": [
                        {
                          "name": "physical_collision_VRU_impact_area_a",
                          "id": "c2941c70-8ee9-43bd-837a-9e81a093965e",
                          "displayName": "VRU impact to the hands and lower extremities",
                          "nodeType": "terminal",
                          "childNodes": [],
                          "status": ""
                        },
                        {
                          "name": "physical_collision_VRU_impact_area_b",
                          "id": "244b34d4-4fb0-48e3-9720-ceb638862ce3",
                          "displayName": "VRU impact to the head, back, or torso",
                          "nodeType": "terminal",
                          "childNodes": [],
                          "status": ""
                        }
                      ],
                      "status": ""
                    },
                    {
                      "name": "physical_collision_VRU_position_after_impact",
                      "id": "bd22784a-4ce9-4ade-ba07-de1604e046f7",
                      "displayName": "What is the VRU position after impact?",
                      "nodeType": "choice",
                      "childNodes": [
                        {
                          "name": "physical_collision_VRU_position_after_impact_a",
                          "id": "8a6121e3-8918-4d8d-aa37-183a68320816",
                          "displayName": "VRU remains standing / upright after impact",
                          "nodeType": "terminal",
                          "childNodes": [],
                          "status": ""
                        },
                        {
                          "name": "physical_collision_VRU_position_after_impact_b",
                          "id": "d1f61b99-0fa3-48c8-8db5-ebc24de684ff",
                          "displayName": "VRU controlled fall",
                          "nodeType": "terminal",
                          "childNodes": [],
                          "status": ""
                        },
                        {
                          "name": "physical_collision_VRU_position_after_impact_c",
                          "id": "9cf17973-3f07-4b0f-9ad2-8443fc57cdda",
                          "displayName": "VRU uncontrolled fall",
                          "nodeType": "terminal",
                          "childNodes": [],
                          "status": ""
                        },
                        {
                          "name": "physical_collision_VRU_position_after_impact_d",
                          "id": "7d34c186-311b-4406-a33a-00dd488757a0",
                          "displayName": "N/A (cannot rely on camera views)",
                          "nodeType": "terminal",
                          "childNodes": [],
                          "status": ""
                        }
                      ],
                      "status": ""
                    },
                    {
                      "name": "physical_collision_VRU_UPI",
                      "id": "3162c5cc-b95f-4b24-ab08-f06aa0a43408",
                      "displayName": "Is the scenario an Unwanted Public Interaction (UPI) (VRU taking deliberate unwanted actions towards the AV)?",
                      "nodeType": "choice",
                      "childNodes": [
                        {
                          "name": "physical_collision_VRU_UPI_a",
                          "id": "211e5042-2fdc-46bb-903e-d0f204d3e6f1",
                          "displayName": "Yes",
                          "nodeType": "terminal",
                          "childNodes": [],
                          "status": ""
                        },
                        {
                          "name": "physical_collision_VRU_UPI_b",
                          "id": "ef49ca3f-2848-4a40-8480-6859c2aa7fbe",
                          "displayName": "No",
                          "nodeType": "terminal",
                          "childNodes": [],
                          "status": ""
                        }
                      ],
                      "status": ""
                    },
                    {
                      "name": "physical_collision_VRU_incidental_contact",
                      "id": "9cb4bd83-634b-4359-9ff3-0a9a15d5b655",
                      "displayName": "Is the scenario an incidental contact?",
                      "nodeType": "choice",
                      "childNodes": [
                        {
                          "name": "physical_collision_VRU_incidental_contact_a",
                          "id": "b66cc74c-2ee7-49a1-9c3d-4f8b077bd22b",
                          "displayName": "Yes",
                          "nodeType": "terminal",
                          "childNodes": [],
                          "status": ""
                        },
                        {
                          "name": "physical_collision_VRU_incidental_contact_b",
                          "id": "57bccb5b-6110-4aa5-b8d2-141f40df0d5e",
                          "displayName": "No",
                          "nodeType": "terminal",
                          "childNodes": [],
                          "status": ""
                        }
                      ],
                      "status": ""
                    }
                  ],
                  "status": ""
                },
                {
                  "name": "physical_collision_npc_type_f",
                  "id": "18f031c0-51ae-45a6-a231-1932c44af1ba",
                  "displayName": "Large NCO",
                  "nodeType": "terminal",
                  "childNodes": [],
                  "status": ""
                },
                {
                  "name": "physical_collision_npc_type_g",
                  "id": "b5871d49-851a-4ac7-9cf0-ea9836bbecfa",
                  "displayName": "Small NCO",
                  "nodeType": "terminal",
                  "childNodes": [],
                  "status": ""
                }
              ],
              "status": ""
            },
            {
              "name": "physical_collision_conflict_initiator",
              "id": "93ac3776-798c-4334-9325-7b3409e2429e",
              "displayName": "Who initiated the conflict?",
              "nodeType": "choice",
              "childNodes": [
                {
                  "name": "physical_collision_conflict_initiator_a",
                  "id": "ce5c51e7-8da0-46b6-9073-9acb38113bf7",
                  "displayName": "AV",
                  "nodeType": "terminal",
                  "childNodes": [],
                  "status": ""
                },
                {
                  "name": "physical_collision_conflict_initiator_b",
                  "id": "46900b9d-6bc7-48ac-96cc-dff9d11f2861",
                  "displayName": "NPC",
                  "nodeType": "terminal",
                  "childNodes": [],
                  "status": ""
                }
              ],
              "status": ""
            },
            {
              "name": "physical_collision_vehicle_system_state_at_contact",
              "id": "4ce7c078-f805-4076-8a12-b723b5fd4f29",
              "displayName": "What is the AV's state at the exact moment of the collision or contact?",
              "nodeType": "choice",
              "childNodes": [
                {
                  "name": "physical_collision_vehicle_system_state_at_contact_a",
                  "id": "40482c5e-b3c0-4ba9-93c7-174e35367458",
                  "displayName": "Autonomous",
                  "nodeType": "terminal",
                  "childNodes": [],
                  "status": ""
                },
                {
                  "name": "physical_collision_vehicle_system_state_at_contact_b",
                  "id": "dc8abbe1-9835-4034-a3f1-a3b1672003f4",
                  "displayName": "Manual",
                  "nodeType": "terminal",
                  "childNodes": [],
                  "status": ""
                }
              ],
              "status": ""
            },
            {
              "name": "physical_collision_start_contact_time",
              "id": "094e51b5-fac0-4e98-8eb0-e75d9e4e639e",
              "displayName": "Enter the timestamp of the exact moment of the collision or contact.",
              "nodeType": "freeText",
              "childNodes": [],
              "status": ""
            },
            {
              "name": "physical_collision_av_speed_at_impact",
              "id": "e59b4c05-8a94-4586-aabf-37818b14fe62",
              "displayName": "Enter the speed of AV(m/s) at impact.",
              "nodeType": "freeText",
              "childNodes": [],
              "status": ""
            },
            {
              "name": "physical_collision_npc_speed_at_impact",
              "id": "aca018a9-4cfd-40e1-bd37-8d7b8fbc3be2",
              "displayName": "Enter the speed of NPC(m/s) at impact.",
              "nodeType": "freeText",
              "childNodes": [],
              "status": ""
            },
            {
              "name": "physical_collision_AV_movement_state",
              "id": "170baf46-571f-4233-ba2e-54a880490c80",
              "displayName": "Is the AV stationary during the 3 seconds before the collision or contact?",
              "nodeType": "choice",
              "childNodes": [
                {
                  "name": "physical_collision_AV_movement_state_a",
                  "id": "ff8d6da9-dacf-4b9e-a6c0-6910a44db52d",
                  "displayName": "Yes",
                  "nodeType": "terminal",
                  "childNodes": [],
                  "status": ""
                },
                {
                  "name": "physical_collision_AV_movement_state_b",
                  "id": "cbdc499f-36bc-4fda-b875-93c10c1562ec",
                  "displayName": "No",
                  "nodeType": "terminal",
                  "childNodes": [],
                  "status": ""
                }
              ],
              "status": ""
            },
            {
              "name": "physical_collision_vehicle_system_state_before_contact",
              "id": "6da3a6e3-9397-4f0c-b063-342ec09127a5",
              "displayName": "What is the AV's state during the 30 seconds before the collision or contact?",
              "nodeType": "choice",
              "childNodes": [
                {
                  "name": "physical_collision_vehicle_system_state_before_contact_a",
                  "id": "64ebe5db-752a-4a5e-9cf4-de47f6c0bf50",
                  "displayName": "Autonomous",
                  "nodeType": "terminal",
                  "childNodes": [],
                  "status": ""
                },
                {
                  "name": "physical_collision_vehicle_system_state_before_contact_b",
                  "id": "198c4534-70d4-438d-8127-a6ddff30c996",
                  "displayName": "Manual",
                  "nodeType": "terminal",
                  "childNodes": [],
                  "status": ""
                }
              ],
              "status": ""
            },
            {
              "name": "physical_collision_sev_cal",
              "id": "de149788-63f1-4fd9-970f-224a02d5dc85",
              "displayName": "Did you use severity calculator?",
              "nodeType": "choice",
              "childNodes": [
                {
                  "name": "physical_collision_sev_cal_a",
                  "id": "8fa88464-afbb-449f-bff7-dc7cac377a9f",
                  "displayName": "No",
                  "nodeType": "terminal",
                  "childNodes": [],
                  "status": ""
                },
                {
                  "name": "physical_collision_sev_cal_b",
                  "id": "4048ff36-14b2-4b86-bef9-213aecca2168",
                  "displayName": "Yes",
                  "nodeType": "branch",
                  "childNodes": [
                    {
                      "name": "physical_collision_manual_severity_cal_inputs",
                      "id": "bf078652-f50c-48a6-8558-9dccb9c0c68b",
                      "displayName": "Paste the values you inputted into cells B2-B12 in the Severity Calc.",
                      "nodeType": "freeText",
                      "childNodes": [],
                      "status": ""
                    }
                  ],
                  "status": ""
                }
              ],
              "status": ""
            },
            {
              "name": "physical_collision_initial_classification",
              "id": "2a9f5ee0-1232-4003-a50e-f2a0a8d9f6d2",
              "displayName": "What is the initial classification?",
              "nodeType": "choice",
              "childNodes": [
                {
                  "name": "physical_collision_initial_classification_a",
                  "id": "3b0433a3-512f-45e6-b16b-b3e86b6aef13",
                  "displayName": "L0+",
                  "nodeType": "terminal",
                  "childNodes": [],
                  "status": ""
                },
                {
                  "name": "physical_collision_initial_classification_b",
                  "id": "e8b45e6b-00be-44f3-889f-aeec0497c41d",
                  "displayName": "L0",
                  "nodeType": "terminal",
                  "childNodes": [],
                  "status": ""
                },
                {
                  "name": "physical_collision_initial_classification_c",
                  "id": "f4d4dce3-3461-4a0d-a8cf-86d74a4f5765",
                  "displayName": "L1",
                  "nodeType": "terminal",
                  "childNodes": [],
                  "status": ""
                },
                {
                  "name": "physical_collision_initial_classification_d",
                  "id": "6b75bbf0-46f7-4a4d-ac2b-a3e7b88bfb0c",
                  "displayName": "L2",
                  "nodeType": "terminal",
                  "childNodes": [],
                  "status": ""
                },
                {
                  "name": "physical_collision_initial_classification_e",
                  "id": "671c6447-5539-4702-a04c-33238b309234",
                  "displayName": "L3",
                  "nodeType": "terminal",
                  "childNodes": [],
                  "status": ""
                },
                {
                  "name": "physical_collision_initial_classification_f",
                  "id": "b1b2b29e-d984-4173-a4a6-6fa5dbba5097",
                  "displayName": "L4",
                  "nodeType": "terminal",
                  "childNodes": [],
                  "status": ""
                },
                {
                  "name": "physical_collision_initial_classification_h",
                  "id": "3d1ada49-1971-436a-b898-5d954a9e2702",
                  "displayName": "RQE",
                  "nodeType": "terminal",
                  "childNodes": [],
                  "status": ""
                }
              ],
              "status": ""
            },
            {
              "name": "physical_collision_kf_side_mirror_overlap",
              "id": "53089e55-8ce8-4c33-87f1-cf33165100f8",
              "displayName": "Did you use Side Mirror Overlap KF to downgrade the initial severity level?",
              "nodeType": "choice",
              "childNodes": [
                {
                  "name": "physical_collision_kf_side_mirror_overlap_a",
                  "id": "97165a8b-8951-48e3-878b-83a162957ee6",
                  "displayName": "No",
                  "nodeType": "terminal",
                  "childNodes": [],
                  "status": ""
                },
                {
                  "name": "physical_collision_kf_side_mirror_overlap_b",
                  "id": "ac6890a4-31a6-4aea-8c12-aac8a22714f0",
                  "displayName": "Yes",
                  "nodeType": "terminal",
                  "childNodes": [],
                  "status": ""
                }
              ],
              "status": ""
            },
            {
              "name": "physical_collision_final_severity",
              "id": "a154f013-ed78-443a-913b-bdd7589dad31",
              "displayName": "What is the final severity level?",
              "nodeType": "choice",
              "childNodes": [
                {
                  "name": "physical_collision_final_severity_a",
                  "id": "d0631fa5-dd0a-4c96-ab60-90d7fbac7607",
                  "displayName": "L0+",
                  "nodeType": "terminal",
                  "childNodes": [],
                  "status": ""
                },
                {
                  "name": "physical_collision_final_severity_b",
                  "id": "b201800a-12dc-4de8-bae4-db3de8a10090",
                  "displayName": "L0",
                  "nodeType": "terminal",
                  "childNodes": [],
                  "status": ""
                },
                {
                  "name": "physical_collision_final_severity_c",
                  "id": "4e937913-8611-40f8-9819-ca3ec2ae762c",
                  "displayName": "L1",
                  "nodeType": "terminal",
                  "childNodes": [],
                  "status": ""
                },
                {
                  "name": "physical_collision_final_severity_d",
                  "id": "80e3855c-184a-4984-a279-a9a511e908dc",
                  "displayName": "L2",
                  "nodeType": "terminal",
                  "childNodes": [],
                  "status": ""
                },
                {
                  "name": "physical_collision_final_severity_e",
                  "id": "da373e4b-7121-414b-a07e-921014185d50",
                  "displayName": "L3",
                  "nodeType": "terminal",
                  "childNodes": [],
                  "status": ""
                },
                {
                  "name": "physical_collision_final_severity_f",
                  "id": "1efce36c-5c91-4060-8e98-783405dbcd02",
                  "displayName": "L4",
                  "nodeType": "terminal",
                  "childNodes": [],
                  "status": ""
                },
                {
                  "name": "physical_collision_final_severity_g",
                  "id": "24780b14-d0db-4da0-9172-e05d2ac7c3d3",
                  "displayName": "RQE",
                  "nodeType": "terminal",
                  "childNodes": [],
                  "status": ""
                }
              ],
              "status": ""
            }
          ],
          "status": ""
        }
      ],
      "status": ""
    },
    {
      "name": "non_physical_collision",
      "id": "69a717de-517d-4c1c-88cc-def1808c18ce",
      "displayName": "Are there any NPCs involved in the conflict or interaction with the AV that does NOT involve a physical collision or have exit code 141(Psim/Matrix only)?",
      "nodeType": "choice",
      "childNodes": [
        {
          "name": "non_physical_collision_a",
          "id": "95c2cc60-caf7-466f-b24d-c100749e8c99",
          "displayName": "N/A; only physical collision or exit code 141",
          "nodeType": "terminal",
          "childNodes": [],
          "status": ""
        },
        {
          "name": "non_physical_collision_b",
          "id": "c6396bad-701a-4f5b-916a-08706640abc5",
          "displayName": "No",
          "nodeType": "terminal",
          "childNodes": [],
          "status": ""
        },
        {
          "name": "non_physical_collision_c",
          "id": "0b8a9c74-f65d-4e0d-82af-423e06c8064a",
          "displayName": "Yes",
          "nodeType": "branch",
          "childNodes": [
            {
              "name": "emm_or_usdc_applied",
              "id": "72fa5be5-a70e-4d08-9d73-93fcdf59adae",
              "displayName": "Can EMM or USDC be applied to at least 1 scenario in the event?",
              "nodeType": "choice",
              "childNodes": [
                {
                  "name": "emm_or_usdc_applied_a",
                  "id": "a467ee05-d1f4-48a0-9cf5-a9193a0a1b37",
                  "displayName": "No",
                  "nodeType": "terminal",
                  "childNodes": [],
                  "status": ""
                },
                {
                  "name": "emm_or_usdc_applied_b",
                  "id": "7b662fe6-ed08-4470-b41a-c6bfe41b3e8e",
                  "displayName": "Yes",
                  "nodeType": "branch",
                  "childNodes": [
                    {
                      "name": "emm_or_usdc_applied_npc_id",
                      "id": "3f274d7d-5f9c-4541-a90c-76e934100b10",
                      "displayName": "List the Critical Object IDs; These are the NPC(s) or object(s) with whom the AV has a safety critical or near miss interaction (if there are multiple separate them by commas):",
                      "nodeType": "freeText",
                      "childNodes": [],
                      "status": ""
                    },
                    {
                      "name": "bt",
                      "id": "e35d85ef-2aa3-42b9-a878-5a100a765680",
                      "displayName": "Is the AV involved in a Blow Through scenario?",
                      "nodeType": "choice",
                      "childNodes": [
                        {
                          "name": "bt_a",
                          "id": "ac6f7ff0-62dc-4392-b024-7b9ddc70b44c",
                          "displayName": "No",
                          "nodeType": "terminal",
                          "childNodes": [],
                          "status": ""
                        },
                        {
                          "name": "bt_b",
                          "id": "870ded5d-84b4-40b8-8f6b-9bb23281e740",
                          "displayName": "Yes",
                          "nodeType": "branch",
                          "childNodes": [
                            {
                              "name": "bt_npc_type",
                              "id": "743365d8-e4a4-4cdf-810b-fd9539531f7b",
                              "displayName": "What type of NPC is involved in this interaction?",
                              "nodeType": "choice",
                              "childNodes": [
                                {
                                  "name": "bt_npc_type_a",
                                  "id": "72ff901b-486f-4de6-b873-a3fc34908ff8",
                                  "displayName": "Motorcycle",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                },
                                {
                                  "name": "bt_npc_type_b",
                                  "id": "fe0a7ad8-1e37-450a-a8b7-0e3770bb9a88",
                                  "displayName": "Sedan",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                },
                                {
                                  "name": "bt_npc_type_c",
                                  "id": "899b9dad-b779-4bef-ac89-cf9e65f19dcb",
                                  "displayName": "Pick-Up / SUV",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                },
                                {
                                  "name": "bt_npc_type_d",
                                  "id": "aef9af99-2acb-4fed-9c21-213654313594",
                                  "displayName": "Truck (18-wheeler)",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                },
                                {
                                  "name": "bt_npc_type_e",
                                  "id": "b60d0465-714a-4c40-b1c2-1a7b58ba5486",
                                  "displayName": "Bike",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                }
                              ],
                              "status": ""
                            },
                            {
                              "name": "bt_conflict_initiator",
                              "id": "92ed46dc-2654-4b3b-b82b-f27ba6aa1091",
                              "displayName": "Who initiated the conflict?",
                              "nodeType": "choice",
                              "childNodes": [
                                {
                                  "name": "bt_conflict_initiator_a",
                                  "id": "223224be-3bd7-47fa-b9d2-f81ec12b4c89",
                                  "displayName": "AV",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                },
                                {
                                  "name": "bt_conflict_initiator_b",
                                  "id": "acc3b4b1-b251-426a-a503-d7ba0ead771b",
                                  "displayName": "NPC",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                }
                              ],
                              "status": ""
                            },
                            {
                              "name": "bt_intersection_tool",
                              "id": "77c84dc2-be9c-44f6-acbb-554fba2a9b92",
                              "displayName": "Paste the information you collected in the Intersection Event Tool, C3-7 and D4-G4.",
                              "nodeType": "freeText",
                              "childNodes": [],
                              "status": ""
                            },
                            {
                              "name": "bt_hot",
                              "id": "b3f24797-99e2-4bef-9c58-ab5d5b11ca3b",
                              "displayName": "What is the HOT?",
                              "nodeType": "freeText",
                              "childNodes": [],
                              "status": ""
                            },
                            {
                              "name": "bt_model_select",
                              "id": "18988f64-e992-499e-9963-b2948d184d9a",
                              "displayName": "Which tool(EMM/USDC) are you able to use for this interaction?",
                              "nodeType": "choice",
                              "childNodes": [
                                {
                                  "name": "bt_model_select_a",
                                  "id": "fe598d7e-5358-492a-aea9-7c7c5e386846",
                                  "displayName": "EMM",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                },
                                {
                                  "name": "bt_model_select_b",
                                  "id": "c39e38d0-c18e-41d8-ab98-34a9c2f01c65",
                                  "displayName": "USDC",
                                  "nodeType": "branch",
                                  "childNodes": [
                                    {
                                      "name": "bt_emm_not_available",
                                      "id": "eb04ea77-582c-4da8-9415-12f3a6d34b76",
                                      "displayName": "EMM is not available",
                                      "nodeType": "boolean",
                                      "childNodes": [],
                                      "status": ""
                                    },
                                    {
                                      "name": "bt_emm_not_detected",
                                      "id": "fef5b224-8c32-45f1-abc0-9242539654da",
                                      "displayName": "This scenario type was not detected",
                                      "nodeType": "boolean",
                                      "childNodes": [],
                                      "status": ""
                                    },
                                    {
                                      "name": "bt_emm_curved_road",
                                      "id": "2c56568f-9d18-4324-a30c-3700a13498a4",
                                      "displayName": "The interaction occurs on a Curved Road",
                                      "nodeType": "boolean",
                                      "childNodes": [],
                                      "status": ""
                                    },
                                    {
                                      "name": "bt_emm_wrong_hot",
                                      "id": "9a23b926-1bdf-4765-b75b-f36602a4741e",
                                      "displayName": "Hazard Onset Time is incorrect",
                                      "nodeType": "boolean",
                                      "childNodes": [],
                                      "status": ""
                                    },
                                    {
                                      "name": "bt_emm_wrong_npc",
                                      "id": "eb95cc21-183d-4c83-862e-8970d0ccfdf1",
                                      "displayName": "EMM does not detect/track the correct NPC Track ID",
                                      "nodeType": "boolean",
                                      "childNodes": [],
                                      "status": ""
                                    },
                                    {
                                      "name": "bt_emm_result_in_NA",
                                      "id": "041a928f-f1c0-496a-b543-3f1db292e755",
                                      "displayName": "EMM gives NA result",
                                      "nodeType": "boolean",
                                      "childNodes": [],
                                      "status": ""
                                    },
                                    {
                                      "name": "bt_emm_did_not_trust",
                                      "id": "7706971c-4325-429f-a801-e08913486eb2",
                                      "displayName": "Did not trust the EMM outcome",
                                      "nodeType": "boolean",
                                      "childNodes": [],
                                      "status": ""
                                    },
                                    {
                                      "name": "bt_usdc_initial_inputs",
                                      "id": "354fd056-652f-4aef-9fe7-47397ba05a97",
                                      "displayName": "What are your USDC inputs? Paste cells B2-B9.",
                                      "nodeType": "freeText",
                                      "childNodes": [],
                                      "status": ""
                                    },
                                    {
                                      "name": "bt_usdc_distance_inputs",
                                      "id": "33afe746-f124-40e9-b23c-3f162235c946",
                                      "displayName": "What are your USDC d_av [m] inputs? Paste cells K8-K16.",
                                      "nodeType": "freeText",
                                      "childNodes": [],
                                      "status": ""
                                    }
                                  ],
                                  "status": ""
                                }
                              ],
                              "status": ""
                            },
                            {
                              "name": "bt_swerve_model",
                              "id": "a86dbb31-c56c-4885-9840-b40ecf003729",
                              "displayName": "Is the Swerve Model Calculator applicable to this interaction?",
                              "nodeType": "choice",
                              "childNodes": [
                                {
                                  "name": "bt_swerve_model_a",
                                  "id": "553685f7-1d00-4882-bc93-549799a89e30",
                                  "displayName": "No",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                },
                                {
                                  "name": "bt_swerve_model_b",
                                  "id": "94541aa4-3cda-474d-ba6f-b389695172a4",
                                  "displayName": "Yes",
                                  "nodeType": "branch",
                                  "childNodes": [
                                    {
                                      "name": "bt_swerve_model_inputs",
                                      "id": "e9abac6d-cd9a-4c31-be7b-07abe05f444a",
                                      "displayName": "Paste your Initial Inputs from the Swerve Model calculator. Paste cells B5-B13",
                                      "nodeType": "freeText",
                                      "childNodes": [],
                                      "status": ""
                                    },
                                    {
                                      "name": "bt_swerve_model_longitudinal_lateral_inputs",
                                      "id": "16e3e17a-3e58-4d5e-8245-d44c5e9a26eb",
                                      "displayName": "Paste your Initial Inputs from the Swerve Model calculator. Paste cells H6-H14, I6-I14",
                                      "nodeType": "freeText",
                                      "childNodes": [],
                                      "status": ""
                                    }
                                  ],
                                  "status": ""
                                }
                              ],
                              "status": ""
                            },
                            {
                              "name": "bt_sev_cal",
                              "id": "52f0462c-e804-4704-befd-4bc5b87de4a5",
                              "displayName": "Did you use severity calculator?",
                              "nodeType": "choice",
                              "childNodes": [
                                {
                                  "name": "bt_sev_cal_a",
                                  "id": "22c07e93-ae86-45a6-9227-101849fb071a",
                                  "displayName": "No",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                },
                                {
                                  "name": "bt_sev_cal_b",
                                  "id": "96e5feb1-69af-4ba4-9996-0a1b59f69381",
                                  "displayName": "Yes",
                                  "nodeType": "branch",
                                  "childNodes": [
                                    {
                                      "name": "bt_manual_severity_cal_inputs",
                                      "id": "a250c485-f6e9-44a5-86e6-506404149718",
                                      "displayName": "Paste the values you inputted into cells B2-B12 in the Severity Calc.",
                                      "nodeType": "freeText",
                                      "childNodes": [],
                                      "status": ""
                                    }
                                  ],
                                  "status": ""
                                }
                              ],
                              "status": ""
                            },
                            {
                              "name": "bt_initial_classification",
                              "id": "8e5aa547-e024-42ec-af50-bf6969a3c557",
                              "displayName": "What is the initial classification?",
                              "nodeType": "choice",
                              "childNodes": [
                                {
                                  "name": "bt_initial_classification_a",
                                  "id": "729fc5c0-8752-4855-8b1f-91873671073f",
                                  "displayName": "L0+",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                },
                                {
                                  "name": "bt_initial_classification_b",
                                  "id": "76e4b963-9524-4cdc-a25a-bb2988a35703",
                                  "displayName": "L0",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                },
                                {
                                  "name": "bt_initial_classification_c",
                                  "id": "37a6f943-a3ec-4049-9462-5db1fd368a27",
                                  "displayName": "L1",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                },
                                {
                                  "name": "bt_initial_classification_d",
                                  "id": "a636b1df-3ef8-4237-b6a7-cc897512ce3a",
                                  "displayName": "L2",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                },
                                {
                                  "name": "bt_initial_classification_e",
                                  "id": "5bd2bc4f-7a77-47e3-b5f5-951e6b5eec84",
                                  "displayName": "L3",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                },
                                {
                                  "name": "bt_initial_classification_f",
                                  "id": "9a7cd237-5950-4e41-a773-77f920dc89a5",
                                  "displayName": "L4",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                },
                                {
                                  "name": "bt_initial_classification_g",
                                  "id": "b5535b89-0212-44c1-b7af-eb17e49b7f8e",
                                  "displayName": "NMC",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                },
                                {
                                  "name": "bt_initial_classification_h",
                                  "id": "f27c9674-15d3-49c8-923c-5b8a48c086d4",
                                  "displayName": "RQE",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                }
                              ],
                              "status": ""
                            },
                            {
                              "name": "bt_kf_used",
                              "id": "c244cf4d-0d2d-4ab7-99bb-3120d6604fda",
                              "displayName": "Can at least 1 Key Factor downgrade the classification?",
                              "nodeType": "choice",
                              "childNodes": [
                                {
                                  "name": "bt_kf_used_a",
                                  "id": "db0ff856-b94f-41ff-8633-b2be49523345",
                                  "displayName": "No",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                },
                                {
                                  "name": "bt_kf_used_b",
                                  "id": "7d560614-ed09-4732-8427-0c2b82d6beee",
                                  "displayName": "Yes",
                                  "nodeType": "branch",
                                  "childNodes": [
                                    {
                                      "name": "bt_kf_acknowledgement",
                                      "id": "e2a6dec0-7c34-4469-939c-fca02ea63dd8",
                                      "displayName": "Acknowledgement: NPC show signs of recognition from either the driver in a motor vehicle, or the VRU, such as gesticulations or eye contact.",
                                      "nodeType": "boolean",
                                      "childNodes": [],
                                      "status": ""
                                    },
                                    {
                                      "name": "bt_kf_early_stimulus",
                                      "id": "10d41ab4-22e7-4753-b703-a43227739541",
                                      "displayName": "Early Stimulus/TKO: The AV fail to provide an adequate stimulus for the NPC to respond to for at least 1 second before the interaction.",
                                      "nodeType": "boolean",
                                      "childNodes": [],
                                      "status": ""
                                    },
                                    {
                                      "name": "bt_kf_responsiveness",
                                      "id": "e9b98f0f-2e85-413c-abb0-55b1a60d6716",
                                      "displayName": "Responsiveness: NPC show kinematic responsiveness, demonstrated either by the NPC slowing down, maneuvering away, accelerating, or other.",
                                      "nodeType": "boolean",
                                      "childNodes": [],
                                      "status": ""
                                    },
                                    {
                                      "name": "bt_kf_secondary_go",
                                      "id": "9947212d-a49f-4c6c-bc53-8297cf77473b",
                                      "displayName": "Secondary Go: Prior to the time of predicted interaction between NPC and AV, the NPC re-accelerate \u003E0.5 m/s after initial deceleration.",
                                      "nodeType": "boolean",
                                      "childNodes": [],
                                      "status": ""
                                    },
                                    {
                                      "name": "bt_kf_collision_course",
                                      "id": "44922f66-91c6-4e76-a136-24720eb80b4c",
                                      "displayName": "Collision Course: The NPC and AV outside of collision course at the time of predicted interaction / collision.",
                                      "nodeType": "boolean",
                                      "childNodes": [],
                                      "status": ""
                                    },
                                    {
                                      "name": "bt_kf_evasive_maneuver",
                                      "id": "5e7ee047-cb9e-43bd-a314-7d6fa1a443f7",
                                      "displayName": "NPC Evasive Maneuver: The NPC can maneuver around the AV.",
                                      "nodeType": "boolean",
                                      "childNodes": [],
                                      "status": ""
                                    },
                                    {
                                      "name": "bt_kf_side_mirror_overlap",
                                      "id": "6f33a0d6-ecf0-4a38-ad7b-ebcddf2f3c52",
                                      "displayName": "Side Mirror Overlap: The overlap with the side mirror only.",
                                      "nodeType": "boolean",
                                      "childNodes": [],
                                      "status": ""
                                    },
                                    {
                                      "name": "bt_kf_unstable_track",
                                      "id": "924fec32-74ae-4074-b41a-edd31e48e7ec",
                                      "displayName": "Flickering Reactive Tracks: At overlap, the reactive footprint unstable or flickering (Replay tests only).",
                                      "nodeType": "boolean",
                                      "childNodes": [],
                                      "status": ""
                                    }
                                  ],
                                  "status": ""
                                }
                              ],
                              "status": ""
                            }
                          ],
                          "status": ""
                        }
                      ],
                      "status": ""
                    },
                    {
                      "name": "lc",
                      "id": "8b681869-d82e-45c8-a649-5e791f301b9d",
                      "displayName": "Does the AV perform a Lane Change maneuver with a NPC present in its Destination Lane?",
                      "nodeType": "choice",
                      "childNodes": [
                        {
                          "name": "lc_a",
                          "id": "18b859e5-17bb-46b2-86b1-0ca347b82117",
                          "displayName": "No",
                          "nodeType": "terminal",
                          "childNodes": [],
                          "status": ""
                        },
                        {
                          "name": "lc_b",
                          "id": "32e7bd65-629c-44c3-96ca-0709dce17c15",
                          "displayName": "Yes",
                          "nodeType": "branch",
                          "childNodes": [
                            {
                              "name": "lc_npc_type",
                              "id": "4eced258-a099-4b07-979c-297e8f69ef40",
                              "displayName": "What type of NPC is involved in this interaction?",
                              "nodeType": "choice",
                              "childNodes": [
                                {
                                  "name": "lc_npc_type_a",
                                  "id": "6e41bfbc-3183-4f03-ab96-631a48d26b4a",
                                  "displayName": "Motorcycle",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                },
                                {
                                  "name": "lc_npc_type_b",
                                  "id": "465f6e69-f0e2-4202-bf3e-cf389ffef0d3",
                                  "displayName": "Sedan",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                },
                                {
                                  "name": "lc_npc_type_c",
                                  "id": "2c747d18-a360-49d1-a70d-f9a771c1025b",
                                  "displayName": "Pick-Up / SUV",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                },
                                {
                                  "name": "lc_npc_type_d",
                                  "id": "9018c0c6-9404-4874-a4b9-65b137711e90",
                                  "displayName": "Truck (18-wheeler)",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                },
                                {
                                  "name": "lc_npc_type_e",
                                  "id": "7462291b-c4c0-4454-b468-c9414d2018b5",
                                  "displayName": "Bike",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                }
                              ],
                              "status": ""
                            },
                            {
                              "name": "lc_conflict_initiator",
                              "id": "3f1e8099-36d6-45dc-ad87-63070d366875",
                              "displayName": "Who initiated the conflict?",
                              "nodeType": "choice",
                              "childNodes": [
                                {
                                  "name": "lc_conflict_initiator_a",
                                  "id": "4c03b664-3825-4afb-9047-ea54a20f7e02",
                                  "displayName": "AV",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                },
                                {
                                  "name": "lc_conflict_initiator_b",
                                  "id": "996c1533-98c7-4946-b1e4-5253956276ce",
                                  "displayName": "NPC",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                }
                              ],
                              "status": ""
                            },
                            {
                              "name": "lc_hot_type",
                              "id": "78a905de-f5a3-47e5-988c-24bc114c72e7",
                              "displayName": "How was the HOT determined?",
                              "nodeType": "choice",
                              "childNodes": [
                                {
                                  "name": "lc_hot_type_a",
                                  "id": "4dc5b339-7056-43e6-9f6b-3b9d597cd960",
                                  "displayName": "Lane Entry",
                                  "nodeType": "branch",
                                  "childNodes": [
                                    {
                                      "name": "lc_onset_ttc",
                                      "id": "284d5fd6-6d7e-4280-a8ed-b020c459be1b",
                                      "displayName": "Paste the information you collected in the Lane Change TTC tool, B15-21",
                                      "nodeType": "freeText",
                                      "childNodes": [],
                                      "status": ""
                                    }
                                  ],
                                  "status": ""
                                },
                                {
                                  "name": "lc_hot_type_b",
                                  "id": "fd80a5b2-76c7-43ec-98e1-fab329a619e9",
                                  "displayName": "Heading Redirected to Original Lane",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                }
                              ],
                              "status": ""
                            },
                            {
                              "name": "lc_hot",
                              "id": "c850100c-038b-4feb-8156-2bbcfc4adda3",
                              "displayName": "What is the HOT?",
                              "nodeType": "freeText",
                              "childNodes": [],
                              "status": ""
                            },
                            {
                              "name": "lc_model_select",
                              "id": "465c8c6e-2822-4d13-9f59-b45459a89e15",
                              "displayName": "Which tool(EMM/USDC) are you able to use for this interaction?",
                              "nodeType": "choice",
                              "childNodes": [
                                {
                                  "name": "lc_model_select_a",
                                  "id": "3166bff8-9a2e-40d0-931c-97328f781149",
                                  "displayName": "EMM",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                },
                                {
                                  "name": "lc_model_select_b",
                                  "id": "38a45526-3e2f-4dc9-98c0-8d808abd1f7d",
                                  "displayName": "USDC",
                                  "nodeType": "branch",
                                  "childNodes": [
                                    {
                                      "name": "lc_emm_not_available",
                                      "id": "85325d48-fbd0-4420-81f5-7968865e3048",
                                      "displayName": "EMM is not available",
                                      "nodeType": "boolean",
                                      "childNodes": [],
                                      "status": ""
                                    },
                                    {
                                      "name": "lc_emm_not_detected",
                                      "id": "0c1c4067-578a-4e2d-866b-77dea0892d0b",
                                      "displayName": "This scenario type was not detected",
                                      "nodeType": "boolean",
                                      "childNodes": [],
                                      "status": ""
                                    },
                                    {
                                      "name": "lc_emm_curved_road",
                                      "id": "2cf1f1c4-ec4e-498d-bfc3-dfe27a775a53",
                                      "displayName": "The interaction occurs on a Curved Road",
                                      "nodeType": "boolean",
                                      "childNodes": [],
                                      "status": ""
                                    },
                                    {
                                      "name": "lc_emm_wrong_hot",
                                      "id": "6606a53a-9abc-4c1f-b769-ea2ad29c1620",
                                      "displayName": "Hazard Onset Time is incorrect",
                                      "nodeType": "boolean",
                                      "childNodes": [],
                                      "status": ""
                                    },
                                    {
                                      "name": "lc_emm_wrong_npc",
                                      "id": "5c355784-5f4c-4163-90e8-d86cfffe019f",
                                      "displayName": "The EMM does not detect/track the correct NPC Track ID",
                                      "nodeType": "boolean",
                                      "childNodes": [],
                                      "status": ""
                                    },
                                    {
                                      "name": "lc_emm_result_in_NA",
                                      "id": "47793158-8769-4cb1-a5e1-b18a3d8898ec",
                                      "displayName": "EMM gives NA result",
                                      "nodeType": "boolean",
                                      "childNodes": [],
                                      "status": ""
                                    },
                                    {
                                      "name": "lc_emm_did_not_trust",
                                      "id": "bdddc90f-9766-448e-bb21-303537481e4c",
                                      "displayName": "Did not trust the EMM outcome",
                                      "nodeType": "boolean",
                                      "childNodes": [],
                                      "status": ""
                                    },
                                    {
                                      "name": "lc_usdc_initial_inputs",
                                      "id": "6bbcde41-ec6c-41c3-a0a2-87b842b4d33f",
                                      "displayName": "What are your USDC inputs? Paste cells B2-B9.",
                                      "nodeType": "freeText",
                                      "childNodes": [],
                                      "status": ""
                                    },
                                    {
                                      "name": "lc_usdc_distance_inputs",
                                      "id": "85c3e874-8840-4012-beb1-b9373e6db5e7",
                                      "displayName": "What are your USDC d_av [m] inputs? Paste cells K8-K16.",
                                      "nodeType": "freeText",
                                      "childNodes": [],
                                      "status": ""
                                    }
                                  ],
                                  "status": ""
                                },
                                {
                                  "name": "lc_model_select_c",
                                  "id": "1069330b-b63d-4fde-8c49-7299623ed752",
                                  "displayName": "N/A, TTC is too high",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                }
                              ],
                              "status": ""
                            },
                            {
                              "name": "lc_swerve_model",
                              "id": "9e95ddf9-b9ed-4ad0-ba3f-6e29b7e2a3d6",
                              "displayName": "Is the Swerve Model Calculator applicable to this interaction?",
                              "nodeType": "choice",
                              "childNodes": [
                                {
                                  "name": "lc_swerve_model_a",
                                  "id": "4985d2a0-5888-4c81-80ce-ed939863cab0",
                                  "displayName": "No",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                },
                                {
                                  "name": "lc_swerve_model_b",
                                  "id": "224e1181-1cf3-40f1-95e3-b33006296759",
                                  "displayName": "Yes",
                                  "nodeType": "branch",
                                  "childNodes": [
                                    {
                                      "name": "lc_swerve_model_inputs",
                                      "id": "11487ea2-5539-4fbe-9ed8-96df6935991e",
                                      "displayName": "Paste your Initial Inputs from the Swerve Model calculator. Paste cells B5-B13",
                                      "nodeType": "freeText",
                                      "childNodes": [],
                                      "status": ""
                                    },
                                    {
                                      "name": "lc_swerve_model_longitudinal_lateral_inputs",
                                      "id": "2541e8e8-f625-4b25-bfa8-bceea636be82",
                                      "displayName": "Paste your Initial Inputs from the Swerve Model calculator. Paste cells H6-H14, I6-I14",
                                      "nodeType": "freeText",
                                      "childNodes": [],
                                      "status": ""
                                    }
                                  ],
                                  "status": ""
                                }
                              ],
                              "status": ""
                            },
                            {
                              "name": "lc_sev_cal",
                              "id": "55ec7c39-b758-4388-9feb-421b889e74b1",
                              "displayName": "Did you use severity calculator?",
                              "nodeType": "choice",
                              "childNodes": [
                                {
                                  "name": "lc_sev_cal_a",
                                  "id": "6c21462a-2278-4871-a778-142ab8091d6d",
                                  "displayName": "No",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                },
                                {
                                  "name": "lc_sev_cal_b",
                                  "id": "9f988eb3-227b-4d5f-89c1-edc9c26de954",
                                  "displayName": "Yes",
                                  "nodeType": "branch",
                                  "childNodes": [
                                    {
                                      "name": "lc_manual_severity_cal_inputs",
                                      "id": "0ea1601d-c076-4cde-aa16-8a854b44ac4d",
                                      "displayName": "Paste the values you inputted into cells B2-B12 in the Severity Calc.",
                                      "nodeType": "freeText",
                                      "childNodes": [],
                                      "status": ""
                                    }
                                  ],
                                  "status": ""
                                }
                              ],
                              "status": ""
                            },
                            {
                              "name": "lc_initial_classification",
                              "id": "53f6dfdc-e449-447a-ae6d-4f7ed821447b",
                              "displayName": "What is the initial classification?",
                              "nodeType": "choice",
                              "childNodes": [
                                {
                                  "name": "lc_initial_classification_a",
                                  "id": "44cdf598-59fd-48f6-a6da-09af12b55919",
                                  "displayName": "L0+",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                },
                                {
                                  "name": "lc_initial_classification_b",
                                  "id": "89086c62-fe96-48b2-9108-3f9e2373c9d7",
                                  "displayName": "L0",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                },
                                {
                                  "name": "lc_initial_classification_c",
                                  "id": "dba39506-ec8c-4c0d-a6d5-3d7ff412fafb",
                                  "displayName": "L1",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                },
                                {
                                  "name": "lc_initial_classification_d",
                                  "id": "5c9981c3-2fce-4741-baec-d6343f48da60",
                                  "displayName": "L2",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                },
                                {
                                  "name": "lc_initial_classification_e",
                                  "id": "bdaa656c-f2a1-4bf1-95aa-8d2b4f9d2437",
                                  "displayName": "L3",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                },
                                {
                                  "name": "lc_initial_classification_f",
                                  "id": "30d665d3-67c5-49b2-9be3-d9f58352e7a5",
                                  "displayName": "L4",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                },
                                {
                                  "name": "lc_initial_classification_g",
                                  "id": "916334a7-b002-4fe1-8590-2a00037ff465",
                                  "displayName": "NMC",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                },
                                {
                                  "name": "lc_initial_classification_h",
                                  "id": "07942d61-a074-48fa-aced-0ac0388aa532",
                                  "displayName": "RQE",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                }
                              ],
                              "status": ""
                            },
                            {
                              "name": "lc_kf_used",
                              "id": "5aa695e9-7ae2-45bc-8031-7c9e164ada12",
                              "displayName": "Can at least 1 Key Factor downgrade the classification?",
                              "nodeType": "choice",
                              "childNodes": [
                                {
                                  "name": "lc_kf_used_a",
                                  "id": "3acfcbdc-bf6f-46a8-82e2-4695b261a739",
                                  "displayName": "No",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                },
                                {
                                  "name": "lc_kf_used_b",
                                  "id": "e6c927fb-fb2d-40d9-9ca1-365e13b61c8e",
                                  "displayName": "Yes",
                                  "nodeType": "branch",
                                  "childNodes": [
                                    {
                                      "name": "lc_kf_acknowledgement",
                                      "id": "5e7e40b7-7c16-484b-8f1e-24f3a9497dd0",
                                      "displayName": "Acknowledgement: NPC show signs of recognition from either the driver in a motor vehicle, or the VRU, such as gesticulations or eye contact.",
                                      "nodeType": "boolean",
                                      "childNodes": [],
                                      "status": ""
                                    },
                                    {
                                      "name": "lc_kf_early_stimulus",
                                      "id": "4cfa2e0c-8cf9-4c1e-8730-9e93866fd433",
                                      "displayName": "Early Stimulus/TKO: The AV fail to provide an adequate stimulus for the NPC to respond to for at least 1 second before the interaction.",
                                      "nodeType": "boolean",
                                      "childNodes": [],
                                      "status": ""
                                    },
                                    {
                                      "name": "lc_kf_responsiveness",
                                      "id": "48916326-9836-48f4-b01b-e4824e8034e3",
                                      "displayName": "Responsiveness: NPC show kinematic responsiveness, demonstrated either by the NPC slowing down, maneuvering away, accelerating, or other.",
                                      "nodeType": "boolean",
                                      "childNodes": [],
                                      "status": ""
                                    },
                                    {
                                      "name": "lc_kf_secondary_go",
                                      "id": "e0072317-16c8-4cac-9c38-629b585ca0d6",
                                      "displayName": "Secondary Go: Prior to the time of predicted interaction between NPC and AV, the NPC re-accelerate \u003E0.5 m/s after initial deceleration.",
                                      "nodeType": "boolean",
                                      "childNodes": [],
                                      "status": ""
                                    },
                                    {
                                      "name": "lc_kf_collision_course",
                                      "id": "0f06ef69-8461-4b91-9611-42c03961713a",
                                      "displayName": "Collision Course: The NPC and AV outside of collision course at the time of predicted interaction / collision.",
                                      "nodeType": "boolean",
                                      "childNodes": [],
                                      "status": ""
                                    },
                                    {
                                      "name": "lc_kf_evasive_maneuver",
                                      "id": "fa28f7c1-49e7-4411-a8f8-3583f90a0a96",
                                      "displayName": "NPC Evasive Maneuver: The NPC can maneuver around the AV.",
                                      "nodeType": "boolean",
                                      "childNodes": [],
                                      "status": ""
                                    },
                                    {
                                      "name": "lc_kf_side_mirror_overlap",
                                      "id": "5d62c203-9008-4f93-95e3-3026292419ea",
                                      "displayName": "Side Mirror Overlap: The overlap with the side mirror only.",
                                      "nodeType": "boolean",
                                      "childNodes": [],
                                      "status": ""
                                    },
                                    {
                                      "name": "lc_kf_unstable_track",
                                      "id": "c2362f93-7274-486a-9ad8-dc2bb4bc6ece",
                                      "displayName": "Flickering Reactive Tracks: At overlap, the reactive footprint unstable or flickering (Replay tests only).",
                                      "nodeType": "boolean",
                                      "childNodes": [],
                                      "status": ""
                                    }
                                  ],
                                  "status": ""
                                }
                              ],
                              "status": ""
                            }
                          ],
                          "status": ""
                        }
                      ],
                      "status": ""
                    },
                    {
                      "name": "mmr",
                      "id": "944301b8-46b1-4ad4-8825-f33b40337d83",
                      "displayName": "Does the AV perform a MMR with a NPC present in a Yield-to Lane?",
                      "nodeType": "choice",
                      "childNodes": [
                        {
                          "name": "mmr_a",
                          "id": "f5426ced-8d57-4acb-ac3c-76d3fbea9198",
                          "displayName": "No",
                          "nodeType": "terminal",
                          "childNodes": [],
                          "status": ""
                        },
                        {
                          "name": "mmr_b",
                          "id": "9afec4e4-ba0a-46f8-93b4-c8f5603d8be2",
                          "displayName": "Yes",
                          "nodeType": "branch",
                          "childNodes": [
                            {
                              "name": "mmr_npc_type",
                              "id": "2bad703f-414a-454c-aa5c-2b94ea0a85c0",
                              "displayName": "What type of NPC is involved in this interaction?",
                              "nodeType": "choice",
                              "childNodes": [
                                {
                                  "name": "mmr_npc_type_a",
                                  "id": "2540a3d9-a96e-4fed-97cd-adda97fed2a2",
                                  "displayName": "Motorcycle",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                },
                                {
                                  "name": "mmr_npc_type_b",
                                  "id": "19387ce8-5a34-4f63-a3ff-dfafe5c66621",
                                  "displayName": "Sedan",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                },
                                {
                                  "name": "mmr_npc_type_c",
                                  "id": "30376e78-d20b-4c40-b078-ba70b43631bd",
                                  "displayName": "Pick-Up / SUV",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                },
                                {
                                  "name": "mmr_npc_type_d",
                                  "id": "e3a0a4ec-bb49-409d-9b37-b392432bdf9d",
                                  "displayName": "Truck (18-wheeler)",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                },
                                {
                                  "name": "mmr_npc_type_e",
                                  "id": "a3efa9d0-d563-4810-ab7e-6b8cc3a1ad82",
                                  "displayName": "Bike",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                }
                              ],
                              "status": ""
                            },
                            {
                              "name": "mmr_conflict_initiator",
                              "id": "7458b47b-1d6a-4e60-b9a1-1bfdf16c6489",
                              "displayName": "Who initiated the conflict?",
                              "nodeType": "choice",
                              "childNodes": [
                                {
                                  "name": "mmr_conflict_initiator_a",
                                  "id": "ce9f6a9e-d03b-40f9-bc11-f2d48bfefd13",
                                  "displayName": "AV",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                },
                                {
                                  "name": "mmr_conflict_initiator_b",
                                  "id": "5658d8b0-83b1-4211-8ab0-f814e7b04b8b",
                                  "displayName": "NPC",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                }
                              ],
                              "status": ""
                            },
                            {
                              "name": "mmr_intersection_tool",
                              "id": "de1e09d3-1399-4e1d-a5b7-774ef1f9e002",
                              "displayName": "Paste the information you collected in the Intersection Event Tool, C3-7 and D4-G4.",
                              "nodeType": "freeText",
                              "childNodes": [],
                              "status": ""
                            },
                            {
                              "name": "mmr_hot",
                              "id": "536c6ce0-8342-40a9-a62b-0227579ba425",
                              "displayName": "What is the HOT?",
                              "nodeType": "freeText",
                              "childNodes": [],
                              "status": ""
                            },
                            {
                              "name": "mmr_model_select",
                              "id": "cac9d85f-cf69-403b-9b17-9578a5258b63",
                              "displayName": "Which tool(EMM/USDC) are you able to use for this interaction?",
                              "nodeType": "choice",
                              "childNodes": [
                                {
                                  "name": "mmr_model_select_a",
                                  "id": "441b03ad-b922-44a7-bb3b-01e4fa2bab68",
                                  "displayName": "EMM",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                },
                                {
                                  "name": "mmr_model_select_b",
                                  "id": "9f4b688b-8756-45df-9a85-a22e5dd174fc",
                                  "displayName": "USDC",
                                  "nodeType": "branch",
                                  "childNodes": [
                                    {
                                      "name": "mmr_emm_not_available",
                                      "id": "73cb2863-a160-44b8-9189-6b927dc3f8a2",
                                      "displayName": "EMM is not available",
                                      "nodeType": "boolean",
                                      "childNodes": [],
                                      "status": ""
                                    },
                                    {
                                      "name": "mmr_emm_not_detected",
                                      "id": "64ad80b9-91e2-4032-8a95-50c2d778d700",
                                      "displayName": "This scenario type was not detected",
                                      "nodeType": "boolean",
                                      "childNodes": [],
                                      "status": ""
                                    },
                                    {
                                      "name": "mmr_emm_curved_road",
                                      "id": "42583e35-3da2-48a3-926b-f1bc23f15a76",
                                      "displayName": "The interaction occurs on a Curved Road",
                                      "nodeType": "boolean",
                                      "childNodes": [],
                                      "status": ""
                                    },
                                    {
                                      "name": "mmr_emm_wrong_hot",
                                      "id": "fafa084a-f350-4b3c-8634-d60d895fcbd3",
                                      "displayName": "Hazard Onset Time is incorrect",
                                      "nodeType": "boolean",
                                      "childNodes": [],
                                      "status": ""
                                    },
                                    {
                                      "name": "mmr_emm_wrong_npc",
                                      "id": "3edbb774-834b-4a85-941f-676ee31aeac9",
                                      "displayName": "The EMM does not detect/track the correct NPC Track ID",
                                      "nodeType": "boolean",
                                      "childNodes": [],
                                      "status": ""
                                    },
                                    {
                                      "name": "mmr_emm_result_in_NA",
                                      "id": "a346b488-666c-4623-8c1f-d702efae442e",
                                      "displayName": "EMM gives NA result",
                                      "nodeType": "boolean",
                                      "childNodes": [],
                                      "status": ""
                                    },
                                    {
                                      "name": "mmr_emm_did_not_trust",
                                      "id": "e54bcf96-3c0f-4bbe-b57b-8b8dabee3fe4",
                                      "displayName": "Did not trust the EMM outcome",
                                      "nodeType": "boolean",
                                      "childNodes": [],
                                      "status": ""
                                    },
                                    {
                                      "name": "mmr_usdc_initial_inputs",
                                      "id": "0ab76dd9-5968-4e5b-93dc-f1c48d916c02",
                                      "displayName": "What are your USDC inputs? Paste cells B2-B9.",
                                      "nodeType": "freeText",
                                      "childNodes": [],
                                      "status": ""
                                    },
                                    {
                                      "name": "mmr_usdc_distance_inputs",
                                      "id": "ff8dc621-84c4-4150-9280-3a6f224153d5",
                                      "displayName": "What are your USDC d_av [m] inputs? Paste cells K8-K16.",
                                      "nodeType": "freeText",
                                      "childNodes": [],
                                      "status": ""
                                    }
                                  ],
                                  "status": ""
                                }
                              ],
                              "status": ""
                            },
                            {
                              "name": "mmr_swerve_model",
                              "id": "462b62e6-aec0-4189-8037-8f3a3d969024",
                              "displayName": "Is the Swerve Model Calculator applicable to this interaction?",
                              "nodeType": "choice",
                              "childNodes": [
                                {
                                  "name": "mmr_swerve_model_a",
                                  "id": "b5d7ee87-4e1e-4a7e-b366-40196339834c",
                                  "displayName": "No",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                },
                                {
                                  "name": "mmr_swerve_model_b",
                                  "id": "8b8fc75e-3e11-4888-a5b8-cf95c175fcd7",
                                  "displayName": "Yes",
                                  "nodeType": "branch",
                                  "childNodes": [
                                    {
                                      "name": "mmr_swerve_model_inputs",
                                      "id": "5f4a8484-c566-47ca-9cd4-212ad3d04a57",
                                      "displayName": "Paste your Initial Inputs from the Swerve Model calculator. Paste cells B5-B13",
                                      "nodeType": "freeText",
                                      "childNodes": [],
                                      "status": ""
                                    },
                                    {
                                      "name": "mmr_swerve_model_longitudinal_lateral_inputs",
                                      "id": "d226d273-c952-47d3-80a4-e7500d1e706c",
                                      "displayName": "Paste your Initial Inputs from the Swerve Model calculator. Paste cells H6-H14, I6-I14",
                                      "nodeType": "freeText",
                                      "childNodes": [],
                                      "status": ""
                                    }
                                  ],
                                  "status": ""
                                }
                              ],
                              "status": ""
                            },
                            {
                              "name": "mmr_sev_cal",
                              "id": "ecfeaa56-6637-441f-9260-189c12fd9dc9",
                              "displayName": "Did you use severity calculator?",
                              "nodeType": "choice",
                              "childNodes": [
                                {
                                  "name": "mmr_sev_cal_a",
                                  "id": "b481d1b2-fe0e-4ba1-bdc8-1453e2fecc64",
                                  "displayName": "No",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                },
                                {
                                  "name": "mmr_sev_cal_b",
                                  "id": "199a1c6a-fae8-4b3f-9611-e143370e1c16",
                                  "displayName": "Yes",
                                  "nodeType": "branch",
                                  "childNodes": [
                                    {
                                      "name": "mmr_manual_severity_cal_inputs",
                                      "id": "1ffdec1b-ac3e-43e7-8a73-5226a5875697",
                                      "displayName": "Paste the values you inputted into cells B2-B12 in the Severity Calc.",
                                      "nodeType": "freeText",
                                      "childNodes": [],
                                      "status": ""
                                    }
                                  ],
                                  "status": ""
                                }
                              ],
                              "status": ""
                            },
                            {
                              "name": "mmr_initial_classification",
                              "id": "cfda5a76-f1b7-4040-9f91-8d765a217c3e",
                              "displayName": "What is the initial classification?",
                              "nodeType": "choice",
                              "childNodes": [
                                {
                                  "name": "mmr_initial_classification_a",
                                  "id": "4a868109-76e6-494a-b38d-30f96ac6a67d",
                                  "displayName": "L0+",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                },
                                {
                                  "name": "mmr_initial_classification_b",
                                  "id": "26cdaf19-7bad-4688-af70-4d77f2dfdf36",
                                  "displayName": "L0",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                },
                                {
                                  "name": "mmr_initial_classification_c",
                                  "id": "f2d0bd40-89f9-4f98-a9cd-158ed6fe02ac",
                                  "displayName": "L1",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                },
                                {
                                  "name": "mmr_initial_classification_d",
                                  "id": "f3387c5a-f3c9-4f72-a99e-f6789974b315",
                                  "displayName": "L2",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                },
                                {
                                  "name": "mmr_initial_classification_e",
                                  "id": "b24fdc23-e8cf-48ad-a347-b9a115f97cf8",
                                  "displayName": "L3",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                },
                                {
                                  "name": "mmr_initial_classification_f",
                                  "id": "7953289d-7cf8-4eff-b08a-0aa1b3a645d5",
                                  "displayName": "L4",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                },
                                {
                                  "name": "mmr_initial_classification_g",
                                  "id": "7c3d586b-8ec6-45aa-a63c-8c40b19fcc6d",
                                  "displayName": "NMC",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                },
                                {
                                  "name": "mmr_initial_classification_h",
                                  "id": "52399ce7-319f-4d64-a4f2-3254b94893bb",
                                  "displayName": "RQE",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                }
                              ],
                              "status": ""
                            },
                            {
                              "name": "mmr_kf_used",
                              "id": "98d462dd-e386-402f-b59e-0e82ce5ca766",
                              "displayName": "Can at least 1 Key Factor downgrade the classification?",
                              "nodeType": "choice",
                              "childNodes": [
                                {
                                  "name": "mmr_kf_used_a",
                                  "id": "86450ca2-a75b-4d53-801d-6d6e841cdfef",
                                  "displayName": "No",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                },
                                {
                                  "name": "mmr_kf_used_b",
                                  "id": "aee91c24-ae78-48a1-a21d-8597769acdf1",
                                  "displayName": "Yes",
                                  "nodeType": "branch",
                                  "childNodes": [
                                    {
                                      "name": "mmr_kf_acknowledgement",
                                      "id": "1dc3a5ee-2442-472d-8706-d37b0b42c675",
                                      "displayName": "Acknowledgement: NPC show signs of recognition from either the driver in a motor vehicle, or the VRU, such as gesticulations or eye contact.",
                                      "nodeType": "boolean",
                                      "childNodes": [],
                                      "status": ""
                                    },
                                    {
                                      "name": "mmr_kf_early_stimulus",
                                      "id": "95603226-bfc6-471c-b8cc-bfba4c755856",
                                      "displayName": "Early Stimulus/TKO: The AV fail to provide an adequate stimulus for the NPC to respond to for at least 1 second before the interaction.",
                                      "nodeType": "boolean",
                                      "childNodes": [],
                                      "status": ""
                                    },
                                    {
                                      "name": "mmr_kf_responsiveness",
                                      "id": "e135b741-89d0-4eeb-abe0-0c342781a356",
                                      "displayName": "Responsiveness: NPC show kinematic responsiveness, demonstrated either by the NPC slowing down, maneuvering away, accelerating, or other.",
                                      "nodeType": "boolean",
                                      "childNodes": [],
                                      "status": ""
                                    },
                                    {
                                      "name": "mmr_kf_secondary_go",
                                      "id": "1d0b418b-75f7-49cb-82c3-34741e8ecc6a",
                                      "displayName": "Secondary Go: Prior to the time of predicted interaction between NPC and AV, the NPC re-accelerate \u003E0.5 m/s after initial deceleration.",
                                      "nodeType": "boolean",
                                      "childNodes": [],
                                      "status": ""
                                    },
                                    {
                                      "name": "mmr_kf_collision_course",
                                      "id": "281d63e3-7459-4c71-83d5-ebec6253b8ba",
                                      "displayName": "Collision Course: The NPC and AV outside of collision course at the time of predicted interaction / collision.",
                                      "nodeType": "boolean",
                                      "childNodes": [],
                                      "status": ""
                                    },
                                    {
                                      "name": "mmr_kf_evasive_maneuver",
                                      "id": "54a19549-0e19-4755-8e8c-454ee4206fb5",
                                      "displayName": "NPC Evasive Maneuver: The NPC can maneuver around the AV.",
                                      "nodeType": "boolean",
                                      "childNodes": [],
                                      "status": ""
                                    },
                                    {
                                      "name": "mmr_kf_side_mirror_overlap",
                                      "id": "da703923-5e96-40a0-b123-fc229839870d",
                                      "displayName": "Side Mirror Overlap: The overlap with the side mirror only.",
                                      "nodeType": "boolean",
                                      "childNodes": [],
                                      "status": ""
                                    },
                                    {
                                      "name": "mmr_kf_unstable_track",
                                      "id": "9850c799-81de-4e04-ba40-5be5525b98cf",
                                      "displayName": "Flickering Reactive Tracks: At overlap, the reactive footprint unstable or flickering (Replay tests only).",
                                      "nodeType": "boolean",
                                      "childNodes": [],
                                      "status": ""
                                    }
                                  ],
                                  "status": ""
                                }
                              ],
                              "status": ""
                            }
                          ],
                          "status": ""
                        }
                      ],
                      "status": ""
                    },
                    {
                      "name": "rf",
                      "id": "f8f40bd8-fd08-481b-bca4-76d1f9f26642",
                      "displayName": "Does the AV perform an unexpected brake in front of a Rear Following NPC?",
                      "nodeType": "choice",
                      "childNodes": [
                        {
                          "name": "rf_a",
                          "id": "466a6b63-ffe4-4e2d-8385-9dcf24b65476",
                          "displayName": "No",
                          "nodeType": "terminal",
                          "childNodes": [],
                          "status": ""
                        },
                        {
                          "name": "rf_b",
                          "id": "1f801c39-562d-46d4-899c-4d6c5d4ec257",
                          "displayName": "Yes",
                          "nodeType": "branch",
                          "childNodes": [
                            {
                              "name": "rf_npc_type",
                              "id": "b7e91552-1efd-42f9-a446-fa26e6b701c1",
                              "displayName": "What type of NPC is involved in this interaction?",
                              "nodeType": "choice",
                              "childNodes": [
                                {
                                  "name": "rf_npc_type_a",
                                  "id": "7197ffd1-0061-4b69-a918-266db7b0448a",
                                  "displayName": "Motorcycle",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                },
                                {
                                  "name": "rf_npc_type_b",
                                  "id": "4de30ca7-8149-4c36-a106-a477bbe17a07",
                                  "displayName": "Sedan",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                },
                                {
                                  "name": "rf_npc_type_c",
                                  "id": "64caa140-8f9d-470f-b3aa-aa8bac47efc7",
                                  "displayName": "Pick-Up / SUV",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                },
                                {
                                  "name": "rf_npc_type_d",
                                  "id": "51606998-552e-4bf9-bd96-75997df8719e",
                                  "displayName": "Truck (18-wheeler)",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                },
                                {
                                  "name": "rf_npc_type_e",
                                  "id": "1b466602-1831-4d3f-aec1-26a87b3e362f",
                                  "displayName": "Bike",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                }
                              ],
                              "status": ""
                            },
                            {
                              "name": "rf_conflict_initiator",
                              "id": "e19f3cc4-d91a-4188-9cb8-a7ac4f83d995",
                              "displayName": "Who initiated the conflict?",
                              "nodeType": "choice",
                              "childNodes": [
                                {
                                  "name": "rf_conflict_initiator_a",
                                  "id": "a2142384-7f13-403b-babc-471998a41147",
                                  "displayName": "AV",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                },
                                {
                                  "name": "rf_conflict_initiator_b",
                                  "id": "cd8ba54f-e3ce-4f4b-8bfa-a42bcdc4981f",
                                  "displayName": "NPC",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                }
                              ],
                              "status": ""
                            },
                            {
                              "name": "rf_hot",
                              "id": "1d0576ae-5fcb-41eb-9f22-70671d0349ae",
                              "displayName": "What is the HOT?",
                              "nodeType": "freeText",
                              "childNodes": [],
                              "status": ""
                            },
                            {
                              "name": "rf_model_select",
                              "id": "45da7668-f67a-48c0-bbbf-f973339a9e2b",
                              "displayName": "Which tool(EMM/USDC) are you able to use for this interaction?",
                              "nodeType": "choice",
                              "childNodes": [
                                {
                                  "name": "rf_model_select_a",
                                  "id": "1f75901b-9d3f-48d0-9d03-3a7d86a46400",
                                  "displayName": "EMM",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                },
                                {
                                  "name": "rf_model_select_b",
                                  "id": "e7ec9fcc-e5d0-4cf0-9b43-b49efaf3ec80",
                                  "displayName": "USDC",
                                  "nodeType": "branch",
                                  "childNodes": [
                                    {
                                      "name": "rf_emm_not_available",
                                      "id": "008f6dd4-125e-4c2e-bea4-06bf038f763a",
                                      "displayName": "EMM is not available",
                                      "nodeType": "boolean",
                                      "childNodes": [],
                                      "status": ""
                                    },
                                    {
                                      "name": "rf_emm_not_detected",
                                      "id": "1e738491-7056-4248-ba8d-13e5cc4f93aa",
                                      "displayName": "This scenario type was not detected",
                                      "nodeType": "boolean",
                                      "childNodes": [],
                                      "status": ""
                                    },
                                    {
                                      "name": "rf_emm_curved_road",
                                      "id": "cf9ad655-e4ed-4ae6-b6c7-4cf345eeeeeb",
                                      "displayName": "The interaction occurs on a Curved Road",
                                      "nodeType": "boolean",
                                      "childNodes": [],
                                      "status": ""
                                    },
                                    {
                                      "name": "rf_emm_wrong_hot",
                                      "id": "17ba3877-b58e-47f7-90c3-f81d622e3f75",
                                      "displayName": "Hazard Onset Time is incorrect",
                                      "nodeType": "boolean",
                                      "childNodes": [],
                                      "status": ""
                                    },
                                    {
                                      "name": "rf_emm_wrong_npc",
                                      "id": "e14513d8-d9fb-423e-a00f-824738ea013f",
                                      "displayName": "The EMM does not detect/track the correct NPC Track ID",
                                      "nodeType": "boolean",
                                      "childNodes": [],
                                      "status": ""
                                    },
                                    {
                                      "name": "rf_emm_result_in_NA",
                                      "id": "a4bcf9d2-d5bd-4174-a849-47d3abc66a36",
                                      "displayName": "EMM gives NA result",
                                      "nodeType": "boolean",
                                      "childNodes": [],
                                      "status": ""
                                    },
                                    {
                                      "name": "rf_emm_did_not_trust",
                                      "id": "96953e25-455b-415a-8091-76ecc47a6e7e",
                                      "displayName": "Did not trust the EMM outcome",
                                      "nodeType": "boolean",
                                      "childNodes": [],
                                      "status": ""
                                    },
                                    {
                                      "name": "rf_usdc_initial_inputs",
                                      "id": "7a0b26d2-9325-4326-8d94-a0143c9e38d1",
                                      "displayName": "What are your USDC inputs? Paste cells B2-B9.",
                                      "nodeType": "freeText",
                                      "childNodes": [],
                                      "status": ""
                                    },
                                    {
                                      "name": "rf_usdc_distance_inputs",
                                      "id": "abc4c665-da14-4420-98d3-575fcd9c4b40",
                                      "displayName": "What are your USDC d_av [m] inputs? Paste cells K8-K16.",
                                      "nodeType": "freeText",
                                      "childNodes": [],
                                      "status": ""
                                    }
                                  ],
                                  "status": ""
                                }
                              ],
                              "status": ""
                            },
                            {
                              "name": "rf_swerve_model",
                              "id": "d62efd41-d7e3-440e-9cf3-8c51e19f1b87",
                              "displayName": "Is the Swerve Model Calculator applicable to this interaction?",
                              "nodeType": "choice",
                              "childNodes": [
                                {
                                  "name": "rf_swerve_model_a",
                                  "id": "b454d51f-f52e-4d0f-9746-c89f8d12f2af",
                                  "displayName": "No",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                },
                                {
                                  "name": "rf_swerve_model_b",
                                  "id": "3ba6c653-2784-491f-8dc1-bd89e4f28d68",
                                  "displayName": "Yes",
                                  "nodeType": "branch",
                                  "childNodes": [
                                    {
                                      "name": "rf_swerve_model_inputs",
                                      "id": "ce21b22f-06a6-439f-90c1-d56216cd4f6f",
                                      "displayName": "Paste your Initial Inputs from the Swerve Model calculator. Paste cells B5-B13",
                                      "nodeType": "freeText",
                                      "childNodes": [],
                                      "status": ""
                                    },
                                    {
                                      "name": "rf_swerve_model_longitudinal_lateral_inputs",
                                      "id": "f30dcca7-88d9-4d35-92d6-ac39492d5623",
                                      "displayName": "Paste your Initial Inputs from the Swerve Model calculator. Paste cells H6-H14, I6-I14",
                                      "nodeType": "freeText",
                                      "childNodes": [],
                                      "status": ""
                                    }
                                  ],
                                  "status": ""
                                }
                              ],
                              "status": ""
                            },
                            {
                              "name": "rf_sev_cal",
                              "id": "09c87236-29ab-4775-9aae-a4900d7cf24c",
                              "displayName": "Did you use severity calculator?",
                              "nodeType": "choice",
                              "childNodes": [
                                {
                                  "name": "rf_sev_cal_a",
                                  "id": "c75ef6d8-7f2e-4cfe-b182-24f929c7b1cb",
                                  "displayName": "No",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                },
                                {
                                  "name": "rf_sev_cal_b",
                                  "id": "718dab0a-4f48-4722-bbe5-b2581ba3ce68",
                                  "displayName": "Yes",
                                  "nodeType": "branch",
                                  "childNodes": [
                                    {
                                      "name": "rf_manual_severity_cal_inputs",
                                      "id": "a9127217-a6e2-4549-b647-5fec80cc0f52",
                                      "displayName": "Paste the values you inputted into cells B2-B12 in the Severity Calc.",
                                      "nodeType": "freeText",
                                      "childNodes": [],
                                      "status": ""
                                    }
                                  ],
                                  "status": ""
                                }
                              ],
                              "status": ""
                            },
                            {
                              "name": "rf_initial_classification",
                              "id": "5d095ca6-5f99-47f1-a7dc-d8f40d1844ce",
                              "displayName": "What is the initial classification?",
                              "nodeType": "choice",
                              "childNodes": [
                                {
                                  "name": "rf_initial_classification_a",
                                  "id": "5afe5cd5-bafc-4a3a-8552-531a0b65aa07",
                                  "displayName": "L0+",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                },
                                {
                                  "name": "rf_initial_classification_b",
                                  "id": "c2afcba2-c7cd-499c-a398-56d7a339d1f2",
                                  "displayName": "L0",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                },
                                {
                                  "name": "rf_initial_classification_c",
                                  "id": "47d616c6-22cf-4c5f-ae93-87c0a91f3975",
                                  "displayName": "L1",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                },
                                {
                                  "name": "rf_initial_classification_d",
                                  "id": "c3cff48a-6757-4fa9-ac3e-05a66c4accea",
                                  "displayName": "L2",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                },
                                {
                                  "name": "rf_initial_classification_e",
                                  "id": "b1978056-f062-42fb-bdc8-3e450fa3e66c",
                                  "displayName": "L3",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                },
                                {
                                  "name": "rf_initial_classification_f",
                                  "id": "95a711d5-1acf-4a52-9814-af9c177ef770",
                                  "displayName": "L4",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                },
                                {
                                  "name": "rf_initial_classification_g",
                                  "id": "c683373e-3599-4c7c-8c4f-7d540ae30f32",
                                  "displayName": "NMC",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                },
                                {
                                  "name": "rf_initial_classification_h",
                                  "id": "2e9528e3-e485-4cf6-bfd9-701c8a2313d8",
                                  "displayName": "RQE",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                }
                              ],
                              "status": ""
                            },
                            {
                              "name": "rf_kf_used",
                              "id": "3f8c4813-236b-42a9-88f9-150689066dea",
                              "displayName": "Can at least 1 Key Factor downgrade the classification?",
                              "nodeType": "choice",
                              "childNodes": [
                                {
                                  "name": "rf_kf_used_a",
                                  "id": "1e231f74-cb83-4989-aada-93988bab1b29",
                                  "displayName": "No",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                },
                                {
                                  "name": "rf_kf_used_b",
                                  "id": "bba3acc6-b743-4301-a9c5-89ec24e82818",
                                  "displayName": "Yes",
                                  "nodeType": "branch",
                                  "childNodes": [
                                    {
                                      "name": "rf_kf_acknowledgement",
                                      "id": "fa4084da-5cb2-467a-b3e2-ac1a88c1167a",
                                      "displayName": "Acknowledgement: NPC show signs of recognition from either the driver in a motor vehicle, or the VRU, such as gesticulations or eye contact.",
                                      "nodeType": "boolean",
                                      "childNodes": [],
                                      "status": ""
                                    },
                                    {
                                      "name": "rf_kf_early_stimulus",
                                      "id": "ba16ab32-bd70-4356-beec-c4cfc65f46a0",
                                      "displayName": "Early Stimulus/TKO: The AV fail to provide an adequate stimulus for the NPC to respond to for at least 1 second before the interaction.",
                                      "nodeType": "boolean",
                                      "childNodes": [],
                                      "status": ""
                                    },
                                    {
                                      "name": "rf_kf_responsiveness",
                                      "id": "cfc4cb71-4585-4a1f-b8d4-8fa38f5acb3a",
                                      "displayName": "Responsiveness: NPC show kinematic responsiveness, demonstrated either by the NPC slowing down, maneuvering away, accelerating, or other.",
                                      "nodeType": "boolean",
                                      "childNodes": [],
                                      "status": ""
                                    },
                                    {
                                      "name": "rf_kf_secondary_go",
                                      "id": "86ba2cc9-c5c7-4901-8a5e-1cf62b923bd6",
                                      "displayName": "Secondary Go: Prior to the time of predicted interaction between NPC and AV, the NPC re-accelerate \u003E0.5 m/s after initial deceleration.",
                                      "nodeType": "boolean",
                                      "childNodes": [],
                                      "status": ""
                                    },
                                    {
                                      "name": "rf_kf_collision_course",
                                      "id": "0e982b71-9cc5-4235-b6c1-dd8c06918b20",
                                      "displayName": "Collision Course: The NPC and AV outside of collision course at the time of predicted interaction / collision.",
                                      "nodeType": "boolean",
                                      "childNodes": [],
                                      "status": ""
                                    },
                                    {
                                      "name": "rf_kf_evasive_maneuver",
                                      "id": "fc71b223-1b1f-45ab-9000-532d95d23c4c",
                                      "displayName": "NPC Evasive Maneuver: The NPC can maneuver around the AV.",
                                      "nodeType": "boolean",
                                      "childNodes": [],
                                      "status": ""
                                    },
                                    {
                                      "name": "rf_kf_side_mirror_overlap",
                                      "id": "22e6cba0-0f67-49bd-acb2-e94ceea4a415",
                                      "displayName": "Side Mirror Overlap: The overlap with the side mirror only.",
                                      "nodeType": "boolean",
                                      "childNodes": [],
                                      "status": ""
                                    },
                                    {
                                      "name": "rf_kf_unstable_track",
                                      "id": "ec792a62-5c5f-4d61-a86e-bea36b3327a5",
                                      "displayName": "Flickering Reactive Tracks: At overlap, the reactive footprint unstable or flickering (Replay tests only).",
                                      "nodeType": "boolean",
                                      "childNodes": [],
                                      "status": ""
                                    }
                                  ],
                                  "status": ""
                                }
                              ],
                              "status": ""
                            }
                          ],
                          "status": ""
                        }
                      ],
                      "status": ""
                    },
                    {
                      "name": "upl",
                      "id": "8c88ac26-2ad4-42c3-b7ab-f5dff4666c6e",
                      "displayName": "Does the AV perform a UPL with a NPC present in a Yield-to Lane?",
                      "nodeType": "choice",
                      "childNodes": [
                        {
                          "name": "upl_a",
                          "id": "193525b7-09f5-4ce6-afaa-a4e204dc9efc",
                          "displayName": "No",
                          "nodeType": "terminal",
                          "childNodes": [],
                          "status": ""
                        },
                        {
                          "name": "upl_b",
                          "id": "d535b68b-7cf3-4df2-a523-f3723e90e6b6",
                          "displayName": "Yes",
                          "nodeType": "branch",
                          "childNodes": [
                            {
                              "name": "upl_npc_type",
                              "id": "409ee8f5-aaad-4f70-b70a-c0997eae431a",
                              "displayName": "What type of NPC is involved in this interaction?",
                              "nodeType": "choice",
                              "childNodes": [
                                {
                                  "name": "upl_npc_type_a",
                                  "id": "336f1e22-a30c-446f-8c37-4637f6410bc9",
                                  "displayName": "Motorcycle",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                },
                                {
                                  "name": "upl_npc_type_b",
                                  "id": "4139fce9-d9c1-4e4a-a077-23af033b25b7",
                                  "displayName": "Sedan",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                },
                                {
                                  "name": "upl_npc_type_c",
                                  "id": "dd8cd802-5172-47ca-b61c-5cffb78951dc",
                                  "displayName": "Pick-Up / SUV",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                },
                                {
                                  "name": "upl_npc_type_d",
                                  "id": "b0e0ea04-b818-4c93-b5b6-ab0d18e2fd64",
                                  "displayName": "Truck (18-wheeler)",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                },
                                {
                                  "name": "upl_npc_type_e",
                                  "id": "4acc8256-c5e6-4df9-844b-145152a2f7eb",
                                  "displayName": "Bike",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                }
                              ],
                              "status": ""
                            },
                            {
                              "name": "upl_conflict_initiator",
                              "id": "a02563c2-7bec-4b9d-b9d8-2caebdf20ea5",
                              "displayName": "Who initiated the conflict?",
                              "nodeType": "choice",
                              "childNodes": [
                                {
                                  "name": "upl_conflict_initiator_a",
                                  "id": "e74cfbc6-3a44-403b-929d-3a6beb88d72c",
                                  "displayName": "AV",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                },
                                {
                                  "name": "upl_conflict_initiator_b",
                                  "id": "13526a99-a6f7-4cee-bcfe-38396eeecdee",
                                  "displayName": "NPC",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                }
                              ],
                              "status": ""
                            },
                            {
                              "name": "upl_hot_type",
                              "id": "ac371c85-7e8c-4530-89a5-48602b75487f",
                              "displayName": "How did you identify the HOT?",
                              "nodeType": "choice",
                              "childNodes": [
                                {
                                  "name": "upl_hot_type_a",
                                  "id": "35fa7613-282b-4a3e-a70a-443164ac2ef1",
                                  "displayName": "15 degree (0.26 radians) Degree change",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                },
                                {
                                  "name": "upl_hot_type_b",
                                  "id": "72d950ea-9ba5-49cd-a651-ea2aac001800",
                                  "displayName": "Path Entry (Encroachment)",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                },
                                {
                                  "name": "upl_hot_type_c",
                                  "id": "aec57394-5d35-4221-93d2-fd2668e4a3a0",
                                  "displayName": "Brake Onset",
                                  "nodeType": "branch",
                                  "childNodes": [
                                    {
                                      "name": "upl_intersection_tool",
                                      "id": "88ab388b-1079-43cc-ac3e-6a3dd09d0a4e",
                                      "displayName": "Paste the information you collected in the Intersection Event Tool, C4-G4.",
                                      "nodeType": "freeText",
                                      "childNodes": [],
                                      "status": ""
                                    }
                                  ],
                                  "status": ""
                                }
                              ],
                              "status": ""
                            },
                            {
                              "name": "upl_hot",
                              "id": "0b874c97-b552-4a5a-9bac-fdaa853c3090",
                              "displayName": "What is the HOT?",
                              "nodeType": "freeText",
                              "childNodes": [],
                              "status": ""
                            },
                            {
                              "name": "upl_model_select",
                              "id": "ca9c7c3c-5f17-4d22-8b61-326cfae3b7e9",
                              "displayName": "Which tool(EMM/USDC) are you able to use for this interaction?",
                              "nodeType": "choice",
                              "childNodes": [
                                {
                                  "name": "upl_model_select_a",
                                  "id": "58da9839-ba0d-4815-b04a-a38fa84cdb8f",
                                  "displayName": "EMM",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                },
                                {
                                  "name": "upl_model_select_b",
                                  "id": "be6e8164-431e-4a91-bb73-872639046a17",
                                  "displayName": "USDC",
                                  "nodeType": "branch",
                                  "childNodes": [
                                    {
                                      "name": "upl_emm_not_available",
                                      "id": "b8586420-886e-45ae-9bfc-c183d60e857a",
                                      "displayName": "EMM is not available",
                                      "nodeType": "boolean",
                                      "childNodes": [],
                                      "status": ""
                                    },
                                    {
                                      "name": "upl_emm_not_detected",
                                      "id": "a927afad-bf33-4486-9ee0-fd33dfdd066f",
                                      "displayName": "This scenario type was not detected",
                                      "nodeType": "boolean",
                                      "childNodes": [],
                                      "status": ""
                                    },
                                    {
                                      "name": "upl_emm_curved_road",
                                      "id": "e63ac670-24f9-4182-aed2-8b94c17b4e38",
                                      "displayName": "The interaction occurs on a Curved Road",
                                      "nodeType": "boolean",
                                      "childNodes": [],
                                      "status": ""
                                    },
                                    {
                                      "name": "upl_emm_wrong_hot",
                                      "id": "c7604add-6080-405d-a16d-0a226516cfa4",
                                      "displayName": "Hazard Onset Time is incorrect",
                                      "nodeType": "boolean",
                                      "childNodes": [],
                                      "status": ""
                                    },
                                    {
                                      "name": "upl_emm_wrong_npc",
                                      "id": "64e35c42-5bd4-4c79-9ba3-64872155c9ea",
                                      "displayName": "The EMM does not detect/track the correct NPC Track ID",
                                      "nodeType": "boolean",
                                      "childNodes": [],
                                      "status": ""
                                    },
                                    {
                                      "name": "upl_emm_result_in_NA",
                                      "id": "a9aa65e1-cf83-43f0-beca-6519c69faff7",
                                      "displayName": "EMM gives NA result",
                                      "nodeType": "boolean",
                                      "childNodes": [],
                                      "status": ""
                                    },
                                    {
                                      "name": "upl_emm_did_not_trust",
                                      "id": "a515223b-c9a2-4da7-a393-af700de4cc9f",
                                      "displayName": "Did not trust the EMM outcome",
                                      "nodeType": "boolean",
                                      "childNodes": [],
                                      "status": ""
                                    },
                                    {
                                      "name": "upl_usdc_initial_inputs",
                                      "id": "f4c45a3f-7f9f-4e94-8f14-7869fab0400f",
                                      "displayName": "What are your USDC inputs? Paste cells B2-B9.",
                                      "nodeType": "freeText",
                                      "childNodes": [],
                                      "status": ""
                                    },
                                    {
                                      "name": "upl_usdc_distance_inputs",
                                      "id": "bbc4fda2-8147-4e2c-b854-e02ee91cc5b0",
                                      "displayName": "What are your USDC d_av [m] inputs? Paste cells K8-K16.",
                                      "nodeType": "freeText",
                                      "childNodes": [],
                                      "status": ""
                                    }
                                  ],
                                  "status": ""
                                }
                              ],
                              "status": ""
                            },
                            {
                              "name": "upl_swerve_model",
                              "id": "79fc14b9-b347-4375-a065-59ad5a7b8649",
                              "displayName": "Is the Swerve Model Calculator applicable to this interaction?",
                              "nodeType": "choice",
                              "childNodes": [
                                {
                                  "name": "upl_swerve_model_a",
                                  "id": "ef44a5d3-0477-4415-a61b-39435abc5ea8",
                                  "displayName": "No",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                },
                                {
                                  "name": "upl_swerve_model_b",
                                  "id": "be0819e8-6d0a-4d20-a8df-d90793cf3361",
                                  "displayName": "Yes",
                                  "nodeType": "branch",
                                  "childNodes": [
                                    {
                                      "name": "upl_swerve_model_inputs",
                                      "id": "fcbee25a-b3e0-45d3-8849-493c95a457f4",
                                      "displayName": "Paste your Initial Inputs from the Swerve Model calculator. Paste cells B5-B13",
                                      "nodeType": "freeText",
                                      "childNodes": [],
                                      "status": ""
                                    },
                                    {
                                      "name": "upl_swerve_model_longitudinal_lateral_inputs",
                                      "id": "1954c37c-815c-4d21-a49f-618d89b2e031",
                                      "displayName": "Paste your Initial Inputs from the Swerve Model calculator. Paste cells H6-H14, I6-I14",
                                      "nodeType": "freeText",
                                      "childNodes": [],
                                      "status": ""
                                    }
                                  ],
                                  "status": ""
                                }
                              ],
                              "status": ""
                            },
                            {
                              "name": "upl_sev_cal",
                              "id": "f2395b7b-4df8-494d-88f7-ae20abfd768c",
                              "displayName": "Did you use severity calculator?",
                              "nodeType": "choice",
                              "childNodes": [
                                {
                                  "name": "upl_sev_cal_a",
                                  "id": "d0fc5385-b204-4b48-ad20-cd4a4e121ce6",
                                  "displayName": "No",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                },
                                {
                                  "name": "upl_sev_cal_b",
                                  "id": "4fa1f493-e312-4b62-8a5f-eab57961b98f",
                                  "displayName": "Yes",
                                  "nodeType": "branch",
                                  "childNodes": [
                                    {
                                      "name": "upl_manual_severity_cal_inputs",
                                      "id": "1b18f539-39bc-46e3-ad37-998409af0e4c",
                                      "displayName": "Paste the values you inputted into cells B2-B12 in the Severity Calc.",
                                      "nodeType": "freeText",
                                      "childNodes": [],
                                      "status": ""
                                    }
                                  ],
                                  "status": ""
                                }
                              ],
                              "status": ""
                            },
                            {
                              "name": "upl_initial_classification",
                              "id": "29064dd5-b8ef-4149-bec6-954a281a86c4",
                              "displayName": "What classification did the EMM or USDC return?",
                              "nodeType": "choice",
                              "childNodes": [
                                {
                                  "name": "upl_initial_classification_a",
                                  "id": "c85268c6-6532-4336-966a-bdfec0c6f721",
                                  "displayName": "L0+",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                },
                                {
                                  "name": "upl_initial_classification_b",
                                  "id": "6a9c5a60-3302-4509-9a00-f040274f1752",
                                  "displayName": "L0",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                },
                                {
                                  "name": "upl_initial_classification_c",
                                  "id": "51307080-204d-4d18-9ddc-1c96362ec244",
                                  "displayName": "L1",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                },
                                {
                                  "name": "upl_initial_classification_d",
                                  "id": "8ecc7931-457d-45f9-b0d3-6815e48ea2eb",
                                  "displayName": "L2",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                },
                                {
                                  "name": "upl_initial_classification_e",
                                  "id": "8d995b3f-8140-43e2-893d-813c8165efe8",
                                  "displayName": "L3",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                },
                                {
                                  "name": "upl_initial_classification_f",
                                  "id": "072f5b84-77ce-4032-bd77-a3f8c4dc4442",
                                  "displayName": "L4",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                },
                                {
                                  "name": "upl_initial_classification_g",
                                  "id": "4f8f5a28-5f68-42dd-8e79-e55441893c40",
                                  "displayName": "NMC",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                },
                                {
                                  "name": "upl_initial_classification_h",
                                  "id": "854ab6da-1b81-4d01-a90b-b1ebd55b40b0",
                                  "displayName": "RQE",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                }
                              ],
                              "status": ""
                            },
                            {
                              "name": "upl_kf_used",
                              "id": "b22dc8e3-a74b-400a-af1b-386db07f8763",
                              "displayName": "Can at least 1 Key Factor downgrade the classification?",
                              "nodeType": "choice",
                              "childNodes": [
                                {
                                  "name": "upl_kf_used_a",
                                  "id": "cf4a6ace-5d71-4c26-ac08-61dcb28bca66",
                                  "displayName": "No",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                },
                                {
                                  "name": "upl_kf_used_b",
                                  "id": "81750e8e-c552-40ae-b529-2a97cf072f91",
                                  "displayName": "Yes",
                                  "nodeType": "branch",
                                  "childNodes": [
                                    {
                                      "name": "upl_kf_acknowledgement",
                                      "id": "2f5845cb-e9dc-4d4c-af2b-ee4f9cc86428",
                                      "displayName": "Acknowledgement: NPC show signs of recognition from either the driver in a motor vehicle, or the VRU, such as gesticulations or eye contact.",
                                      "nodeType": "boolean",
                                      "childNodes": [],
                                      "status": ""
                                    },
                                    {
                                      "name": "upl_kf_early_stimulus",
                                      "id": "f34d6032-d8d9-44a0-94b0-272f380d93df",
                                      "displayName": "Early Stimulus/TKO: The AV fail to provide an adequate stimulus for the NPC to respond to for at least 1 second before the interaction.",
                                      "nodeType": "boolean",
                                      "childNodes": [],
                                      "status": ""
                                    },
                                    {
                                      "name": "upl_kf_responsiveness",
                                      "id": "8cc0ea8b-8b93-496a-af08-675ff8331fe1",
                                      "displayName": "Responsiveness: NPC show kinematic responsiveness, demonstrated either by the NPC slowing down, maneuvering away, accelerating, or other.",
                                      "nodeType": "boolean",
                                      "childNodes": [],
                                      "status": ""
                                    },
                                    {
                                      "name": "upl_kf_secondary_go",
                                      "id": "6547b78c-c699-49ec-8105-024ffeefb56c",
                                      "displayName": "Secondary Go: Prior to the time of predicted interaction between NPC and AV, the NPC re-accelerate \u003E0.5 m/s after initial deceleration.",
                                      "nodeType": "boolean",
                                      "childNodes": [],
                                      "status": ""
                                    },
                                    {
                                      "name": "upl_kf_collision_course",
                                      "id": "e5be8f9c-3e87-4249-b98e-178055bd36de",
                                      "displayName": "Collision Course: The NPC and AV outside of collision course at the time of predicted interaction / collision.",
                                      "nodeType": "boolean",
                                      "childNodes": [],
                                      "status": ""
                                    },
                                    {
                                      "name": "upl_kf_evasive_maneuver",
                                      "id": "0dc49666-7e95-4056-8f0d-77afe329d986",
                                      "displayName": "NPC Evasive Maneuver: The NPC can maneuver around the AV.",
                                      "nodeType": "boolean",
                                      "childNodes": [],
                                      "status": ""
                                    },
                                    {
                                      "name": "upl_kf_side_mirror_overlap",
                                      "id": "17d5c225-107f-40bc-824d-5e81ab667710",
                                      "displayName": "Side Mirror Overlap: The overlap with the side mirror only.",
                                      "nodeType": "boolean",
                                      "childNodes": [],
                                      "status": ""
                                    },
                                    {
                                      "name": "upl_kf_unstable_track",
                                      "id": "404862ba-eb77-434d-95c7-3463fa4bd001",
                                      "displayName": "Flickering Reactive Tracks: At overlap, the reactive footprint unstable or flickering (Replay tests only).",
                                      "nodeType": "boolean",
                                      "childNodes": [],
                                      "status": ""
                                    }
                                  ],
                                  "status": ""
                                }
                              ],
                              "status": ""
                            }
                          ],
                          "status": ""
                        }
                      ],
                      "status": ""
                    }
                  ],
                  "status": ""
                }
              ],
              "status": ""
            },
            {
              "name": "overlap",
              "id": "7618f030-72d0-4237-82c6-e05aabd1fab4",
              "displayName": "Does Lidar Overlap occur between the Ghost Car and a NPC? (Skip if USDC/EMM was already used)",
              "nodeType": "choice",
              "childNodes": [
                {
                  "name": "overlap_a",
                  "id": "b4197558-c879-4f37-9b0c-21ee2598edcc",
                  "displayName": "No",
                  "nodeType": "terminal",
                  "childNodes": [],
                  "status": ""
                },
                {
                  "name": "overlap_b",
                  "id": "d10eaa25-5867-4059-a031-d87ea1c51830",
                  "displayName": "Yes",
                  "nodeType": "branch",
                  "childNodes": [
                    {
                      "name": "overlap_npc_id",
                      "id": "7f2343fe-9069-43f2-9c1c-1013e6993f27",
                      "displayName": "List the Critical Object IDs; These are the NPC(s) or object(s) with whom the AV has a safety critical or near miss interaction (if there are multiple separate them by commas):",
                      "nodeType": "freeText",
                      "childNodes": [],
                      "status": ""
                    },
                    {
                      "name": "overlap_npc_type",
                      "id": "50cf8693-67ee-4335-b58b-d2348b6ed11f",
                      "displayName": "What type of NPC is involved in this interaction?",
                      "nodeType": "choice",
                      "childNodes": [
                        {
                          "name": "overlap_npc_type_a",
                          "id": "24b0fbc3-103d-40fd-96cd-7caad429e8a1",
                          "displayName": "VRU",
                          "nodeType": "branch",
                          "childNodes": [
                            {
                              "name": "overlap_VRU_type",
                              "id": "cf27ea4b-8f5e-458e-938f-6def49aef830",
                              "displayName": "What type of VRU is involved in this interaction?",
                              "nodeType": "choice",
                              "childNodes": [
                                {
                                  "name": "overlap_VRU_type_a",
                                  "id": "b62e390e-6977-4015-854a-b18e6e07afdc",
                                  "displayName": "Pedestrian",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                },
                                {
                                  "name": "overlap_VRU_type_b",
                                  "id": "e33126bc-eaaa-4349-b000-a4421bc6fefd",
                                  "displayName": "2-Wheel VRU",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                }
                              ],
                              "status": ""
                            },
                            {
                              "name": "overlap_VRU_impact_area",
                              "id": "d952dae2-bc92-4bf4-a2d0-d62d80924590",
                              "displayName": "What is the VRU position at time of impact?",
                              "nodeType": "choice",
                              "childNodes": [
                                {
                                  "name": "overlap_VRU_impact_area_a",
                                  "id": "0c440d19-cbb1-4b9e-ac85-370dcabfec3e",
                                  "displayName": "VRU standing / upright at time of impact",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                },
                                {
                                  "name": "overlap_VRU_impact_area_b",
                                  "id": "3f6509d1-af19-47e6-a8bf-5ca7dc41227c",
                                  "displayName": "VRU on the ground at time of impact",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                }
                              ],
                              "status": ""
                            },
                            {
                              "name": "overlap_VRU_position_at_impact",
                              "id": "9d95c293-8c82-43a3-a282-fec600120e38",
                              "displayName": "Where is the VRU impacted?",
                              "nodeType": "choice",
                              "childNodes": [
                                {
                                  "name": "overlap_VRU_position_at_impact_a",
                                  "id": "4c857e1d-72ea-4022-96e1-2e8c42ecc855",
                                  "displayName": "VRU impact to the hands and lower extremities",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                },
                                {
                                  "name": "overlap_VRU_position_at_impact_b",
                                  "id": "8b703273-99ea-4d04-b6a5-c62a6a9577ec",
                                  "displayName": "VRU impact to the head, back, or torso",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                }
                              ],
                              "status": ""
                            },
                            {
                              "name": "overlap_VRU_position_after_impact",
                              "id": "2bda48f2-94a6-4b49-a9cc-393b2991430d",
                              "displayName": "What is the VRU position after impact?",
                              "nodeType": "choice",
                              "childNodes": [
                                {
                                  "name": "overlap_VRU_position_after_impact_a",
                                  "id": "ea4516e6-661a-4125-b6ea-d8562888fd33",
                                  "displayName": "VRU remains standing / upright after impact",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                },
                                {
                                  "name": "overlap_VRU_position_after_impact_b",
                                  "id": "28377a5e-921c-485e-adab-ed1a3cf4ca5d",
                                  "displayName": "VRU controlled fall",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                },
                                {
                                  "name": "overlap_VRU_position_after_impact_c",
                                  "id": "93776e6b-ba41-493d-b42d-a84d985913db",
                                  "displayName": "VRU uncontrolled fall",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                },
                                {
                                  "name": "overlap_VRU_position_after_impact_d",
                                  "id": "0464f6bf-d156-4623-b1fe-30ba0478716c",
                                  "displayName": "N/A (cannot rely on camera views)",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                }
                              ],
                              "status": ""
                            },
                            {
                              "name": "overlap_VRU_UPI",
                              "id": "7ca6f637-bfc9-4be1-8ac5-5f0b4c8769bc",
                              "displayName": "Is the scenario an Unwanted Public Interaction (UPI) (VRU taking deliberate unwanted actions towards the AV)?",
                              "nodeType": "choice",
                              "childNodes": [
                                {
                                  "name": "overlap_VRU_UPI_a",
                                  "id": "41f16b5d-2465-4444-969d-6af45447f20e",
                                  "displayName": "Yes",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                },
                                {
                                  "name": "overlap_VRU_UPI_b",
                                  "id": "63ad06a3-df4e-4235-9d11-f4fad3e91506",
                                  "displayName": "No",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                }
                              ],
                              "status": ""
                            },
                            {
                              "name": "overlap_VRU_incidental_contact",
                              "id": "27b842af-2d7e-426e-962d-c7647e5110f8",
                              "displayName": "Is the scenario an incidental contact?",
                              "nodeType": "choice",
                              "childNodes": [
                                {
                                  "name": "overlap_VRU_incidental_contact_a",
                                  "id": "ac6b6d08-52ea-4df5-9599-7c5134b2a295",
                                  "displayName": "Yes",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                },
                                {
                                  "name": "overlap_VRU_incidental_contact_b",
                                  "id": "ae075a78-75b4-43ca-9634-369f38cf67f3",
                                  "displayName": "No",
                                  "nodeType": "terminal",
                                  "childNodes": [],
                                  "status": ""
                                }
                              ],
                              "status": ""
                            }
                          ],
                          "status": ""
                        },
                        {
                          "name": "overlap_npc_type_b",
                          "id": "416b3153-2cf0-486d-ac5b-a934c1bae018",
                          "displayName": "Motor Vehicle",
                          "nodeType": "terminal",
                          "childNodes": [],
                          "status": ""
                        },
                        {
                          "name": "overlap_npc_type_c",
                          "id": "809cb284-f749-4b3a-9022-98d3655d1bea",
                          "displayName": "Large NCO",
                          "nodeType": "terminal",
                          "childNodes": [],
                          "status": ""
                        },
                        {
                          "name": "overlap_npc_type_d",
                          "id": "f0ed4230-ac26-4deb-a37e-b08d730a3342",
                          "displayName": "Small NCO",
                          "nodeType": "terminal",
                          "childNodes": [],
                          "status": ""
                        }
                      ],
                      "status": ""
                    },
                    {
                      "name": "overlap_conflict_initiator",
                      "id": "826559e1-76ef-4926-bddc-ccb51d190795",
                      "displayName": "Who initiated the conflict?",
                      "nodeType": "choice",
                      "childNodes": [
                        {
                          "name": "overlap_conflict_initiator_a",
                          "id": "3e71a321-3c43-4c44-b5bd-597261516ff1",
                          "displayName": "AV",
                          "nodeType": "terminal",
                          "childNodes": [],
                          "status": ""
                        },
                        {
                          "name": "overlap_conflict_initiator_b",
                          "id": "7534b884-2140-4b7d-b889-b25578f27089",
                          "displayName": "NPC",
                          "nodeType": "terminal",
                          "childNodes": [],
                          "status": ""
                        }
                      ],
                      "status": ""
                    },
                    {
                      "name": "overlap_timestamp",
                      "id": "6411ec5d-40e5-4779-819e-0c34e765cbc0",
                      "displayName": "What is the start time of overlap?",
                      "nodeType": "freeText",
                      "childNodes": [],
                      "status": ""
                    },
                    {
                      "name": "overlap_sev_cal",
                      "id": "5a830481-b6d8-4812-b523-230d2f8cfa64",
                      "displayName": "Did you use severity calculator?",
                      "nodeType": "choice",
                      "childNodes": [
                        {
                          "name": "overlap_sev_cal_a",
                          "id": "e7f8472f-09f4-4a56-a687-c2e1d1845295",
                          "displayName": "No",
                          "nodeType": "terminal",
                          "childNodes": [],
                          "status": ""
                        },
                        {
                          "name": "overlap_sev_cal_b",
                          "id": "10f2208c-6abf-44c4-b618-8cd34e507845",
                          "displayName": "Yes",
                          "nodeType": "branch",
                          "childNodes": [
                            {
                              "name": "overlap_manual_severity_cal_inputs",
                              "id": "f183f096-157b-4b83-97ec-7f4508f08584",
                              "displayName": "Paste the values you inputted into cells B2-B12 in the Severity Calc.",
                              "nodeType": "freeText",
                              "childNodes": [],
                              "status": ""
                            }
                          ],
                          "status": ""
                        }
                      ],
                      "status": ""
                    },
                    {
                      "name": "overlap_initial_classification",
                      "id": "cf17a0ed-60b7-4452-b3f0-f205514ea1d3",
                      "displayName": "What is the initial classification?",
                      "nodeType": "choice",
                      "childNodes": [
                        {
                          "name": "overlap_initial_classification_a",
                          "id": "5b5d7f08-53c8-4e55-8684-d36d3f3dfebe",
                          "displayName": "L0+",
                          "nodeType": "terminal",
                          "childNodes": [],
                          "status": ""
                        },
                        {
                          "name": "overlap_initial_classification_b",
                          "id": "b26c23a1-1ca3-4515-b4d7-cbe3dd9586a2",
                          "displayName": "L0",
                          "nodeType": "terminal",
                          "childNodes": [],
                          "status": ""
                        },
                        {
                          "name": "overlap_initial_classification_c",
                          "id": "853be54a-5d73-4f88-a177-ebd5f012fb3e",
                          "displayName": "L1",
                          "nodeType": "terminal",
                          "childNodes": [],
                          "status": ""
                        },
                        {
                          "name": "overlap_initial_classification_d",
                          "id": "5e1d4bc0-60a0-4ef5-958e-1e4ecda41bf7",
                          "displayName": "L2",
                          "nodeType": "terminal",
                          "childNodes": [],
                          "status": ""
                        },
                        {
                          "name": "overlap_initial_classification_e",
                          "id": "cd9e3d21-a90d-47dd-8aec-1a7df1f33936",
                          "displayName": "L3",
                          "nodeType": "terminal",
                          "childNodes": [],
                          "status": ""
                        },
                        {
                          "name": "overlap_initial_classification_f",
                          "id": "80c301f9-f320-48aa-94a4-5118500d7c5b",
                          "displayName": "L4",
                          "nodeType": "terminal",
                          "childNodes": [],
                          "status": ""
                        },
                        {
                          "name": "overlap_initial_classification_g",
                          "id": "8a2189ec-65ec-49f1-8285-a7779ba40aa0",
                          "displayName": "NMC",
                          "nodeType": "terminal",
                          "childNodes": [],
                          "status": ""
                        },
                        {
                          "name": "overlap_initial_classification_h",
                          "id": "4fb07b66-5ef7-4d24-941e-b295641493c3",
                          "displayName": "RQE",
                          "nodeType": "terminal",
                          "childNodes": [],
                          "status": ""
                        }
                      ],
                      "status": ""
                    },
                    {
                      "name": "overlap_kf_used",
                      "id": "49b1bd09-fae9-4f7c-a1a4-206d03c4caa3",
                      "displayName": "Can at least 1 Key Factor be used for the classification?",
                      "nodeType": "choice",
                      "childNodes": [
                        {
                          "name": "overlap_kf_used_a",
                          "id": "9f4c68d2-bccd-47ec-84cf-0098ce3cc170",
                          "displayName": "No",
                          "nodeType": "terminal",
                          "childNodes": [],
                          "status": ""
                        },
                        {
                          "name": "overlap_kf_used_b",
                          "id": "324dbbed-c0fb-4315-86f1-54ce5ae99a28",
                          "displayName": "Yes",
                          "nodeType": "branch",
                          "childNodes": [
                            {
                              "name": "overlap_kf_acknowledgement",
                              "id": "f6d41d15-9e0a-4e73-8f8d-40c1e8c34f01",
                              "displayName": "Acknowledgement: NPC show signs of recognition from either the driver in a motor vehicle, or the VRU, such as gesticulations or eye contact.",
                              "nodeType": "boolean",
                              "childNodes": [],
                              "status": ""
                            },
                            {
                              "name": "overlap_kf_early_stimulus",
                              "id": "3cf99159-5a00-42d9-ba45-114c3aad891e",
                              "displayName": "Early Stimulus/TKO: The AV fail to provide an adequate stimulus for the NPC to respond to for at least 1 second before the interaction.",
                              "nodeType": "boolean",
                              "childNodes": [],
                              "status": ""
                            },
                            {
                              "name": "overlap_kf_responsiveness",
                              "id": "0d6dd49f-cadb-48bc-8d63-dab90014d144",
                              "displayName": "Responsiveness: NPC show kinematic responsiveness, demonstrated either by the NPC slowing down, maneuvering away, accelerating, or other.",
                              "nodeType": "boolean",
                              "childNodes": [],
                              "status": ""
                            },
                            {
                              "name": "overlap_kf_secondary_go",
                              "id": "2e9fb905-717e-4bad-aaff-94dcd30759cb",
                              "displayName": "Secondary Go: Prior to the time of predicted interaction between NPC and AV, the NPC re-accelerate \u003E0.5 m/s after initial deceleration.",
                              "nodeType": "boolean",
                              "childNodes": [],
                              "status": ""
                            },
                            {
                              "name": "overlap_kf_collision_course",
                              "id": "afe84b39-ad86-426e-95bb-f390eb6a828d",
                              "displayName": "Collision Course: The NPC and AV outside of collision course at the time of predicted interaction / collision.",
                              "nodeType": "boolean",
                              "childNodes": [],
                              "status": ""
                            },
                            {
                              "name": "overlap_kf_evasive_maneuver",
                              "id": "d275d697-23e3-4a62-a2c4-bf78de51b4a1",
                              "displayName": "NPC Evasive Maneuver: The NPC can maneuver around the AV.",
                              "nodeType": "boolean",
                              "childNodes": [],
                              "status": ""
                            },
                            {
                              "name": "overlap_kf_side_mirror_overlap",
                              "id": "3f64011f-6ab7-48ab-bcb5-245b5997f9a6",
                              "displayName": "Side Mirror Overlap: The overlap with the side mirror only.",
                              "nodeType": "boolean",
                              "childNodes": [],
                              "status": ""
                            },
                            {
                              "name": "overlap_kf_unstable_track",
                              "id": "3e635207-8caa-4767-a4b6-70fe9098851d",
                              "displayName": "Flickering Reactive Tracks: At overlap, the reactive footprint unstable or flickering (Replay tests only).",
                              "nodeType": "boolean",
                              "childNodes": [],
                              "status": ""
                            }
                          ],
                          "status": ""
                        }
                      ],
                      "status": ""
                    }
                  ],
                  "status": ""
                }
              ],
              "status": ""
            },
            {
              "name": "other_conflict_emv",
              "id": "0c09fef1-34b7-46d0-9db1-bf73fdc2f960",
              "displayName": "Does the AV fail to yield to an Active EMV passing through an intersection?",
              "nodeType": "choice",
              "childNodes": [
                {
                  "name": "other_conflict_emv_a",
                  "id": "c3807d6e-3bf6-4771-8254-2f8d4ec94cee",
                  "displayName": "No",
                  "nodeType": "terminal",
                  "childNodes": [],
                  "status": ""
                },
                {
                  "name": "other_conflict_emv_b",
                  "id": "1e3db3c7-d879-40c6-bbd2-4ca1c7733b5e",
                  "displayName": "Yes",
                  "nodeType": "branch",
                  "childNodes": [
                    {
                      "name": "other_conflict_emv_npc_id",
                      "id": "e1d705a7-1a5b-4005-b0c1-e4e6251e748c",
                      "displayName": "List the Critical Object IDs; These are the NPC(s) or object(s) with whom the AV has a safety critical or near miss interaction (if there are multiple separate them by commas):",
                      "nodeType": "freeText",
                      "childNodes": [],
                      "status": ""
                    },
                    {
                      "name": "other_conflict_emv_hot",
                      "id": "54ba1982-a54d-4b22-9849-ac056824b597",
                      "displayName": "What is the HOT?",
                      "nodeType": "freeText",
                      "childNodes": [],
                      "status": ""
                    },
                    {
                      "name": "other_conflict_emv_initial_classification",
                      "id": "0ef41b46-1566-48aa-9766-095845df8299",
                      "displayName": "What is the initial classification?",
                      "nodeType": "choice",
                      "childNodes": [
                        {
                          "name": "other_conflict_emv_initial_classification_a",
                          "id": "cab6c655-cdf0-41d9-889b-a734b0163f6e",
                          "displayName": "NMC",
                          "nodeType": "terminal",
                          "childNodes": [],
                          "status": ""
                        },
                        {
                          "name": "other_conflict_emv_initial_classification_b",
                          "id": "249cf558-d010-4a89-b651-91dba0313b30",
                          "displayName": "RQE",
                          "nodeType": "terminal",
                          "childNodes": [],
                          "status": ""
                        }
                      ],
                      "status": ""
                    },
                    {
                      "name": "other_conflict_emv_kf_used",
                      "id": "befed27a-f89b-435a-9d5c-624c9b498f3b",
                      "displayName": "Can at least 1 Key Factor be used for the classification?",
                      "nodeType": "choice",
                      "childNodes": [
                        {
                          "name": "other_conflict_emv_kf_used_a",
                          "id": "f07d3a1a-73d3-471e-991b-1c7ee17ba419",
                          "displayName": "No",
                          "nodeType": "terminal",
                          "childNodes": [],
                          "status": ""
                        },
                        {
                          "name": "other_conflict_emv_kf_used_b",
                          "id": "d4acc527-2af1-45f8-afee-ac725bb93d4c",
                          "displayName": "Yes",
                          "nodeType": "branch",
                          "childNodes": [
                            {
                              "name": "other_conflict_emv_kf_acknowledgement",
                              "id": "257e86a6-cbe0-4ca7-b69e-34c3e998be76",
                              "displayName": "Acknowledgement: NPC show signs of recognition from either the driver in a motor vehicle, or the VRU, such as gesticulations or eye contact.",
                              "nodeType": "boolean",
                              "childNodes": [],
                              "status": ""
                            },
                            {
                              "name": "other_conflict_emv_kf_early_stimulus",
                              "id": "f06ab1c9-24fa-453c-8038-663ebd2d7ddc",
                              "displayName": "Early Stimulus/TKO: The AV fail to provide an adequate stimulus for the NPC to respond to for at least 1 second before the interaction.",
                              "nodeType": "boolean",
                              "childNodes": [],
                              "status": ""
                            },
                            {
                              "name": "other_conflict_emv_kf_responsiveness",
                              "id": "24b84e57-bfa9-45f0-91bf-861105a20e6b",
                              "displayName": "Responsiveness: NPC show kinematic responsiveness, demonstrated either by the NPC slowing down, maneuvering away, accelerating, or other.",
                              "nodeType": "boolean",
                              "childNodes": [],
                              "status": ""
                            },
                            {
                              "name": "other_conflict_emv_kf_secondary_go",
                              "id": "cf358805-7afd-4069-987d-9d523b50e091",
                              "displayName": "Secondary Go: Prior to the time of predicted interaction between NPC and AV, the NPC re-accelerate \u003E0.5 m/s after initial deceleration.",
                              "nodeType": "boolean",
                              "childNodes": [],
                              "status": ""
                            },
                            {
                              "name": "other_conflict_emv_kf_collision_course",
                              "id": "43a16238-e08b-4050-a7f2-4a6b3455e5d4",
                              "displayName": "Collision Course: The NPC and AV outside of collision course at the time of predicted interaction / collision.",
                              "nodeType": "boolean",
                              "childNodes": [],
                              "status": ""
                            },
                            {
                              "name": "other_conflict_emv_kf_evasive_maneuver",
                              "id": "a55ded79-257b-46c4-a06f-de0b35b99784",
                              "displayName": "NPC Evasive Maneuver: The NPC can maneuver around the AV.",
                              "nodeType": "boolean",
                              "childNodes": [],
                              "status": ""
                            },
                            {
                              "name": "other_conflict_emv_kf_side_mirror_overlap",
                              "id": "67296f73-db3c-4e88-a938-a4ae8e3ff90e",
                              "displayName": "Side Mirror Overlap: The overlap with the side mirror only.",
                              "nodeType": "boolean",
                              "childNodes": [],
                              "status": ""
                            },
                            {
                              "name": "other_conflict_emv_kf_unstable_track",
                              "id": "5c3bc8cd-f776-4376-8199-0e3a68d74d1c",
                              "displayName": "Flickering Reactive Tracks: At overlap, the reactive footprint unstable or flickering (Replay tests only).",
                              "nodeType": "boolean",
                              "childNodes": [],
                              "status": ""
                            }
                          ],
                          "status": ""
                        }
                      ],
                      "status": ""
                    }
                  ],
                  "status": ""
                }
              ],
              "status": ""
            },
            {
              "name": "other_conflict_vru",
              "id": "2e6a4c1b-b48c-4643-b5ab-8e73593b060b",
              "displayName": "Is the AV involved in another kind of traffic conflict with a VRU?",
              "nodeType": "choice",
              "childNodes": [
                {
                  "name": "other_conflict_vru_a",
                  "id": "e05e4877-2f71-426f-b838-46c2630ee98c",
                  "displayName": "No",
                  "nodeType": "terminal",
                  "childNodes": [],
                  "status": ""
                },
                {
                  "name": "other_conflict_vru_b",
                  "id": "4eb6a1ed-28b8-4214-b662-d81feabaadf3",
                  "displayName": "Yes",
                  "nodeType": "branch",
                  "childNodes": [
                    {
                      "name": "other_conflict_vru_npc_type",
                      "id": "09435eb9-fc57-451f-8bd5-e7325627fe41",
                      "displayName": "What type of NPC is involved in this interaction?",
                      "nodeType": "choice",
                      "childNodes": [
                        {
                          "name": "other_conflict_vru_npc_type_a",
                          "id": "0fc92ca6-a732-4079-9b2f-216b45eca832",
                          "displayName": "Pedestrian",
                          "nodeType": "terminal",
                          "childNodes": [],
                          "status": ""
                        },
                        {
                          "name": "other_conflict_vru_npc_type_b",
                          "id": "8d90c4bd-a6c8-4219-b2d5-e5ff20bccbeb",
                          "displayName": "2-Wheel VRU",
                          "nodeType": "terminal",
                          "childNodes": [],
                          "status": ""
                        }
                      ],
                      "status": ""
                    },
                    {
                      "name": "other_conflict_vru_conflict_initiator",
                      "id": "3e72afbe-de96-443c-8f25-77afd5f7d634",
                      "displayName": "Who initiated the conflict?",
                      "nodeType": "choice",
                      "childNodes": [
                        {
                          "name": "other_conflict_vru_conflict_initiator_a",
                          "id": "994cb041-f5c3-4ff5-b5f5-0ce35b21e084",
                          "displayName": "AV",
                          "nodeType": "terminal",
                          "childNodes": [],
                          "status": ""
                        },
                        {
                          "name": "other_conflict_vru_conflict_initiator_b",
                          "id": "0f012b7a-7ef1-4760-b8f2-a6c8a7c0da9f",
                          "displayName": "NPC",
                          "nodeType": "terminal",
                          "childNodes": [],
                          "status": ""
                        }
                      ],
                      "status": ""
                    },
                    {
                      "name": "other_conflict_vru_npc_id",
                      "id": "805e6ce3-9d32-4c23-9b76-b958c464a626",
                      "displayName": "List the Critical Object IDs; These are the NPC(s) or object(s) with whom the AV has a safety critical or near miss interaction (if there are multiple separate them by commas):",
                      "nodeType": "freeText",
                      "childNodes": [],
                      "status": ""
                    },
                    {
                      "name": "other_conflict_vru_gap_closing",
                      "id": "75bf2957-c703-48c4-b03f-2dd1d3f174a9",
                      "displayName": "Does Gap Closing occur between the AV and VRU?",
                      "nodeType": "choice",
                      "childNodes": [
                        {
                          "name": "other_conflict_vru_gap_closing_a",
                          "id": "4eab0c9f-e9c9-463e-82c7-aecbbb214a78",
                          "displayName": "No",
                          "nodeType": "terminal",
                          "childNodes": [],
                          "status": ""
                        },
                        {
                          "name": "other_conflict_vru_gap_closing_b",
                          "id": "f8724edc-c9fe-41c5-8ad0-851b025bd7b6",
                          "displayName": "Yes (NMC)",
                          "nodeType": "branch",
                          "childNodes": [
                            {
                              "name": "gap_closing_hot",
                              "id": "a8085045-96ef-48bf-8eee-c672863e7e03",
                              "displayName": "When does the Gap Closing start?",
                              "nodeType": "freeText",
                              "childNodes": [],
                              "status": ""
                            }
                          ],
                          "status": ""
                        }
                      ],
                      "status": ""
                    },
                    {
                      "name": "other_conflict_vru_ped_sdc",
                      "id": "93aa9a4e-3a0d-4322-9d4c-e3ed4020fa82",
                      "displayName": "Does the AV violate the Speed-Distance Caution Curve?",
                      "nodeType": "choice",
                      "childNodes": [
                        {
                          "name": "other_conflict_vru_ped_sdc_a",
                          "id": "9bbf94da-780f-42fd-8e88-fc41ea8f4475",
                          "displayName": "No",
                          "nodeType": "terminal",
                          "childNodes": [],
                          "status": ""
                        },
                        {
                          "name": "other_conflict_vru_ped_sdc_b",
                          "id": "13213ea6-38d3-429c-b5fe-2cd0112d9fd5",
                          "displayName": "Yes (NMC)",
                          "nodeType": "branch",
                          "childNodes": [
                            {
                              "name": "ped_sdc_hot",
                              "id": "67ee4d63-62e2-4104-b825-8a20c65513a6",
                              "displayName": "When does the AV violate the SDC curve?",
                              "nodeType": "freeText",
                              "childNodes": [],
                              "status": ""
                            }
                          ],
                          "status": ""
                        }
                      ],
                      "status": ""
                    },
                    {
                      "name": "other_conflict_vru_kf_used",
                      "id": "619f86c9-0689-4f15-9742-2cf41d1c470c",
                      "displayName": "Can at least 1 Key Factor be used for the classification?",
                      "nodeType": "choice",
                      "childNodes": [
                        {
                          "name": "other_conflict_vru_kf_used_a",
                          "id": "977583df-4742-4270-81dd-91f124f43440",
                          "displayName": "No",
                          "nodeType": "terminal",
                          "childNodes": [],
                          "status": ""
                        },
                        {
                          "name": "other_conflict_vru_kf_used_b",
                          "id": "d831da44-89d4-4584-b435-0e275450b0ec",
                          "displayName": "Yes",
                          "nodeType": "branch",
                          "childNodes": [
                            {
                              "name": "other_conflict_vru_kf_acknowledgement",
                              "id": "8cbf8a5c-ab93-4a7a-9abd-557f9353b31b",
                              "displayName": "Acknowledgement: NPC show signs of recognition from either the driver in a motor vehicle, or the VRU, such as gesticulations or eye contact.",
                              "nodeType": "boolean",
                              "childNodes": [],
                              "status": ""
                            },
                            {
                              "name": "other_conflict_vru_kf_early_stimulus",
                              "id": "7e0c7d3a-0f7d-4d79-b8de-ca81c02b472a",
                              "displayName": "Early Stimulus/TKO: The AV fail to provide an adequate stimulus for the NPC to respond to for at least 1 second before the interaction.",
                              "nodeType": "boolean",
                              "childNodes": [],
                              "status": ""
                            },
                            {
                              "name": "other_conflict_vru_kf_responsiveness",
                              "id": "47fa4311-0925-4389-99dd-9c01b2e63392",
                              "displayName": "Responsiveness: NPC show kinematic responsiveness, demonstrated either by the NPC slowing down, maneuvering away, accelerating, or other.",
                              "nodeType": "boolean",
                              "childNodes": [],
                              "status": ""
                            },
                            {
                              "name": "other_conflict_vru_kf_secondary_go",
                              "id": "401db179-b5d0-4dfa-b009-283a21fb0810",
                              "displayName": "Secondary Go: Prior to the time of predicted interaction between NPC and AV, the NPC re-accelerate \u003E0.5 m/s after initial deceleration.",
                              "nodeType": "boolean",
                              "childNodes": [],
                              "status": ""
                            },
                            {
                              "name": "other_conflict_vru_kf_collision_course",
                              "id": "7d7f66b7-06d5-4e2d-ae72-8deca2557358",
                              "displayName": "Collision Course: The NPC and AV outside of collision course at the time of predicted interaction / collision.",
                              "nodeType": "boolean",
                              "childNodes": [],
                              "status": ""
                            },
                            {
                              "name": "other_conflict_vru_kf_evasive_maneuver",
                              "id": "da0b53f3-55b0-4d1b-a8fa-b88ee374dc39",
                              "displayName": "NPC Evasive Maneuver: The NPC can maneuver around the AV.",
                              "nodeType": "boolean",
                              "childNodes": [],
                              "status": ""
                            },
                            {
                              "name": "other_conflict_vru_kf_side_mirror_overlap",
                              "id": "602012f4-5f27-4f22-8bbc-8ab178d569c1",
                              "displayName": "Side Mirror Overlap: The overlap with the side mirror only.",
                              "nodeType": "boolean",
                              "childNodes": [],
                              "status": ""
                            },
                            {
                              "name": "other_conflict_vru_kf_unstable_track",
                              "id": "027aa19c-7ff3-4d20-a38d-ae29ab2a641d",
                              "displayName": "Flickering Reactive Tracks: At overlap, the reactive footprint unstable or flickering (Replay tests only).",
                              "nodeType": "boolean",
                              "childNodes": [],
                              "status": ""
                            }
                          ],
                          "status": ""
                        }
                      ],
                      "status": ""
                    }
                  ],
                  "status": ""
                }
              ],
              "status": ""
            },
            {
              "name": "evasive_maneuver",
              "id": "d9713c5b-3eba-4b59-9a74-b49b3eb318de",
              "displayName": "Does the AV or a NPC in the scene perform a rapid, evasive maneuver to avoid contact?",
              "nodeType": "choice",
              "childNodes": [
                {
                  "name": "evasive_maneuver_a",
                  "id": "b99c9559-80d1-48c1-9717-38a1f60cbb03",
                  "displayName": "No",
                  "nodeType": "terminal",
                  "childNodes": [],
                  "status": ""
                },
                {
                  "name": "evasive_maneuver_b",
                  "id": "d0403aa9-c66d-4925-997c-56f5b32b230b",
                  "displayName": "Yes",
                  "nodeType": "branch",
                  "childNodes": [
                    {
                      "name": "evasive_maneuver_npc_id",
                      "id": "19c4d4eb-0a5d-4cf1-b093-bb88524c0c06",
                      "displayName": "List the Critical Object IDs; These are the NPC(s) or object(s) with whom the AV has a safety critical or near miss interaction (if there are multiple separate them by commas):",
                      "nodeType": "freeText",
                      "childNodes": [],
                      "status": ""
                    },
                    {
                      "name": "evasive_maneuver_npc_type",
                      "id": "03929b2d-4197-46b7-8ce9-3c761e7e8209",
                      "displayName": "What type of NPC is involved in this interaction?",
                      "nodeType": "choice",
                      "childNodes": [
                        {
                          "name": "evasive_maneuver_npc_type_a",
                          "id": "6d4566ec-76b1-4f14-9546-fab5aa2be9ed",
                          "displayName": "Motor Vehicle",
                          "nodeType": "terminal",
                          "childNodes": [],
                          "status": ""
                        },
                        {
                          "name": "evasive_maneuver_npc_type_b",
                          "id": "ce12e1a7-f932-4897-8961-57e9513be8db",
                          "displayName": "Heavy Motor Vehicle",
                          "nodeType": "terminal",
                          "childNodes": [],
                          "status": ""
                        },
                        {
                          "name": "evasive_maneuver_npc_type_c",
                          "id": "1ef83b26-b32c-4f09-8991-9587b4c03b1d",
                          "displayName": "2-Wheel VRU",
                          "nodeType": "terminal",
                          "childNodes": [],
                          "status": ""
                        },
                        {
                          "name": "evasive_maneuver_npc_type_d",
                          "id": "46cf883d-9ddb-4f86-a9c5-b5f9c8e99ef4",
                          "displayName": "Pedestrian",
                          "nodeType": "terminal",
                          "childNodes": [],
                          "status": ""
                        },
                        {
                          "name": "evasive_maneuver_npc_type_e",
                          "id": "1ed66beb-728c-48e5-8a16-50420ca11f05",
                          "displayName": "Small NCO",
                          "nodeType": "terminal",
                          "childNodes": [],
                          "status": ""
                        },
                        {
                          "name": "evasive_maneuver_npc_type_f",
                          "id": "c55d3fed-ec9c-43f2-b5f8-6a373ea0ebaf",
                          "displayName": "Large NCO",
                          "nodeType": "terminal",
                          "childNodes": [],
                          "status": ""
                        }
                      ],
                      "status": ""
                    },
                    {
                      "name": "evasive_maneuver_conflict_initiator",
                      "id": "c1e3ccdf-847a-4b57-91e5-f22c6a989a9c",
                      "displayName": "Who initiated the conflict?",
                      "nodeType": "choice",
                      "childNodes": [
                        {
                          "name": "evasive_maneuver_conflict_initiator_a",
                          "id": "e16cb2e2-8c50-4e9e-848d-fe660de58850",
                          "displayName": "AV",
                          "nodeType": "terminal",
                          "childNodes": [],
                          "status": ""
                        },
                        {
                          "name": "evasive_maneuver_conflict_initiator_b",
                          "id": "71d443cf-f7cb-4744-a379-379ced5b18aa",
                          "displayName": "NPC",
                          "nodeType": "terminal",
                          "childNodes": [],
                          "status": ""
                        }
                      ],
                      "status": ""
                    },
                    {
                      "name": "evasive_maneuver_acceleration",
                      "id": "0c312627-08e5-40d6-9ef4-361c3e3593f8",
                      "displayName": "Does either party perform rapid, evasive acceleration?",
                      "nodeType": "choice",
                      "childNodes": [
                        {
                          "name": "evasive_maneuver_acceleration_a",
                          "id": "712f59f6-eaef-4e88-afc7-eb8096e69a8f",
                          "displayName": "No",
                          "nodeType": "terminal",
                          "childNodes": [],
                          "status": ""
                        },
                        {
                          "name": "evasive_maneuver_acceleration_b",
                          "id": "0412b2ff-cb42-4ddb-aa9e-980dd3749387",
                          "displayName": "Yes (NMC)",
                          "nodeType": "branch",
                          "childNodes": [
                            {
                              "name": "evasive_acceleration_hot",
                              "id": "763b5916-10a9-4842-b46c-185e0979f40d",
                              "displayName": "What is the Evasive Acceleration's Onset Time?",
                              "nodeType": "freeText",
                              "childNodes": [],
                              "status": ""
                            }
                          ],
                          "status": ""
                        }
                      ],
                      "status": ""
                    },
                    {
                      "name": "evasive_maneuver_brake",
                      "id": "fedec162-bc3d-445b-b9f6-80cb77d3d9aa",
                      "displayName": "Does either party perform rapid, evasive brake?",
                      "nodeType": "choice",
                      "childNodes": [
                        {
                          "name": "evasive_maneuver_brake_a",
                          "id": "b4ba6b55-6750-491d-acde-1203a7509320",
                          "displayName": "No",
                          "nodeType": "terminal",
                          "childNodes": [],
                          "status": ""
                        },
                        {
                          "name": "evasive_maneuver_brake_b",
                          "id": "21cd7c6b-728d-413e-83ad-53a4d21ea6a9",
                          "displayName": "Yes (NMC)",
                          "nodeType": "branch",
                          "childNodes": [
                            {
                              "name": "evasive_brake_hot",
                              "id": "2ebc18dd-ece3-4430-bec8-b472732ea614",
                              "displayName": "What is the Evasive Brake's Onset Time?",
                              "nodeType": "freeText",
                              "childNodes": [],
                              "status": ""
                            }
                          ],
                          "status": ""
                        }
                      ],
                      "status": ""
                    },
                    {
                      "name": "evasive_maneuver_swerve",
                      "id": "2968ca92-bd8e-4a75-bd53-242af16cdfb0",
                      "displayName": "Does either party perform rapid, evasive swerve?",
                      "nodeType": "choice",
                      "childNodes": [
                        {
                          "name": "evasive_maneuver_swerve_a",
                          "id": "7b36ba1d-753b-40d7-b1f0-b81bd68921ca",
                          "displayName": "No",
                          "nodeType": "terminal",
                          "childNodes": [],
                          "status": ""
                        },
                        {
                          "name": "evasive_maneuver_swerve_b",
                          "id": "575e890d-185b-47f2-977c-fadc67fc26f9",
                          "displayName": "Yes (NMC)",
                          "nodeType": "branch",
                          "childNodes": [
                            {
                              "name": "evasive_swerve_hot",
                              "id": "ba58f25c-60ca-41b2-98d3-9942632b9a0c",
                              "displayName": "What is the Evasive Swerve's Onset Time?",
                              "nodeType": "freeText",
                              "childNodes": [],
                              "status": ""
                            }
                          ],
                          "status": ""
                        }
                      ],
                      "status": ""
                    },
                    {
                      "name": "evasive_maneuver_kf_used",
                      "id": "5819c823-df8a-49f3-933b-48114df1363a",
                      "displayName": "Can at least 1 Key Factor be used for the classification?",
                      "nodeType": "choice",
                      "childNodes": [
                        {
                          "name": "evasive_maneuver_kf_used_a",
                          "id": "0d473013-63bb-4533-90bb-fe49633eae67",
                          "displayName": "No",
                          "nodeType": "terminal",
                          "childNodes": [],
                          "status": ""
                        },
                        {
                          "name": "evasive_maneuver_kf_used_b",
                          "id": "73a2bc4a-93d4-4280-af63-a8974c7ce370",
                          "displayName": "Yes",
                          "nodeType": "branch",
                          "childNodes": [
                            {
                              "name": "evasive_maneuver_kf_acknowledgement",
                              "id": "d1fe918a-9f01-48d6-86e8-75f4eaadf30e",
                              "displayName": "Acknowledgement: NPC show signs of recognition from either the driver in a motor vehicle, or the VRU, such as gesticulations or eye contact.",
                              "nodeType": "boolean",
                              "childNodes": [],
                              "status": ""
                            },
                            {
                              "name": "evasive_maneuver_kf_early_stimulus",
                              "id": "cd167238-5376-472a-b6b2-259caae25cf8",
                              "displayName": "Early Stimulus/TKO: The AV fail to provide an adequate stimulus for the NPC to respond to for at least 1 second before the interaction.",
                              "nodeType": "boolean",
                              "childNodes": [],
                              "status": ""
                            },
                            {
                              "name": "evasive_maneuver_kf_responsiveness",
                              "id": "d0cf7484-1e8b-4d3d-b65a-0815aed3362a",
                              "displayName": "Responsiveness: NPC show kinematic responsiveness, demonstrated either by the NPC slowing down, maneuvering away, accelerating, or other.",
                              "nodeType": "boolean",
                              "childNodes": [],
                              "status": ""
                            },
                            {
                              "name": "evasive_maneuver_kf_secondary_go",
                              "id": "1dd1f130-2d47-417c-8b60-7d077cf8c097",
                              "displayName": "Secondary Go: Prior to the time of predicted interaction between NPC and AV, the NPC re-accelerate \u003E0.5 m/s after initial deceleration.",
                              "nodeType": "boolean",
                              "childNodes": [],
                              "status": ""
                            },
                            {
                              "name": "evasive_maneuver_kf_collision_course",
                              "id": "f4b03d6f-b88c-4a51-8775-1b4c2d4d2634",
                              "displayName": "Collision Course: The NPC and AV outside of collision course at the time of predicted interaction / collision.",
                              "nodeType": "boolean",
                              "childNodes": [],
                              "status": ""
                            },
                            {
                              "name": "evasive_maneuver_kf_evasive_maneuver",
                              "id": "a59867a7-ce0a-4134-aad4-7b51af06865e",
                              "displayName": "NPC Evasive Maneuver: The NPC can maneuver around the AV.",
                              "nodeType": "boolean",
                              "childNodes": [],
                              "status": ""
                            },
                            {
                              "name": "evasive_maneuver_kf_side_mirror_evasive_maneuver",
                              "id": "7b4f0bf9-f8cf-4d86-a71e-8b03e89e6dd0",
                              "displayName": "Side Mirror Overlap: The overlap with the side mirror only.",
                              "nodeType": "boolean",
                              "childNodes": [],
                              "status": ""
                            },
                            {
                              "name": "evasive_maneuver_kf_unstable_track",
                              "id": "9e59fd95-2059-4441-8366-46554ed38a6f",
                              "displayName": "Flickering Reactive Tracks: At overlap, the reactive footprint unstable or flickering (Replay tests only).",
                              "nodeType": "boolean",
                              "childNodes": [],
                              "status": ""
                            }
                          ],
                          "status": ""
                        }
                      ],
                      "status": ""
                    }
                  ],
                  "status": ""
                }
              ],
              "status": ""
            },
            {
              "name": "new_scenario",
              "id": "be37c30d-edb8-4455-8ac5-b1084246b9dc",
              "displayName": "Is this a new scenario for the AV?",
              "nodeType": "choice",
              "childNodes": [
                {
                  "name": "new_scenario_a",
                  "id": "0e7b56d9-6b70-4918-904a-79b234a9dd34",
                  "displayName": "No",
                  "nodeType": "terminal",
                  "childNodes": [],
                  "status": ""
                },
                {
                  "name": "new_scenario_b",
                  "id": "34cced42-cf01-4f19-8471-aa84af5d2782",
                  "displayName": "Yes",
                  "nodeType": "terminal",
                  "childNodes": [],
                  "status": ""
                }
              ],
              "status": ""
            },
            {
              "name": "non_physical_final_severity",
              "id": "8567aca8-a5f2-4c3d-914a-d52f9e89c0d3",
              "displayName": "What is the final Non-Physical Collision Severity?",
              "nodeType": "choice",
              "childNodes": [
                {
                  "name": "non_physical_final_severity_a",
                  "id": "ed22ca55-7b62-424e-bf12-f8f726db464f",
                  "displayName": "L0+",
                  "nodeType": "terminal",
                  "childNodes": [],
                  "status": ""
                },
                {
                  "name": "non_physical_final_severity_b",
                  "id": "b970af94-fccb-458f-9d59-c59c92443398",
                  "displayName": "L0",
                  "nodeType": "terminal",
                  "childNodes": [],
                  "status": ""
                },
                {
                  "name": "non_physical_final_severity_c",
                  "id": "6406e251-ab57-48a2-827c-3b78dcf203be",
                  "displayName": "L1",
                  "nodeType": "terminal",
                  "childNodes": [],
                  "status": ""
                },
                {
                  "name": "non_physical_final_severity_d",
                  "id": "8346530f-58c5-4a35-87e4-08b48c93a5ab",
                  "displayName": "L2",
                  "nodeType": "terminal",
                  "childNodes": [],
                  "status": ""
                },
                {
                  "name": "non_physical_final_severity_e",
                  "id": "128034ca-3226-411b-be7c-0ac77e6c7b2a",
                  "displayName": "L3",
                  "nodeType": "terminal",
                  "childNodes": [],
                  "status": ""
                },
                {
                  "name": "non_physical_final_severity_f",
                  "id": "ff2f1cf6-64e4-422d-acd0-4bde6a68a376",
                  "displayName": "L4",
                  "nodeType": "terminal",
                  "childNodes": [],
                  "status": ""
                },
                {
                  "name": "non_physical_final_severity_g",
                  "id": "36875c31-b056-4dcd-8940-b55275cf62af",
                  "displayName": "NMC",
                  "nodeType": "terminal",
                  "childNodes": [],
                  "status": ""
                },
                {
                  "name": "non_physical_final_severity_h",
                  "id": "2ab099df-4f51-49f5-9b8c-df7d47462778",
                  "displayName": "RQE",
                  "nodeType": "terminal",
                  "childNodes": [],
                  "status": ""
                }
              ],
              "status": ""
            }
          ],
          "status": ""
        }
      ],
      "status": ""
    },
    {
      "name": "rationale_comments",
      "id": "07ddd733-9e4f-479d-8daa-e956b3eb3af5",
      "displayName": "Rationale Comments: Please note down information accordingly (small description of scene, decision tree logic discrepancies, edge cases, etc.)",
      "nodeType": "freeText",
      "childNodes": [],
      "status": ""
    }
  ]
}
        // ==============================================
        // === نهاية منطقة شجرة القرارات ==================
        // ==============================================


        // User data with shifts
        const usersByShift = {
            "Morning": [
                { name: "Rawan Saeed Mohamed Hekal", flashNumber: "" },
                { name: "Basmala Mahmoud morsy haron", flashNumber: "" },
                { name: "Israa Amir", flashNumber: "" },
                { name: "Bsmalh Muhammad Yehya Muhammad", flashNumber: "" },
                { name: "Ibtissam mustafa abdelsadiek elsaied", flashNumber: "" },
                { name: "Hamed Mohamed Hamed", flashNumber: "" },
                { name: "Almotasem bellah mohamed ahmed", flashNumber: "" }
            ],
            "Night": [
                { name: "Kareem Ahmed Mohamed Farrag", flashNumber: "" },
                { name: "Mohamed Khaled Elsayed Sakr", flashNumber: "" },
                { name: "Motassem mahmoud ali abdellah", flashNumber: "" },
                { name: "Muhannad Emadaldin Mohammed Jamal", flashNumber: "" },
                { name: "Ahmed Mohamed shabaan Saber", flashNumber: "" },
                { name: "Peter Awad Labib Isaaq", flashNumber: "" },
                { name: "Mustafa salah hassan", flashNumber: "" }
            ],
            "Overnight": [
                { name: "Saleh Saad Aldin Moghazy Ahmed", flashNumber: "" },
                { name: "Ziad Shaban ibrahim", flashNumber: "" },
                { name: "Mahmoud mohamded saad", flashNumber: "" },
                { name: "Aly Ekramy", flashNumber: "" },
                { name: "Mahmoud mohamed elsawy", flashNumber: "" }
            ]
        };

        // App State
        const state = {
            currentUser: null,
            currentTask: null,
            isAdmin: false,
            users: [],
            submissions: [],
            currentAnswers: {},
            accuracyData: {} // لتخزين بيانات Accuracy من Google Sheets
        };

        // Admin credentials
        const ADMIN_CREDENTIALS = {
            username: "admin",
            password: "admin123"
        };

        // DOM Elements
        const loginPanel = document.getElementById('login-panel');
        const taskPanel = document.getElementById('task-panel');
        const classificationPanel = document.getElementById('classification-panel');
        const submissionsPanel = document.getElementById('submissions-panel');
        const adminPanel = document.getElementById('admin-panel');
        const usersList = document.getElementById('users-list');
        const adminSubmissionsList = document.getElementById('admin-submissions-list');
        const userSubmissionsView = document.getElementById('user-submissions-view');
        const selectedUserInfo = document.getElementById('selected-user-info');
        const submissionsList = document.getElementById('submissions-list');
        const usernameInput = document.getElementById('username');
        const flashValue = document.getElementById('flash-number').value.trim() || 'Not provided';
        const adminUsernameInput = document.getElementById('admin-username');
        const adminPasswordInput = document.getElementById('admin-password');
        const taskIdInput = document.getElementById('task-id');
        const currentUserDisplay = document.getElementById('current-user');
        const currentTaskDisplay = document.getElementById('current-task');
        const submitBtn = document.getElementById('submit-btn');
        const userDropdown = document.getElementById('user-dropdown');

        // Initialize shift buttons
        document.querySelectorAll('.shift-btn').forEach(button => {
            button.addEventListener('click', function() {
                // Remove active class from all buttons
                document.querySelectorAll('.shift-btn').forEach(btn => btn.classList.remove('active'));
                
                // Add active class to clicked button
                this.classList.add('active');
                
                // Get selected shift
                const selectedShift = this.dataset.shift;
                
                // Initialize Firebase for selected shift
                initializeFirebaseForShift(selectedShift);
                
                // Enable and populate user dropdown
                const userDropdown = document.getElementById('user-dropdown');
                userDropdown.disabled = false;
                userDropdown.innerHTML = '<option value="">Select your name</option>';
                
                // Add users for selected shift
                usersByShift[selectedShift].forEach(user => {
                    const option = document.createElement('option');
                    option.value = user.name;
                    option.textContent = user.name;
                    userDropdown.appendChild(option);
                });
            });
        });

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize Firebase with Overnight shift by default
            initializeFirebaseForShift('Overnight');
            
            // Check authentication state
            auth.onAuthStateChanged(user => {
                if (user) {
                    // User is signed in
                    if (user.uid === "admin") {
                        state.isAdmin = true;
                        showAdminPanel();
                    } else {
                        // Load user data from Firestore
                        db.collection("users").doc(user.uid).get().then(doc => {
                            if (doc.exists) {
                                state.currentUser = doc.data();
                                showTaskPanel();
                            }
                        });
                    }
                } else {
                    // No user is signed in
            showLoginPanel();
                }
            });

            // Load initial data
            loadUsers();
            loadSubmissions();
            loadAccuracyData(); // تحميل بيانات Accuracy من Google Sheets
            startAccuracyUpdateInterval(); // بدء التحديث التلقائي

            // Event listeners
            document.getElementById('login-btn').addEventListener('click', handleLogin);
            document.getElementById('admin-login-btn').addEventListener('click', handleAdminLogin);
            document.getElementById('start-task-btn').addEventListener('click', startTask);
            document.getElementById('submit-btn').addEventListener('click', submitClassification);
            document.getElementById('new-task-btn').addEventListener('click', startNewTask);
            document.getElementById('logout-btn').addEventListener('click', logout);
            document.getElementById('user-logout-btn').addEventListener('click', logout);
            document.getElementById('admin-logout-btn').addEventListener('click', logout);
            document.getElementById('cancel-task-btn').addEventListener('click', cancelTask);
            document.getElementById('back-to-users-btn').addEventListener('click', () => {
                userSubmissionsView.classList.add('hidden');
            });
            document.getElementById('back-to-submissions-btn').addEventListener('click', function() {
                document.getElementById('submission-details-view').classList.add('hidden');
                document.getElementById('admin-submissions-list').classList.remove('hidden');
            });

            // Shift selection buttons
            document.querySelectorAll('.shift-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.shift-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    userDropdown.disabled = false;
                    const shift = this.dataset.shift;
                    userDropdown.innerHTML = '<option value="">Select your name</option>';
                    
                    usersByShift[shift].forEach(user => {
                        const option = document.createElement('option');
                        option.value = user.name;
                        option.textContent = user.name;
                        userDropdown.appendChild(option);
                    });
                });
            });

            // Filter event listeners
            document.getElementById('apply-filters').addEventListener('click', applyFilters);
            document.getElementById('reset-filters').addEventListener('click', function() {
                document.getElementById('shift-filter').value = 'all';
                document.getElementById('date-filter').value = '';
                applyFilters();
            });
        });

        // Firebase Functions
        async function loadUsers() {
            try {
                const snapshot = await db.collection("users").get();
                state.users = snapshot.docs.map(doc => doc.data());
            } catch (error) {
                console.error("Error loading users:", error);
                alert("Error loading users. Please try again.");
            }
        }

        async function loadSubmissions() {
            try {
                // تحميل التسليمات من Firestore
                const snapshot = await db.collection("submissions").get();
                state.submissions = snapshot.docs.map(doc => {
                    const data = doc.data();
                    return {
                        id: doc.id,
                        ...data,
                        date: data.date.toDate(), // تحويل طابع الوقت من Firestore إلى كائن Date
                        accuracy: getAccuracyForTask(data.taskId), // إضافة الدقة
                        // إضافة معلومات التاريخ المنسقة للفلترة
                        dateString: data.date.toDate().toLocaleDateString('en-US'),
                        dateFormatted: formatDate(data.date.toDate())
                    };
                });
                console.log(`Loaded ${state.submissions.length} submissions`);
            } catch (error) {
                console.error("Error loading submissions:", error);
              
            }
        }
        
        // دالة مساعدة لتنسيق التاريخ بتنسيق "YYYY-MM-DD"
        function formatDate(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }
        
        // دالة مساعدة للتحقق مما إذا كان التاريخ هو اليوم
        function isToday(date) {
            const today = new Date();
            return date.getDate() === today.getDate() &&
                   date.getMonth() === today.getMonth() &&
                   date.getFullYear() === today.getFullYear();
        }

        // Google Sheets Functions
        function loadAccuracyData() {
            console.log('Loading accuracy data...');
            
            // مؤقتاً: إضافة بيانات تجريبية للاختبار
            // يمكن استبدالها لاحقاً بـ Google Sheets API
            state.accuracyData = {
                'ABC123': '85%',
                'DEF456': '92%',
                'GHI789': '78%',
                'JKL012': '95%',
                'MNO345': '88%',
                'PQR678': '91%',
                'STU901': '87%',
                'VWX234': '93%',
                'YZA567': '82%',
                'BCD890': '89%'
            };
            
            console.log('Accuracy data loaded:', state.accuracyData);
            
            // تحديث التقديمات الموجودة
            if (state.submissions.length > 0) {
                state.submissions.forEach(sub => {
                    sub.accuracy = getAccuracyForTask(sub.taskId);
                });
            }
        }

        // Initialize Google Sheets API
        async function initGoogleSheetsAPI() {
            try {
                console.log('Starting Google Sheets API initialization...');
                
                // Check if gapi is available
                if (typeof gapi === 'undefined') {
                    console.error('Google API client (gapi) is not loaded');
                    return;
                }

                // Wait for gapi.client to be available
                if (!gapi.client) {
                    console.log('Waiting for gapi.client to be available...');
                    await new Promise(resolve => {
                        gapi.load('client', resolve);
                    });
                }

                console.log('Initializing gapi.client...');
                await gapi.client.init({
                    apiKey: 'AIzaSyBVoVWGNGqHXUkDuK9oUPuX_QZZtDgpVoE',
                    clientId: '1094461669104-4q2h3b3h84nscv7viv0obpm7jr9edin1.apps.googleusercontent.com',
                    discoveryDocs: ['https://sheets.googleapis.com/$discovery/rest?version=v4'],
                    scope: 'https://www.googleapis.com/auth/spreadsheets.readonly'
                });
                console.log('Google client initialized successfully');

                // Add a small delay to ensure initialization is complete
                await new Promise(resolve => setTimeout(resolve, 1000));

                // Load the sheets API
                if (!gapi.client.sheets) {
                    console.log('Loading sheets API...');
                    await gapi.client.load('sheets', 'v4');
                    console.log('Sheets API loaded successfully');
                } else {
                    console.log('Sheets API already loaded');
                }
                
                // Add another small delay before loading data
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // Load initial accuracy data
                await loadAccuracyData();
                console.log('Initial accuracy data loaded');
            } catch (error) {
                console.error('Error during Google Sheets API initialization:', error);
                // Try to provide more detailed error information
                if (error.result && error.result.error) {
                    console.error('API Error details:', error.result.error);
                }
            }
        }

        // Load gapi on page load
        window.addEventListener('load', function() {
            const script = document.createElement('script');
            script.src = 'https://apis.google.com/js/api.js';
            script.onload = function() {
                console.log('Google API client loaded');
                initGoogleSheetsAPI();
            };
            script.onerror = function() {
                console.error('Failed to load Google API client');
            };
            document.body.appendChild(script);
        });

        // Load model answers and metrics from Google Sheet
        async function loadAccuracyData() {
            try {
                console.log('Starting to load accuracy data...');
                
                // Make sure the client is initialized and signed in
                if (!gapi.client?.sheets) {
                    console.log('Google Sheets API not initialized, initializing now...');
                    try {
                        await gapi.client.load('sheets', 'v4');
                        console.log('Google Sheets API initialized successfully');
                    } catch (initError) {
                        console.error('Failed to initialize Google Sheets API:', initError);
                        return;
                    }
                }

                const SPREADSHEET_ID = '10LZ2HxQ7V1O4sG6-78kDf6CgUKcB36MMtAAHHt2otOw';
                const RANGE = 'Sheet1!A:F'; // Include columns for GULP Link, TP, FP, FN, TN

                console.log('Fetching data from sheet:', SPREADSHEET_ID);
                let response;
                try {
                    response = await gapi.client.sheets.spreadsheets.values.get({
                        spreadsheetId: SPREADSHEET_ID,
                        range: RANGE,
                        valueRenderOption: 'UNFORMATTED_VALUE'
                    });
                    console.log('Successfully fetched data from sheet');
                } catch (fetchError) {
                    console.error('Failed to fetch data from sheet:', fetchError);
                    if (fetchError.status === 401) {
                        console.log('Authentication error detected, attempting to reinitialize...');
                        await initGoogleSheetsAPI();
                        return;
                    }
                    return;
                }

                const rows = response.result.values;
                if (!rows || rows.length === 0) {
                    console.error('No data found in sheet');
                    return;
                }

                console.log(`Found ${rows.length} rows in sheet`);
                state.accuracyData = {};
                let processedCount = 0;
                let errorCount = 0;
                
                // Skip header row
                for (let i = 1; i < rows.length; i++) {
                    const row = rows[i];
                    if (!row || row.length < 5) {
                        console.log(`Skipping incomplete row ${i}: insufficient columns`);
                        continue;
                    }

                    const [gulpLink, tp, fp, fn, tn] = row;
                    if (!gulpLink) {
                        console.log(`Skipping row ${i}: missing GULP link`);
                        continue;
                    }

                    try {
                        // Convert metrics to numbers and handle invalid values
                        const metrics = {
                            tp: Number(tp),
                            fp: Number(fp),
                            fn: Number(fn),
                            tn: Number(tn)
                        };

                        // Log raw values for debugging
                        console.log(`Row ${i} raw values:`, {
                            gulpLink,
                            metrics,
                            rawTP: tp,
                            rawFP: fp,
                            rawFN: fn,
                            rawTN: tn
                        });
                        
                        // Calculate accuracy
                        const accuracy = calculateAccuracy(metrics);
                        state.accuracyData[gulpLink] = accuracy + '%';
                        console.log(`Successfully processed ${gulpLink}: ${accuracy}%`);
                        processedCount++;
                    } catch (err) {
                        console.error(`Error processing row ${i}:`, err);
                        errorCount++;
                    }
                }

                console.log(`Accuracy data loading complete:\n` +
                           `- Total rows processed: ${rows.length - 1}\n` +
                           `- Successfully processed: ${processedCount}\n` +
                           `- Errors encountered: ${errorCount}`);
                           
                // Update UI if needed
                if (typeof updateSubmissionsList === 'function') {
                    updateSubmissionsList();
                }
            } catch (error) {
                console.error('Fatal error in loadAccuracyData:', error);
            }
        }

        // Calculate accuracy based on TP, FP, FN, TN
        function calculateAccuracy(metrics) {
            const { tp = 0, fp = 0, fn = 0, tn = 0 } = metrics;
            
            // Ensure all values are valid numbers
            const validTp = Number(tp) || 0;
            const validFp = Number(fp) || 0;
            const validFn = Number(fn) || 0;
            const validTn = Number(tn) || 0;
            
            // Calculate total predictions
            const total = validTp + validTn + validFp + validFn;
            if (total === 0) return 0;
            
            // Calculate overall accuracy
            const accuracy = ((validTp + validTn) / total) * 100;
            
            // Return rounded accuracy, ensuring it's a valid number
            return isNaN(accuracy) ? 0 : Math.round(accuracy);
        }

        // Get accuracy for a specific task
        function getAccuracyForTask(taskId) {
            if (!taskId || taskId.trim() === '') {
                return 'N/A';
            }

            return state.accuracyData[taskId] || 'N/A';
        }

        // Update accuracy data every 5 minutes
        function startAccuracyUpdateInterval() {
            // Load initial data
            loadAccuracyData();

            // Update every 5 minutes
            setInterval(() => {
                loadAccuracyData();
                // Update existing submissions
                if (state.submissions.length > 0) {
                    state.submissions.forEach(sub => {
                        sub.accuracy = getAccuracyForTask(sub.taskId);
                    });
                }
            }, 5 * 60 * 1000);
        }

        // Initialize Google Sheets API when the page loads
        gapi.load('client', initGoogleSheetsAPI);

        async function saveUser(user) {
            try {
                // Create a simplified ID from the user's name
                const userId = user.name.replace(/\s+/g, '_').toLowerCase();
                await db.collection("users").doc(userId).set({
                    ...user,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                return userId;
            } catch (error) {
                console.error("Error saving user:", error);
                throw error;
            }
        }

        async function saveSubmission(submission) {
            try {
                const flashInput = document.getElementById('flash-number');
const flashNumber = flashInput ? flashInput.value.trim() : '';

submission.user.flashNumber = flashNumber;

const docRef = await db.collection("submissions").add({
  ...submission,
  user: {
    name: submission.user.name,
    shift: submission.user.shift,
    flashNumber: submission.user.flashNumber // ✅ هياخد القيمة اللي أدخلها المستخدم
  },
  date: firebase.firestore.FieldValue.serverTimestamp(),
  classification: submission.classification,
  answers: submission.answers,
  taskId: submission.taskId
});

                return docRef.id;
            } catch (error) {
                console.error("Error saving submission:", error);
                throw error;
            }
        }

        // App Functions
        async function handleLogin(e) {
            e.preventDefault();
            
            const selectedShift = document.querySelector('.shift-btn.active')?.dataset.shift;
            const selectedName = document.getElementById('user-dropdown').value;
            const flashNumber = document.getElementById('flash-number').value;
            
            if (!selectedShift || !selectedName) {
                alert('Please select your shift and name');
                return;
            }
            
            // Find or create user
            let user = state.users.find(u => u.name === selectedName && u.shift === selectedShift);
            if (!user) {
                user = { 
                    id: Date.now().toString(), // Add a unique ID
                    name: selectedName, 
                    flashNumber,
                    shift: selectedShift,
                    username: selectedName.replace(/\s+/g, '_').toLowerCase()
                };
                try {
                    // Save user to Firestore
                    const userRef = window.db.collection('users').doc(user.id);
                    await userRef.set({
                        ...user,
                        createdAt: window.firebase.firestore.FieldValue.serverTimestamp()
                    });
                    state.users.push(user);
                } catch (error) {
                    console.error("Error creating user:", error);
                    alert("Error creating user account. Please try again.");
                    return;
                }
            }
            
            // Set user in state
            state.currentUser = user;
            showTaskPanel();
        }

        async function handleAdminLogin(e) {
            e.preventDefault();
            
            const username = document.getElementById('admin-username').value;
            const password = document.getElementById('admin-password').value;
            
            if (!username || !password) {
                alert('Please enter both username and password');
                return;
            }
            
            if (username === ADMIN_CREDENTIALS.username && password === ADMIN_CREDENTIALS.password) {
                state.isAdmin = true;
                showAdminPanel();
            } else {
                alert('Invalid admin credentials');
            }
        }

        function showTaskPanel() {
            hideAllPanels();
            taskPanel.style.display = 'block';
            flashNumberInput.value = '';
        }

        function showAdminPanel() {
            hideAllPanels();
            adminPanel.style.display = 'block';
            adminUsernameInput.value = '';
            adminPasswordInput.value = '';
            applyFilters();
        }

        function applyFilters() {
            const shiftFilter = document.getElementById('shift-filter').value;
            const dateFilter = document.getElementById('date-filter').value;
            
            let filteredUsers = [...state.users];
            
            if (shiftFilter !== 'all') {
                filteredUsers = filteredUsers.filter(user => user.shift === shiftFilter);
            }
            
            renderFilteredUsersList(filteredUsers);
        }
        
        function renderFilteredUsersList(users) {
            usersList.innerHTML = '<table><tr><th>Username</th><th>Name</th><th>Shift</th><th>Submissions</th><th>Actions</th></tr>';
            
            users.forEach(user => {
                let userSubmissions = state.submissions.filter(s => s.user.name === user.name);
                
                const dateFilter = document.getElementById('date-filter').value;
                if (dateFilter) {
                    const filterDate = new Date(dateFilter);
                    userSubmissions = userSubmissions.filter(sub => {
                        const subDate = new Date(sub.date);
                        return subDate.toDateString() === filterDate.toDateString();
                    });
                }
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${user.username || ''}</td>
                    <td>${user.name}</td>
                    <td>${user.shift}</td>
                    <td>${userSubmissions.length}</td>
                    <td><button onclick="viewUserSubmissions('${user.name}', '${dateFilter || ''}')">View Submissions</button></td>

                `;
                usersList.querySelector('table').appendChild(row);
            });
            
            usersList.innerHTML += '</table>';
        }

       function viewUserSubmissions(username, dateFilter = '') {
    const user = state.users.find(u => u.name === username);
    let userSubmissions = state.submissions.filter(s => s.user.name === username);

    if (dateFilter) {
        const filterDate = new Date(dateFilter);
        userSubmissions = userSubmissions.filter(sub => {
            const subDate = new Date(sub.date);
            return subDate.toDateString() === filterDate.toDateString();
        });
    }

    // Optional: Sort by date
    userSubmissions.sort((a, b) => new Date(a.date) - new Date(b.date));

    selectedUserInfo.innerHTML = `
        <h4>User: ${user.name}</h4>
        <p>Shift: ${user.shift}</p>
        <p>Yubikey Number: ${user.flashNumber || 'Not provided'}</p>
        <p>Total Submissions: ${userSubmissions.length}</p>
    `;

    adminSubmissionsList.innerHTML = '';

    if (userSubmissions.length === 0) {
        adminSubmissionsList.innerHTML = `<p>No submissions found for this date.</p>`;
    } else {
        userSubmissions.forEach(sub => {
            const subElement = document.createElement('div');
            subElement.className = 'submission';
            subElement.innerHTML = `
                <p><strong>GULP Link:</strong> ${sub.taskId}</p>
                <p><strong>Date:</strong> ${new Date(sub.date).toLocaleString()}</p>
                <p><strong>Classification:</strong> ${sub.classification}</p>
                <p><strong>Accuracy:</strong> <span class="accuracy-score">${sub.accuracy || getAccuracyForTask(sub.taskId)}</span></p>
                <button onclick="viewSubmissionDetails('${sub.id}')">View Details</button>
                <button onclick="downloadSubmission('${sub.id}')">Download</button>
            `;
            adminSubmissionsList.appendChild(subElement);
        });
    }

    userSubmissionsView.classList.remove('hidden');
    document.getElementById('submission-details-view').classList.add('hidden');
}


        // دالة لحساب متوسط Accuracy للمستخدم
        function calculateAverageAccuracy(submissions) {
            if (submissions.length === 0) return 'N/A';
            
            const accuracies = submissions.map(sub => {
                const accuracy = getAccuracyForTask(sub.taskId);
                return accuracy === 'N/A' ? 0 : parseInt(accuracy.replace('%', ''));
            }).filter(acc => acc > 0);
            
            if (accuracies.length === 0) return 'N/A';
            
            const average = accuracies.reduce((sum, acc) => sum + acc, 0) / accuracies.length;
            return Math.round(average) + '%';
        }

        function viewSubmissionDetails(submissionId) {
            const submission = state.submissions.find(sub => sub.id === submissionId);
            if (!submission) return;
            
            document.getElementById('admin-submissions-list').classList.add('hidden');
            document.getElementById('submission-details-view').classList.remove('hidden');
            
            const detailsContainer = document.getElementById('submission-full-details');
            detailsContainer.innerHTML = '';
            
            const classificationReconstruction = document.createElement('div');
            classificationReconstruction.className = 'classification-reconstruction';
            
            const header = document.createElement('div');
            header.innerHTML = `
                <h4>Submission Details - GULP Link: ${submission.taskId}</h4>
                <p><strong>User:</strong> ${submission.user.name} (${submission.user.shift})</p>
                <p><strong>Date:</strong> ${submission.date.toLocaleString()}</p>
                <p><strong>Final Classification:</strong> ${submission.classification}</p>
                <p><strong>Accuracy:</strong> <span class="accuracy-score">${submission.accuracy || getAccuracyForTask(submission.taskId)}</span></p>
                <hr>
            `;
            classificationReconstruction.appendChild(header);
            
            const answersList = document.createElement('div');
            answersList.className = 'submission-answers';
            
            for (const [question, answer] of Object.entries(submission.answers)) {
                const answerItem = document.createElement('div');
                answerItem.className = 'answer-item';
                answerItem.innerHTML = `
                    <div class="answer-question">${question}</div>
                    <div class="answer-value">${answer}</div>
                `;
                answersList.appendChild(answerItem);
            }
            
            classificationReconstruction.appendChild(answersList);
            detailsContainer.appendChild(classificationReconstruction);
        }

        function startTask(e) {
            e.preventDefault();
            
            const taskId = taskIdInput.value.trim();

            if (!taskId) {
                alert('Please enter a task ID');
                    return;
                }
            state.currentTask = taskId;
            showClassificationPanel();
        }

        function showClassificationPanel() {
    hideAllPanels();
    classificationPanel.style.display = 'block';

    const flashValue = document.getElementById('flash-number').value.trim() || 'Not provided';
    currentUserDisplay.textContent = `User: ${state.currentUser.name} (${state.currentUser.shift}) - Flash: ${flashValue}`;

    currentTaskDisplay.textContent = `GULP Link: ${state.currentTask}`;
    submitBtn.style.display = 'block';

    document.getElementById('tree-container').innerHTML = '';
    new DecisionTreeNavigator(decisionTree);
}


        function collectAnswers() {
            state.currentAnswers = {};
            let isValid = true;
            
            document.querySelectorAll('.error-message').forEach(el => el.remove());
            
            const radioGroups = {};
            document.querySelectorAll('input[type="radio"]').forEach(radio => {
                const questionId = radio.name;
                radioGroups[questionId] = radioGroups[questionId] || [];
                radioGroups[questionId].push(radio);
            });
            
            for (const [questionId, radios] of Object.entries(radioGroups)) {
                const checkedRadio = radios.find(r => r.checked);
                const questionText = document.querySelector(`.question[data-id="${questionId}"]`)?.textContent || questionId;
                
                if (!checkedRadio) {
                    const questionElement = document.querySelector(`.question[data-id="${questionId}"]`);
                    if (questionElement) {
                        const errorElement = document.createElement('div');
                        errorElement.className = 'error-message';
                        errorElement.textContent = 'Please select an option for this question';
                        questionElement.parentNode.insertBefore(errorElement, questionElement.nextSibling);
                    }
                    isValid = false;
                } else {
                    const optionId = checkedRadio.parentElement.textContent.trim();
                    state.currentAnswers[questionText] = optionId;
                }
            }
            
            // معالجة الأسئلة من نوع boolean (checkboxes)
            document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                const questionText = checkbox.parentElement.textContent.trim();
                if (checkbox.checked) {
                    state.currentAnswers[questionText] = 'Yes';
                }
            });
            
            document.querySelectorAll('.text-input').forEach(input => {
                const questionId = input.id || input.parentElement.querySelector('.question')?.textContent.trim();
                if (input.value.trim()) {
                    state.currentAnswers[questionId] = input.value.trim();
                }
            });
            
            return isValid;
        }

        async function submitClassification(e) {
            e.preventDefault();

            const submitButton = e.target; // Define earlier to use in case of early return
            const originalText = submitButton.textContent;
            
            if (!collectAnswers()) {
                alert('Please complete all required questions before submitting');
                return;
            }

            if (!db || !currentShift) {
                alert("Firebase is not properly initialized for the current shift. Please select your shift again and wait for confirmation.");
                console.error("SubmitClassification: Firebase not ready. Current DB state:", db, "Current shift:", currentShift);
                // No need to disable/re-enable button here as it's not yet disabled for submission
                return;
            }

            submitButton.disabled = true;
            submitButton.innerHTML = `Submitting <span class="loading"></span>`;

            try {
                const submission = {
                    user: state.currentUser,
                    taskId: state.currentTask,
                    date: new Date(), // This will be client's date, Firestore serverTimestamp is better for consistency
                    answers: state.currentAnswers,
                    classification: getFinalClassification()
                };

                const submissionId = await saveSubmission(submission);
                submission.id = submissionId;
                submission.accuracy = getAccuracyForTask(state.currentTask); // إضافة Accuracy
                state.submissions.push(submission);

                // تحديث البيانات في الوقت الفعلي
                if (!state.accuracyData[state.currentTask]) {
                    state.accuracyData[state.currentTask] = submission.accuracy;
                }

                // Show custom popup with cat GIF based on accuracy
                const accuracy = getAccuracyForTask(state.currentTask);
                const popupContent = document.createElement('div');
                popupContent.className = 'quality-popup';
                
                // Select GIF based on accuracy
                let catGifUrl = '';
                if (accuracy >= 80) {
                    catGifUrl = 'https://media2.giphy.com/media/v1.Y2lkPTc5MGI3NjExbTI1NnI4Z2g5Y25uaWt5MGoweDE2emluZWZvaW8yazlvOTZnNjBicCZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/BzyTuYCmvSORqs1ABM/giphy.gif'; // Happy cat
                } else if (accuracy >= 50) {
                    catGifUrl = 'https://media.giphy.com/media/13HXKG2HGN8aPK/giphy.gif'; // Cat driving
                } else {
                    catGifUrl = 'https://i.giphy.com/H4DjXQXamtTiIuCcRU.webp'; // Sad/angry cat
                }
                
                popupContent.innerHTML = `
                    <div class="popup-content">
                        <img src="${catGifUrl}" alt="Cat reaction" class="cat-gif">
                        <h3>Submission Successful! 🎉</h3>
                        <p><strong>Task ID:</strong> ${state.currentTask}</p>
                        <p><strong>Classification:</strong> ${submission.classification}</p>
                        <p><strong>Accuracy:</strong> ${accuracy}%</p>
                        <button id="responder-dashboard-btn" onclick="window.open('https://script.google.com/macros/s/AKfycbwV5TFYA7TYy3FdESpmUO8BElxesOPnbB4Z-9rr7BbbBPMWo8A8k0F90cYGB5fKJNKOKQ/exec', '_blank')">Responder Dashboard</button>
                        <button onclick="this.parentElement.parentElement.remove()" class="close-popup">Close</button>
                    </div>
                `;
                
                document.body.appendChild(popupContent);
                
                showSubmissionsPanel();
            } catch (error) {
                console.error("Error submitting classification:", error);
                alert("Error submitting classification. Please try again.");
            } finally {
                submitButton.disabled = false;
                submitButton.textContent = originalText;
            }
        }

        function getFinalClassification() {
            const terminalNodes = document.querySelectorAll('.terminal-message');
            if (terminalNodes.length > 0) {
                return terminalNodes[terminalNodes.length - 1].textContent.replace('✓ ', '');
            }
            return "No final classification determined";
        }

       let currentSubmissionPage = 1;
const submissionsPerPage = 5;
let filteredSubmissions = [];

async function showSubmissionsPanel() {
    hideAllPanels();
    submissionsPanel.style.display = 'block';

    // تحميل التسليمات
    await loadSubmissions();

    // فلتر التاريخ إذا مش موجود
    if (!document.getElementById('date-filter-container')) {
        const filterContainer = document.createElement('div');
        filterContainer.id = 'date-filter-container';
        filterContainer.className = 'date-filter-container';
        filterContainer.innerHTML = `
            <div class="form-group">
                <label for="date-filter">Filter by date:</label>
                <select id="date-filter" class="date-filter">
                    <option value="today" selected>Today only</option>
                    <option value="all">All dates</option>
                    <option value="custom">Select date...</option>
                </select>
                <input type="date" id="custom-date" class="custom-date" style="display: none;">
                <button id="responder-dashboard-btn" onclick="window.open('https://script.google.com/macros/s/AKfycbwV5TFYA7TYy3FdESpmUO8BElxesOPnbB4Z-9rr7BbbBPMWo8A8k0F90cYGB5fKJNKOKQ/exec', '_blank')">Responder Dashboard</button>
            </div>
        `;

        submissionsPanel.insertBefore(filterContainer, submissionsList);

        const dateFilter = document.getElementById('date-filter');
        const customDate = document.getElementById('custom-date');

        dateFilter.addEventListener('change', function () {
            if (this.value === 'custom') {
                customDate.style.display = 'inline-block';
                const today = new Date();
                customDate.value = formatDate(today);
            } else {
                customDate.style.display = 'none';
            }
            filterSubmissions();
        });

        customDate.addEventListener('change', filterSubmissions);
    }

    filterSubmissions();
}

function filterSubmissions() {
    const dateFilter = document.getElementById('date-filter');
    const customDate = document.getElementById('custom-date');
    const filterValue = dateFilter.value;

    submissionsList.innerHTML = '';

    let userSubmissions = state.submissions.filter(sub => sub.user.name === state.currentUser.name);

    if (filterValue === 'today') {
        userSubmissions = userSubmissions.filter(sub => isToday(sub.date));
    } else if (filterValue === 'custom' && customDate.value) {
        const selectedDate = customDate.value;
        userSubmissions = userSubmissions.filter(sub => sub.dateFormatted === selectedDate);
    }

    userSubmissions.sort((a, b) => b.date - a.date);
    filteredSubmissions = userSubmissions;
    currentSubmissionPage = 1;

    renderSubmissionPage();
}

function renderSubmissionPage() {
    submissionsList.innerHTML = '';

    if (filteredSubmissions.length === 0) {
        submissionsList.innerHTML = '<p>No submissions found for the selected date.</p>';
        removePaginationControls();
        return;
    }

    // ✅ حساب عدد الصفحات الكلي
    const totalPages = Math.ceil(filteredSubmissions.length / submissionsPerPage);

    // ✅ التأكد من أن الصفحة الحالية ضمن النطاق
    if (currentSubmissionPage > totalPages) currentSubmissionPage = totalPages || 1;

    // ✅ حساب الفهرسة لبدء ونهاية الصفحة
    const start = (currentSubmissionPage - 1) * submissionsPerPage;
    const pageItems = filteredSubmissions.slice(start, start + submissionsPerPage);

    // ✅ عرض عناصر الصفحة
    pageItems.forEach(sub => {
        const subElement = document.createElement('div');
        subElement.className = 'submission';
        subElement.innerHTML = `
            <p><strong>GULP Link:</strong> ${sub.taskId}</p>
            <p><strong>Date:</strong> ${sub.date.toLocaleString()}</p>
            <p><strong>Classification:</strong> ${sub.classification}</p>
            <p><strong>Accuracy:</strong> <span class="accuracy-score">${sub.accuracy || getAccuracyForTask(sub.taskId)}</span></p>
            <button onclick="viewSubmissionDetails('${sub.id}')">View Details</button>
            <button onclick="downloadSubmission('${sub.id}')">Download</button>
        `;
        submissionsList.appendChild(subElement);
    });

    // ✅ عرض أزرار الصفحة
    renderPaginationControls(totalPages);
}


function renderPaginationControls() {
    removePaginationControls();

    const totalPages = Math.ceil(filteredSubmissions.length / submissionsPerPage);
    if (totalPages <= 1) return;

    const pagination = document.createElement("div");
    pagination.id = "pagination-controls";
    pagination.className = "pagination-controls";
    pagination.innerHTML = `
        <button onclick="prevSubmissionPage()" ${currentSubmissionPage === 1 ? 'disabled' : ''}>Previous</button>
        <span>Page ${currentSubmissionPage} of ${totalPages}</span>
        <button onclick="nextSubmissionPage()" ${currentSubmissionPage === totalPages ? 'disabled' : ''}>Next</button>
    `;

submissionsPanel.insertBefore(pagination, document.getElementById("new-task-btn"));
}

function removePaginationControls() {
    const existing = document.getElementById("pagination-controls");
    if (existing) existing.remove();
}

function nextSubmissionPage() {
    const totalPages = Math.ceil(filteredSubmissions.length / submissionsPerPage);
    if (currentSubmissionPage < totalPages) {
        currentSubmissionPage++;
        renderSubmissionPage();
    }
}

function prevSubmissionPage() {
    if (currentSubmissionPage > 1) {
        currentSubmissionPage--;
        renderSubmissionPage();
    }
}

        function startNewTask() {
            showTaskPanel();
            taskIdInput.value = '';
            state.currentTask = null;
        }

        function cancelTask() {
            if (confirm('Are you sure you want to cancel this task? All progress will be lost.')) {
                showTaskPanel();
                taskIdInput.value = state.currentTask;
                state.currentTask = null;
            }

        }

        function logout() {
            state.currentUser = null;
            state.isAdmin = false;
            state.currentTask = null;
            showLoginPanel();
        }

        function showLoginPanel() {
            hideAllPanels();
            loginPanel.style.display = 'block';
            document.querySelectorAll('.shift-btn').forEach(b => b.classList.remove('active'));
            userDropdown.innerHTML = '<option value="">Please select shift first</option>';
            userDropdown.disabled = true;
            flashNumberInput.value = '';
        }

        function hideAllPanels() {
            loginPanel.style.display = 'none';
            taskPanel.style.display = 'none';
            classificationPanel.style.display = 'none';
            submissionsPanel.style.display = 'none';
            adminPanel.style.display = 'none';
            userSubmissionsView.classList.add('hidden');
            document.getElementById('submission-details-view').classList.add('hidden');
        }

        // Global functions
        window.downloadSubmission = function(submissionId) {
            const submission = state.submissions.find(sub => sub.id === submissionId);
            if (!submission) return;

            // Convert date to string for JSON
            const submissionForExport = {
                ...submission,
                date: submission.date.toISOString()
            };

            const dataStr = JSON.stringify(submissionForExport, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `AV_Classification_${submission.taskId}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
        };

        window.viewUserSubmissions = viewUserSubmissions;
        window.viewSubmissionDetails = viewSubmissionDetails;

 class DecisionTreeNavigator {
        constructor(treeData) {
            this.treeData = treeData;
            this.container = document.getElementById('tree-container');
            this.container.innerHTML = '';
            this.renderTree(this.treeData.childNodes, this.container);
        }
        renderTree(nodes, parentElement) {
            nodes.forEach(node => {
                const nodeElement = document.createElement('div');
                nodeElement.className = 'node';
                // Render question
                const questionElement = document.createElement('div');
                questionElement.className = 'question';
                questionElement.textContent = node.displayName;
                questionElement.setAttribute('data-id', node.id);
                nodeElement.appendChild(questionElement);
                // Render options if choice node
                if (node.nodeType === 'choice') {
    const optionsElement = document.createElement('div');
    optionsElement.className = 'options';

    node.childNodes.forEach((child, index) => {
        const optionId = `${node.id}_${index}`;

        const label = document.createElement('label');
        label.className = 'option';
        label.setAttribute('for', optionId); // optional but good

        const radio = document.createElement('input');
        radio.type = 'radio';
        radio.name = node.id;
        radio.id = optionId;

        radio.addEventListener('change', () => {
            this.handleSelection(label, child);
        });

        label.appendChild(radio);
        label.appendChild(document.createTextNode(' ' + child.displayName));
        optionsElement.appendChild(label);
    });

    nodeElement.appendChild(optionsElement);
}

                // Render boolean node as checkbox
                else if (node.nodeType === 'boolean') {
                    const checkboxElement = document.createElement('div');
                    checkboxElement.className = 'boolean-option';
                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.id = node.id;
                    checkbox.name = node.id;
                    checkbox.addEventListener('change', () => {
                        this.handleBooleanSelection(checkbox, node);
                    });
                    checkboxElement.appendChild(checkbox);
                    checkboxElement.appendChild(document.createTextNode(' ' + node.displayName));
                    nodeElement.appendChild(checkboxElement);
                }
                // Render free text input
                else if (node.nodeType === 'freeText') {
                    const inputElement = document.createElement('textarea');
                    inputElement.className = 'text-input';
                    inputElement.id = node.id;
                    inputElement.placeholder = node.displayName;
                    nodeElement.appendChild(inputElement);
                }
                parentElement.appendChild(nodeElement);
            });
        }
        handleSelection(optionElement, selectedNode) {
            // إزالة أي اختيار سابق
            document.querySelectorAll('.selected').forEach(el => {
                el.classList.remove('selected');
            });
            optionElement.classList.add('selected');
            // حذف أي أسئلة فرعية قديمة
            const existingChildNodes = optionElement.parentElement.querySelectorAll('.child-node');
            existingChildNodes.forEach(node => node.remove());
            // إذا الإجابة Branch ارسم الأسئلة الفرعية
            if (selectedNode.nodeType === 'branch' && selectedNode.childNodes.length > 0) {
                const childContainer = document.createElement('div');
                childContainer.className = 'child-node';
                this.renderTree(selectedNode.childNodes, childContainer);
                optionElement.parentElement.appendChild(childContainer);
            }
            
        }

        handleBooleanSelection(checkbox, node) {
            // معالجة اختيار الأسئلة من نوع boolean
            if (checkbox.checked) {
                checkbox.parentElement.classList.add('selected');
            } else {
                checkbox.parentElement.classList.remove('selected');
            }
        }
    }

    // Add this to your existing JavaScript
    function toggleTheme() {
        const body = document.body;
        const currentTheme = body.getAttribute('data-theme');
        const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
        body.setAttribute('data-theme', newTheme);
        
        // Update icon
        const icon = document.querySelector('.theme-toggle i');
        icon.className = newTheme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
        
        // Save preference
        localStorage.setItem('theme', newTheme);
    }

    // Check for saved theme preference
    document.addEventListener('DOMContentLoaded', () => {
        const savedTheme = localStorage.getItem('theme') || 'light';
        document.body.setAttribute('data-theme', savedTheme);
        const icon = document.querySelector('.theme-toggle i');
        icon.className = savedTheme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
    });

    // Add this at the end of your existing JavaScript
    // Create particle effect
    const particlesContainer = document.getElementById('particles-container');
    const particleCount = 80;
    
    // Create particles
    for (let i = 0; i < particleCount; i++) {
        createParticle();
    }
    
    function createParticle() {
        const particle = document.createElement('div');
        particle.className = 'particle';
        
        const size = Math.random() * 3 + 1;
        particle.style.width = `${size}px`;
        particle.style.height = `${size}px`;
        
        resetParticle(particle);
        particlesContainer.appendChild(particle);
        animateParticle(particle);
    }
    
    function resetParticle(particle) {
        const posX = Math.random() * 100;
        const posY = Math.random() * 100;
        
        particle.style.left = `${posX}%`;
        particle.style.top = `${posY}%`;
        particle.style.opacity = '0';
        
        return { x: posX, y: posY };
    }
    
    function animateParticle(particle) {
        const pos = resetParticle(particle);
        const duration = Math.random() * 10 + 10;
        const delay = Math.random() * 5;
        
        setTimeout(() => {
            particle.style.transition = `all ${duration}s linear`;
            particle.style.opacity = Math.random() * 0.3 + 0.1;
            
            const moveX = pos.x + (Math.random() * 20 - 10);
            const moveY = pos.y - Math.random() * 30;
            
            particle.style.left = `${moveX}%`;
            particle.style.top = `${moveY}%`;
            
            setTimeout(() => {
                animateParticle(particle);
            }, duration * 1000);
        }, delay * 1000);
    }
    
    // Mouse interaction
    document.addEventListener('mousemove', (e) => {
        const mouseX = (e.clientX / window.innerWidth) * 100;
        const mouseY = (e.clientY / window.innerHeight) * 100;
        
        const particle = document.createElement('div');
        particle.className = 'particle';
        
        const size = Math.random() * 4 + 2;
        particle.style.width = `${size}px`;
        particle.style.height = `${size}px`;
        
        particle.style.left = `${mouseX}%`;
        particle.style.top = `${mouseY}%`;
        particle.style.opacity = '0.6';
        
        particlesContainer.appendChild(particle);
        
        setTimeout(() => {
            particle.style.transition = 'all 2s ease-out';
            particle.style.left = `${mouseX + (Math.random() * 10 - 5)}%`;
            particle.style.top = `${mouseY + (Math.random() * 10 - 5)}%`;
            particle.style.opacity = '0';
            
            setTimeout(() => {
                particle.remove();
            }, 2000);
        }, 10);
        
        const spheres = document.querySelectorAll('.gradient-sphere');
        const moveX = (e.clientX / window.innerWidth - 0.5) * 5;
        const moveY = (e.clientY / window.innerHeight - 0.5) * 5;
        
        spheres.forEach(sphere => {
            sphere.style.transform = `translate(${moveX}px, ${moveY}px)`;
        });
    });

    // Add this at the beginning of your JavaScript
    // Create particles for explosion
    function createParticles() {
        const particlesContainer = document.getElementById('particles');
        for (let i = 0; i < 50; i++) {
            const particle = document.createElement('div');
            particle.className = 'particle';
            // Set random position for each particle
            const x = Math.random() * 400 - 200;
            const y = Math.random() * 400 - 200;
            particle.style.setProperty('--x', `calc(-50% + ${x}px)`);
            particle.style.setProperty('--y', `calc(-50% + ${y}px)`);
            // Random delay for more natural effect
            particle.style.animationDelay = `${Math.random() * 0.5}s`;
            particlesContainer.appendChild(particle);
        }
    }

    // Handle loading screen
    window.addEventListener('load', () => {
        createParticles();
        setTimeout(() => {
            const loadingScreen = document.querySelector('.loading-screen');
            loadingScreen.classList.add('fade-out');
            setTimeout(() => {
                loadingScreen.style.display = 'none';
            }, 500);
        }, 2000);
    });

    function determineClassification(answers) {
        // Get the final severity levels from the specific questions
        const finalSeverity = answers['What is the final severity level?'] || 'no';
        const nonPhysicalSeverity = answers['What is the final Non-Physical Collision Severity?'] || 'no';
        const physicalCollision = answers['Is this a physical collision or exit code 141(Psim/Matrix only)?'] || 'no';

        // Check for SCE (L0+ to L4)
        if (finalSeverity.toLowerCase().includes('sce')) {
            return finalSeverity; // Return the exact SCE level (L0+ to L4)
        }

        // Check for NMC
        if (nonPhysicalSeverity.toLowerCase().includes('nmc')) {
            return 'NMC';
        }

        // If both final severity and physical collision are "no", return RQE
        if (finalSeverity.toLowerCase() === 'no' && physicalCollision.toLowerCase() === 'no') {
            return 'RQE';
        }

        // Default to RQE if no other conditions are met
        return 'RQE';
    }

    function updateClassification() {
        const answers = {};
        document.querySelectorAll('.question').forEach(question => {
            const questionText = question.querySelector('label').textContent;
            const selectedOption = question.querySelector('input[type="radio"]:checked');
            if (selectedOption) {
                answers[questionText] = selectedOption.value;
            }
        });

        const classification = determineClassification(answers);
        const classificationResult = document.getElementById('classification-result');
        if (classificationResult) {
            classificationResult.textContent = classification;
            // Add visual feedback for the classification
            classificationResult.className = 'classification-' + classification.toLowerCase().replace('+', 'plus');
        }
    }

    // Add event listeners to the relevant questions
    document.querySelectorAll('.question').forEach(question => {
        const questionText = question.querySelector('label').textContent;
        if (questionText === 'What is the final severity level?' || 
            questionText === 'What is the final Non-Physical Collision Severity?' ||
            questionText === 'Is this a physical collision or exit code 141(Psim/Matrix only)?') {
            question.querySelectorAll('input[type="radio"]').forEach(radio => {
                radio.addEventListener('change', updateClassification);
            });
        }
    });

    // Add some CSS for classification styling
    const style = document.createElement('style');
    style.textContent = `
        .classification-rqe { color: #4CAF50; }
        .classification-nmc { color: #FFA500; }
        .classification-scel0plus { color: #FF0000; }
        .classification-scel1 { color: #FF0000; }
        .classification-scel2 { color: #FF0000; }
        .classification-scel3 { color: #FF0000; }
        .classification-scel4 { color: #FF0000; }
    `;
    document.head.appendChild(style);
    </script>
</body>
</html>

